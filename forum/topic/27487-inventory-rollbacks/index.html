<!DOCTYPE html>

<html dir="ltr" lang="en-US">

<!-- Added by HTTrack --><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8"/>
<title>Inventory Rollbacks - Epoch Linux Server - Epoch Mod Community</title>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52081052-1', 'auto');
  ga('send', 'pageview');

</script>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="https://epochmod.com/forum/uploads/monthly_2018_04/logo_only_black.png.c85695b79cad231dd136cd63c4db8256.png" property="og:image"/>
<meta content="summary_large_image" name="twitter:card">
<meta content="@EpochMod" name="twitter:site">
<meta content="Inventory Rollbacks" property="og:title"/>
<meta content="website" property="og:type"/>
<meta content="https://epochmod.com/forum/topic/27487-inventory-rollbacks/" property="og:url"/>
<meta content="Hello Guys need some help some Player notall have the Rollback Problem if they relog #!/usr/bin/perl # # Copyright 2013 by Denis Erygin, # denis.erygin@gmail.com # use warnings; use strict; use constant PORT =&gt; 2302; # Change it with epoch.sh use constant PATH =&gt; $ENV{'PWD'}.'/'; # Set your..." name="description"/>
<meta content="Hello Guys need some help some Player notall have the Rollback Problem if they relog #!/usr/bin/perl # # Copyright 2013 by Denis Erygin, # denis.erygin@gmail.com # use warnings; use strict; use constant PORT =&gt; 2302; # Change it with epoch.sh use constant PATH =&gt; $ENV{'PWD'}.'/'; # Set your..." property="og:description"/>
<meta content="2014-11-05T06:26:29Z" property="og:updated_time"/>
<meta content="Epoch Mod Community" property="og:site_name"/>
<meta content="en_US" property="og:locale"/>
<link href="index.html" rel="canonical"/>
<link href="https://epochmod.com/forum/manifest.webmanifest/" rel="manifest"/>
<meta content="https://epochmod.com/forum/browserconfig.xml/" name="msapplication-config"/>
<meta content="/" name="msapplication-starturl"/>
<meta content="Epoch Mod Community" name="application-name"/>
<meta content="Epoch Mod Community" name="apple-mobile-web-app-title"/>
<meta content="#000000" name="theme-color"/>
<link as="font" crossorigin="anonymous" href="http://epochmod.com/forum/applications/core/interface/font/fontawesome-webfont.woff2?v=4.7.0" rel="preload"/>
<link href="https://epochmod.com/forum/uploads/css_built_19/341e4a57816af3ba440d891ca87450ff_framework.css" media="all" rel="stylesheet"/>
<link href="https://epochmod.com/forum/uploads/css_built_19/05e81b71abe4f22d6eb8d1a929494829_responsive.css" media="all" rel="stylesheet"/>
<link href="https://epochmod.com/forum/uploads/css_built_19/90eb5adf50a8c640f633d47fd7eb1778_core.css" media="all" rel="stylesheet"/>
<link href="https://epochmod.com/forum/uploads/css_built_19/5a0da001ccc2200dc5625c3f3934497d_core_responsive.css" media="all" rel="stylesheet"/>
<link href="https://epochmod.com/forum/uploads/css_built_19/62e269ced0fdab7e30e026f1d30ae516_forums.css" media="all" rel="stylesheet"/>
<link href="https://epochmod.com/forum/uploads/css_built_19/76e62c573090645fb99a15a363d8620e_forums_responsive.css" media="all" rel="stylesheet"/>
<link href="https://epochmod.com/forum/uploads/css_built_19/ebdea0c6a7dab6d37900b9190d3ac77b_topics.css" media="all" rel="stylesheet"/>
<link href="https://epochmod.com/forum/uploads/css_built_19/258adbb6e4f3e83cd3b355f84e3fa002_custom.css" media="all" rel="stylesheet"/>
<link href="https://epochmod.com/forum/uploads/monthly_2018_04/favicon.ico.c690be06d87a954c1dce2d924fe2a0f2.ico" rel="shortcut icon" type="image/x-icon"/>
</meta></meta></head>
<body class="ipsApp ipsApp_front ipsJS_none ipsClearfix" data-controller="core.front.core.app" data-message="" data-pageapp="forums" data-pagecontroller="topic" data-pageid="27487" data-pagelocation="front" data-pagemodule="forums">
<a accesskey="m" class="ipsHide" href="#ipsLayout_mainArea" title="Go to main content on this page">Jump to content</a>
<div class="ipsClearfix" id="ipsLayout_header">
<header>
<div class="ipsLayout_container">
<a accesskey="1" href="../../index.html" id="elLogo"><img alt="Epoch Mod Community" src="https://epochmod.com/forum/uploads/monthly_2023_04/text_only.png.512d7d1c1eb3e42e7aae78351fa37e02.png"/></a>
<ul class="ipsList_inline cSignedOut ipsResponsive_showDesktop" id="elUserNav">
<li id="elSignInLink">
<a data-ipsmenu="" data-ipsmenu-closeonclick="false" href="https://epochmod.com/forum/login/" id="elUserSignIn">
                    Existing user? Sign In  <i class="fa fa-caret-down"></i>
</a>
<div class="ipsMenu ipsMenu_auto ipsHide" id="elUserSignIn_menu">
<form accept-charset="utf-8" action="https://epochmod.com/forum/login/" method="post">
<input name="csrfKey" type="hidden" value="bbd96aef55be1a90d685e56a4524d73a"/>
<input name="ref" type="hidden" value="aHR0cHM6Ly9kNDIyLmVwb2NobW9kLmNvbS9mb3J1bS90b3BpYy8yNzQ4Ny1pbnZlbnRvcnktcm9sbGJhY2tzLw=="/>
<div data-role="loginForm">
<div class="ipsPad ipsForm ipsForm_vertical">
<h4 class="ipsType_sectionHead">Sign In</h4>
<br/><br/>
<ul class="ipsList_reset">
<li class="ipsFieldRow ipsFieldRow_noLabel ipsFieldRow_fullWidth">
<input autocomplete="email" name="auth" placeholder="Display Name or Email Address" type="text"/>
</li>
<li class="ipsFieldRow ipsFieldRow_noLabel ipsFieldRow_fullWidth">
<input autocomplete="current-password" name="password" placeholder="Password" type="password"/>
</li>
<li class="ipsFieldRow ipsFieldRow_checkbox ipsClearfix">
<span class="ipsCustomInput">
<input aria-checked="true" checked="" id="remember_me_checkbox" name="remember_me" type="checkbox" value="1"/>
<span></span>
</span>
<div class="ipsFieldRow_content">
<label class="ipsFieldRow_label" for="remember_me_checkbox">Remember me</label>
<span class="ipsFieldRow_desc">Not recommended on shared computers</span>
</div>
</li>
<li class="ipsFieldRow ipsFieldRow_fullWidth">
<button class="ipsButton ipsButton_primary ipsButton_small" id="elSignIn_submit" name="_processLogin" type="submit" value="usernamepassword">Sign In</button>
<p class="ipsType_right ipsType_small">
<a data-ipsdialog="" data-ipsdialog-title="Forgot your password?" href="https://epochmod.com/forum/lostpassword/">
					
					Forgot your password?</a>
</p>
</li>
</ul>
</div>
</div>
</form>
</div>
</li>
</ul>
<ul class="ipsMobileHamburger ipsList_reset ipsResponsive_hideDesktop">
<li data-ipsdrawer="" data-ipsdrawer-drawerelem="#elMobileDrawer">
<a href="#">
<i class="fa fa-navicon"></i>
</a>
</li>
</ul>
</div>
</header>
<nav class="ipsResponsive_showDesktop" data-controller="core.front.core.navBar">
<div class="ipsNavBar_primary ipsLayout_container">
<ul class="ipsClearfix" data-role="primaryNavBar">
<li data-navapp="core" data-navext="CustomItem" data-role="navBarItem" id="elNavSecondary_18">
<a data-navitem-id="18" href="http://epochmod.com/">
					Home<span class="ipsNavBar_active__identifier"></span>
</a>
</li>
<li data-navapp="cms" data-navext="Pages" data-role="navBarItem" id="elNavSecondary_12">
<a data-navitem-id="12" href="https://epochmod.com/forum/projects/">
					Downloads<span class="ipsNavBar_active__identifier"></span>
</a>
</li>
<li class="ipsNavBar_active" data-active="" data-navapp="forums" data-navext="Forums" data-role="navBarItem" id="elNavSecondary_8">
<a data-navdefault="" data-navitem-id="8" href="../../index.html">
					Forums<span class="ipsNavBar_active__identifier"></span>
</a>
</li>
<li data-navapp="core" data-navext="CustomItem" data-role="navBarItem" id="elNavSecondary_13">
<a data-navitem-id="13" href="http://epochmod.gamepedia.com/" rel="noopener" target="_blank">
					Wiki<span class="ipsNavBar_active__identifier"></span>
</a>
</li>
<li data-navapp="core" data-navext="CustomItem" data-role="navBarItem" id="elNavSecondary_1">
<a data-navitem-id="1" href="../../index.html">
					Browse<span class="ipsNavBar_active__identifier"></span>
</a>
<ul class="ipsNavBar_secondary ipsHide" data-role="secondaryNavBar">
<li data-navapp="core" data-navext="StaffDirectory" data-role="navBarItem" id="elNavSecondary_10">
<a data-navitem-id="10" href="https://epochmod.com/forum/staff/">
					Staff<span class="ipsNavBar_active__identifier"></span>
</a>
</li>
<li data-navapp="core" data-navext="OnlineUsers" data-role="navBarItem" id="elNavSecondary_11">
<a data-navitem-id="11" href="https://epochmod.com/forum/online/">
					Online Users<span class="ipsNavBar_active__identifier"></span>
</a>
</li>
<li class="ipsHide" data-role="navMore" id="elNavigationMore_1">
<a data-ipsmenu="" data-ipsmenu-appendto="#elNavigationMore_1" href="#" id="elNavigationMore_1_dropdown">More <i class="fa fa-caret-down"></i></a>
<ul class="ipsHide ipsMenu ipsMenu_auto" data-role="moreDropdown" id="elNavigationMore_1_dropdown_menu"></ul>
</li>
</ul>
</li>
<li data-navapp="core" data-navext="CustomItem" data-role="navBarItem" id="elNavSecondary_2">
<a data-navitem-id="2" href="https://epochmod.com/forum/discover/">
					Activity<span class="ipsNavBar_active__identifier"></span>
</a>
<ul class="ipsNavBar_secondary ipsHide" data-role="secondaryNavBar">
<li data-navapp="core" data-navext="AllActivity" data-role="navBarItem" id="elNavSecondary_3">
<a data-navitem-id="3" href="https://epochmod.com/forum/discover/">
					All Activity<span class="ipsNavBar_active__identifier"></span>
</a>
</li>
<li data-navapp="core" data-navext="YourActivityStreams" data-role="navBarItem" id="elNavSecondary_4">
<a data-navitem-id="4" href="#">
					My Activity Streams<span class="ipsNavBar_active__identifier"></span>
</a>
</li>
<li data-navapp="core" data-navext="YourActivityStreamsItem" data-role="navBarItem" id="elNavSecondary_5">
<a data-navitem-id="5" href="https://epochmod.com/forum/discover/unread/">
					Unread Content<span class="ipsNavBar_active__identifier"></span>
</a>
</li>
<li data-navapp="core" data-navext="YourActivityStreamsItem" data-role="navBarItem" id="elNavSecondary_6">
<a data-navitem-id="6" href="https://epochmod.com/forum/discover/content-started/">
					Content I Started<span class="ipsNavBar_active__identifier"></span>
</a>
</li>
<li data-navapp="core" data-navext="Search" data-role="navBarItem" id="elNavSecondary_7">
<a data-navitem-id="7" href="https://epochmod.com/forum/search/">
					Search<span class="ipsNavBar_active__identifier"></span>
</a>
</li>
<li class="ipsHide" data-role="navMore" id="elNavigationMore_2">
<a data-ipsmenu="" data-ipsmenu-appendto="#elNavigationMore_2" href="#" id="elNavigationMore_2_dropdown">More <i class="fa fa-caret-down"></i></a>
<ul class="ipsHide ipsMenu ipsMenu_auto" data-role="moreDropdown" id="elNavigationMore_2_dropdown_menu"></ul>
</li>
</ul>
</li>
<li data-navapp="core" data-navext="Leaderboard" data-role="navBarItem" id="elNavSecondary_19">
<a data-navitem-id="19" href="https://epochmod.com/forum/leaderboard/">
					Leaderboard<span class="ipsNavBar_active__identifier"></span>
</a>
</li>
<li class="ipsHide" data-role="navMore" id="elNavigationMore">
<a data-ipsmenu="" data-ipsmenu-appendto="#elNavigationMore" href="#" id="elNavigationMore_dropdown">More</a>
<ul class="ipsNavBar_secondary ipsHide" data-role="secondaryNavBar">
<li class="ipsHide" data-role="navMore" id="elNavigationMore_more">
<a data-ipsmenu="" data-ipsmenu-appendto="#elNavigationMore_more" href="#" id="elNavigationMore_more_dropdown">More <i class="fa fa-caret-down"></i></a>
<ul class="ipsHide ipsMenu ipsMenu_auto" data-role="moreDropdown" id="elNavigationMore_more_dropdown_menu"></ul>
</li>
</ul>
</li>
</ul>
<div id="elSearchWrapper">
<div data-controller="core.front.core.quickSearch" id="elSearch">
<form accept-charset="utf-8" action="http://epochmod.com/forum/search/?do=quicksearch" method="post">
<input aria-label="Search" autocomplete="off" id="elSearchField" name="q" placeholder="Search..." type="search"/>
<details class="cSearchFilter">
<summary class="cSearchFilter__text"></summary>
<ul class="cSearchFilter__menu">
<li><label><input name="type" type="radio" value="all"/><span class="cSearchFilter__menuText">Everywhere</span></label></li>
<li><label><input checked="" name="type" type="radio" value='contextual_{"type":"forums_topic","nodes":50}'/><span class="cSearchFilter__menuText">This Forum</span></label></li>
<li><label><input checked="" name="type" type="radio" value='contextual_{"type":"forums_topic","item":27487}'/><span class="cSearchFilter__menuText">This Topic</span></label></li>
<li><label><input name="type" type="radio" value="core_statuses_status"/><span class="cSearchFilter__menuText">Status Updates</span></label></li>
<li><label><input name="type" type="radio" value="forums_topic"/><span class="cSearchFilter__menuText">Topics</span></label></li>
<li><label><input name="type" type="radio" value="cms_pages_pageitem"/><span class="cSearchFilter__menuText">Pages</span></label></li>
<li><label><input name="type" type="radio" value="cms_records1"/><span class="cSearchFilter__menuText">Article</span></label></li>
<li><label><input name="type" type="radio" value="core_members"/><span class="cSearchFilter__menuText">Members</span></label></li>
</ul>
</details>
<button aria-label="Search" class="cSearchSubmit" type="submit"><i class="fa fa-search"></i></button>
</form>
</div>
</div>
</div>
</nav>
<ul class="ipsResponsive_hideDesktop" data-controller="core.front.core.mobileNav" id="elMobileNav">
<li id="elMobileBreadcrumb">
<a href="../../forum/50-epoch-linux-server/index.html">
<span>Epoch Linux Server</span>
</a>
</li>
<li>
<a data-action="defaultStream" href="https://epochmod.com/forum/discover/"><i aria-hidden="true" class="fa fa-newspaper-o"></i></a>
</li>
<li class="ipsJS_show">
<a href="https://epochmod.com/forum/search/"><i class="fa fa-search"></i></a>
</li>
</ul>
</div>
<main class="ipsLayout_container" id="ipsLayout_body">
<div id="ipsLayout_contentArea">
<div id="ipsLayout_contentWrapper">
<nav class="ipsBreadcrumb ipsBreadcrumb_top ipsFaded_withHover">
<ul class="ipsList_inline ipsPos_right">
<li>
<a class="ipsType_light" data-action="defaultStream" href="https://epochmod.com/forum/discover/"><i aria-hidden="true" class="fa fa-newspaper-o"></i> <span>All Activity</span></a>
</li>
</ul>
<ul data-role="breadcrumbList">
<li>
<a href="../../index.html" title="Home">
<span>Home <i class="fa fa-angle-right"></i></span>
</a>
</li>
<li>
<a href="../../forum/1-arma-2/index.html">
<span>ArmA 2 <i aria-hidden="true" class="fa fa-angle-right"></i></span>
</a>
</li>
<li>
<a href="../../forum/63-a2-community-projects/index.html">
<span>A2: Community Projects <i aria-hidden="true" class="fa fa-angle-right"></i></span>
</a>
</li>
<li>
<a href="../../forum/50-epoch-linux-server/index.html">
<span>Epoch Linux Server <i aria-hidden="true" class="fa fa-angle-right"></i></span>
</a>
</li>
<li>
				
					Inventory Rollbacks
				
			</li>
</ul>
</nav>
<div id="ipsLayout_mainArea">
<div class="ipsPageHeader ipsResponsive_pull ipsBox ipsPadding sm:ipsPadding:half ipsMargin_bottom">
<div class="ipsFlex ipsFlex-ai:center ipsFlex-fw:wrap ipsGap:4">
<div class="ipsFlex-flex:11">
<h1 class="ipsType_pageTitle ipsContained_container">
<span class="ipsType_break ipsContained">
<span>Inventory Rollbacks</span>
</span>
</h1>
</div>
</div>
<hr class="ipsHr"/>
<div class="ipsPageHeader__meta ipsFlex ipsFlex-jc:between ipsFlex-ai:center ipsFlex-fw:wrap ipsGap:3">
<div class="ipsFlex-flex:11">
<div class="ipsPhotoPanel ipsPhotoPanel_mini ipsPhotoPanel_notPhone ipsClearfix">
<a class="ipsUserPhoto ipsUserPhoto_mini" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/15715-backtrack/?do=hovercard" data-ipshover-width="370" href="../../profile/15715-backtrack/index.html" rel="nofollow" title="Go to Backtrack's profile">
<img alt="Backtrack" loading="lazy" src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%201024%201024%22%20style%3D%22background%3A%2362a8c4%22%3E%3Cg%3E%3Ctext%20text-anchor%3D%22middle%22%20dy%3D%22.35em%22%20x%3D%22512%22%20y%3D%22512%22%20fill%3D%22%23ffffff%22%20font-size%3D%22700%22%20font-family%3D%22-apple-system%2C%20BlinkMacSystemFont%2C%20Roboto%2C%20Helvetica%2C%20Arial%2C%20sans-serif%22%3EB%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fsvg%3E"/>
</a>
<div>
<p class="ipsType_reset ipsType_blendLinks">
<span class="ipsType_normal">
<strong>By 


<a class="ipsType_break" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/15715-backtrack/?do=hovercard&amp;referrer=https%253A%252F%252Fepochmod.com%252Fforum%252Ftopic%252F27487-inventory-rollbacks%252F" data-ipshover-width="370" href="../../profile/15715-backtrack/index.html" rel="nofollow" title="Go to Backtrack's profile">Backtrack</a></strong><br/><span class="ipsType_light"><time data-short="10 yr" datetime="2014-11-01T13:07:40Z" title="11/01/14 01:07  PM">November 1, 2014</time> in <a href="../../forum/50-epoch-linux-server/index.html">Epoch Linux Server</a></span>
</span>
</p>
</div>
</div>
</div>
<div class="ipsFlex-flex:01 ipsResponsive_hidePhone">
<div class="ipsShareLinks">
<a class="ipsShareButton ipsButton ipsButton_verySmall ipsButton_link ipsButton_link--light" data-ipsmenu="" href="#elShareItem_menu" id="elShareItem">
<span><i class="fa fa-share-alt"></i></span>  Share
    </a>
<div class="ipsPadding ipsMenu ipsMenu_auto ipsHide" data-controller="core.front.core.sharelink" id="elShareItem_menu">
<ul class="ipsList_inline">
<li>
<a class="cShareLink cShareLink_twitter" data-ipstooltip="" data-role="shareLink" href="https://twitter.com/share?url=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F" rel="nofollow noopener" target="_blank" title="Share on Twitter">
<i class="fa fa-twitter"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_facebook" data-ipstooltip="" data-role="shareLink" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F" rel="noopener nofollow" target="_blank" title="Share on Facebook">
<i class="fa fa-facebook"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_reddit" data-ipstooltip="" href="https://www.reddit.com/submit?url=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F&amp;title=Inventory+Rollbacks" rel="nofollow noopener" target="_blank" title="Share on Reddit">
<i class="fa fa-reddit"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_pinterest" data-ipstooltip="" data-role="shareLink" href="https://pinterest.com/pin/create/button/?url=https://epochmod.com/forum/topic/27487-inventory-rollbacks/&amp;media=https://epochmod.com/forum/uploads/monthly_2018_04/logo_only_black.png.c85695b79cad231dd136cd63c4db8256.png" rel="nofollow noopener" target="_blank" title="Share on Pinterest">
<i class="fa fa-pinterest"></i>
</a></li>
</ul>
<hr class="ipsHr"/>
<button class="ipsHide ipsButton ipsButton_verySmall ipsButton_light ipsButton_fullWidth ipsMargin_top:half" data-controller="core.front.core.webshare" data-role="webShare" data-websharetext="Inventory Rollbacks" data-websharetitle="Inventory Rollbacks" data-webshareurl="https://epochmod.com/forum/topic/27487-inventory-rollbacks/">More sharing options...</button>
</div>
<div data-controller="core.front.core.followButton" data-followapp="forums" data-followarea="topic" data-followid="27487">
<a class="ipsFollow ipsPos_middle ipsButton ipsButton_light ipsButton_verySmall ipsButton_disabled" data-ipstooltip="" data-role="followButton" href="https://epochmod.com/forum/login/" rel="nofollow" title="Sign in to follow this">
<span>Followers</span>
<span class="ipsCommentCount">0</span>
</a>
</div>
</div>
</div>
</div>
</div>
<div class="ipsClearfix">
<ul class="ipsToolList ipsToolList_horizontal ipsClearfix ipsSpacer_both ipsResponsive_hidePhone">
</ul>
</div>
<div class="cTopic ipsClear ipsSpacer_top" data-autopoll="" data-baseurl="https://epochmod.com/forum/topic/27487-inventory-rollbacks/" data-controller="core.front.core.commentFeed,forums.front.topic.view, core.front.core.ignoredComments" data-feedid="topic-27487" data-lastpage="" id="comments">
<div class="ipsRecommendedComments ipsHide" data-controller="core.front.core.recommendedComments" data-url="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?recommended=comments">
<div data-role="recommendedComments">
<h2 class="ipsType_sectionHead ipsType_large ipsType_bold ipsMargin_bottom">Recommended Posts</h2>
</div>
</div>
<div data-controller="core.front.core.moderation" data-role="commentFeed" id="elPostFeed">
<form action="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?csrfKey=bbd96aef55be1a90d685e56a4524d73a&amp;do=multimodComment" data-ipspageaction="" data-role="moderationTools" method="post">
<a id="comment-162320"></a>
<article class="cPost ipsBox ipsResponsive_pull ipsComment ipsComment_parent ipsClearfix ipsClear ipsColumns ipsColumns_noSpacing ipsColumns_collapsePhone" id="elComment_162320">
<div class="cAuthorPane_mobile ipsResponsive_showPhone">
<div class="cAuthorPane_photo">
<div class="cAuthorPane_photoWrap">
<a class="ipsUserPhoto ipsUserPhoto_large" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/15715-backtrack/?do=hovercard" data-ipshover-width="370" href="../../profile/15715-backtrack/index.html" rel="nofollow" title="Go to Backtrack's profile">
<img alt="Backtrack" loading="lazy" src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%201024%201024%22%20style%3D%22background%3A%2362a8c4%22%3E%3Cg%3E%3Ctext%20text-anchor%3D%22middle%22%20dy%3D%22.35em%22%20x%3D%22512%22%20y%3D%22512%22%20fill%3D%22%23ffffff%22%20font-size%3D%22700%22%20font-family%3D%22-apple-system%2C%20BlinkMacSystemFont%2C%20Roboto%2C%20Helvetica%2C%20Arial%2C%20sans-serif%22%3EB%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fsvg%3E"/>
</a>
<a href="../../profile/15715-backtrack/badges/index.html" rel="nofollow">
<img alt="Newbie" class="cAuthorPane_badge cAuthorPane_badge--rank ipsOutline ipsOutline:2px" data-ipstooltip="" loading="lazy" src="https://epochmod.com/forum/uploads/monthly_2023_04/1_Newbie.svg" title="Rank: Newbie (1/14)"/>
</a>
</div>
</div>
<div class="cAuthorPane_content">
<h3 class="ipsType_sectionHead cAuthorPane_author ipsType_break ipsType_blendLinks ipsFlex ipsFlex-ai:center">
<a class="ipsType_break" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/15715-backtrack/?do=hovercard&amp;referrer=https%253A%252F%252Fepochmod.com%252Fforum%252Ftopic%252F27487-inventory-rollbacks%252F" data-ipshover-width="370" href="../../profile/15715-backtrack/index.html" rel="nofollow" title="Go to Backtrack's profile"><span style="color:#">Backtrack</span></a>
</h3>
<div class="ipsType_light ipsType_reset">
<a class="ipsType_blendLinks" href="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=162320" rel="nofollow">Posted <time data-short="10 yr" datetime="2014-11-01T13:07:40Z" title="11/01/14 01:07  PM">November 1, 2014</time></a>
</div>
</div>
</div>
<aside class="ipsComment_author cAuthorPane ipsColumn ipsColumn_medium ipsResponsive_hidePhone">
<h3 class="ipsType_sectionHead cAuthorPane_author ipsType_blendLinks ipsType_break"><strong>
<a class="ipsType_break" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/15715-backtrack/?do=hovercard&amp;referrer=https%253A%252F%252Fepochmod.com%252Fforum%252Ftopic%252F27487-inventory-rollbacks%252F" data-ipshover-width="370" href="../../profile/15715-backtrack/index.html" rel="nofollow" title="Go to Backtrack's profile">Backtrack</a></strong>
</h3>
<ul class="cAuthorPane_info ipsList_reset">
<li class="cAuthorPane_photo" data-role="photo">
<div class="cAuthorPane_photoWrap">
<a class="ipsUserPhoto ipsUserPhoto_large" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/15715-backtrack/?do=hovercard" data-ipshover-width="370" href="../../profile/15715-backtrack/index.html" rel="nofollow" title="Go to Backtrack's profile">
<img alt="Backtrack" loading="lazy" src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%201024%201024%22%20style%3D%22background%3A%2362a8c4%22%3E%3Cg%3E%3Ctext%20text-anchor%3D%22middle%22%20dy%3D%22.35em%22%20x%3D%22512%22%20y%3D%22512%22%20fill%3D%22%23ffffff%22%20font-size%3D%22700%22%20font-family%3D%22-apple-system%2C%20BlinkMacSystemFont%2C%20Roboto%2C%20Helvetica%2C%20Arial%2C%20sans-serif%22%3EB%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fsvg%3E"/>
</a>
<img alt="Newbie" class="cAuthorPane_badge cAuthorPane_badge--rank ipsOutline ipsOutline:2px" data-ipstooltip="" loading="lazy" src="https://epochmod.com/forum/uploads/monthly_2023_04/1_Newbie.svg" title="Rank: Newbie (1/14)"/>
</div>
</li>
<li data-role="group"><span style="color:#">Member</span></li>
<li class="ipsMargin_top" data-role="stats">
<ul class="ipsList_reset ipsType_light ipsFlex ipsFlex-ai:center ipsFlex-jc:center ipsGap_row:2 cAuthorPane_stats">
<li>
<a class="ipsType_blendLinks" data-ipstooltip="" href="../../profile/15715-backtrack/content/index.html" rel="nofollow" title="154 posts">
<i class="fa fa-comment"></i> 154
							
								</a>
</li>
</ul>
</li>
</ul>
</aside>
<div class="ipsColumn ipsColumn_fluid ipsMargin:none">
<div class="ipsComment_content ipsType_medium" data-commentapp="forums" data-commentid="162320" data-commenttype="forums" data-controller="core.front.core.comment" data-quotedata='{"userid":15715,"username":"Backtrack","timestamp":1414847260,"contentapp":"forums","contenttype":"forums","contentid":27487,"contentclass":"forums_Topic","contentcommentid":162320}' id="comment-162320_wrap">
<div class="ipsComment_meta ipsType_light ipsFlex ipsFlex-ai:center ipsFlex-jc:between ipsFlex-fd:row-reverse">
<div class="ipsType_light ipsType_reset ipsType_blendLinks ipsComment_toolWrap">
<div class="ipsResponsive_hidePhone ipsComment_badges">
<ul class="ipsList_reset ipsFlex ipsFlex-jc:end ipsFlex-fw:wrap ipsGap:2 ipsGap_row:1">
</ul>
</div>
<ul class="ipsList_reset ipsComment_tools">
<li>
<a class="ipsComment_ellipsis" data-ipsmenu="" data-ipsmenu-appendto="#comment-162320_wrap" href="#elControls_162320_menu" id="elControls_162320" title="More options..."><i class="fa fa-ellipsis-h"></i></a>
<ul class="ipsMenu ipsMenu_narrow ipsHide" id="elControls_162320_menu">
<li class="ipsMenu_item"><a data-action="reportComment" data-ipsdialog="" data-ipsdialog-flashmessage="Thanks for your report." data-ipsdialog-remotesubmit="" data-ipsdialog-size="medium" data-ipsdialog-title="Report post" href="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=reportComment&amp;comment=162320" title="Report this content">Report</a></li>
<li class="ipsMenu_item"><a data-ipsdialog="" data-ipsdialog-content="#elShareComment_162320_menu" data-ipsdialog-size="narrow" data-ipsdialog-title="Share this post" data-role="shareComment" href="index.html" id="elSharePost_162320" title="Share this post">Share</a></li>
</ul>
</li>
</ul>
</div>
<div class="ipsType_reset ipsResponsive_hidePhone">
<a class="ipsType_blendLinks" href="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=162320" rel="nofollow">Posted <time data-short="10 yr" datetime="2014-11-01T13:07:40Z" title="11/01/14 01:07  PM">November 1, 2014</time></a>
<span class="ipsResponsive_hidePhone">
</span>
</div>
</div>
<div class="cPost_contentWrap">
<div class="ipsType_normal ipsType_richText ipsPadding_bottom ipsContained" data-controller="core.front.core.lightboxedImages" data-role="commentContent">
<p>Hello Guys need some help</p>
<p>some Player notall have the Rollback Problem if they relog</p>
<pre class="ipsCode prettyprint">
#!/usr/bin/perl
#
# Copyright 2013 by Denis Erygin,
# <a class="__cf_email__" data-cfemail="9afefff4f3e9b4ffe8e3fdf3f4dafdf7fbf3f6b4f9f5f7" href="https://epochmod.com/cdn-cgi/l/email-protection">[email protected]</a>
#

use warnings;
use strict;

use constant PORT      =&gt; 2302; # Change it with epoch.sh
use constant PATH      =&gt; $ENV{'PWD'}.'/'; # Set your epoch server dir
use constant PIDFILE   =&gt; PATH.PORT.'.pid';
use constant CACHE_DIR =&gt; PATH.'cache/players';

unless (-f PATH.'epoch') {
    print STDERR "Can't found server binary!\n";
    exit;
}

set_time  ();
logrotate ();

if (-f PIDFILE) {
    open  (IN, '&lt;'.PIDFILE) or die "Can't open: $!";
    my $pid = int(&lt;IN&gt;);
    close (IN);

    `sync`;
    my $res = `kill -SIGINT $pid 2&gt;&amp;1`;
    print STDERR $res,"\n" if $res;
   
    unlink (PIDFILE) if (-f PIDFILE);    
    backup_cache();
}

print STDERR "Restart Dayz Epoch server...\n";
chdir (PATH);

my $cmd = '/usr/bin/screen -h 20000 -fa -d -m -S epoch '.PATH.'epoch.sh';
my $res = `$cmd`;
print STDERR $res,"\n" if $res;
exit;

#-----------------------------------------------------------------------------------------------
sub set_time {
    my ($s, $m, $h, $day, $mon, $y) = localtime(time() - 0*3600);
    $y += 1900;
    $mon++;
    
    # Uncomment to disabe night
    ($h, $m) = (17, 0) if ($h &gt; 17 || ($h &gt;= 0 &amp;&amp; $h &lt; 4));
    
    my $file = PATH.'cache/set_time.sqf';
    open  (IN, "&gt;$file") or die "Can't find $file";
    # ["PASS", [year, month, day, hour, minute]]
    print IN '["PASS",[2012,6,6,'.$h.','.$m.']]'; # with full moon
    close (IN);
}

sub logrotate {
    my $log = PATH.'dump.log';
    if (-f $log) {
        my ($dev,$ino,$mode,$nlink,$uid,$gid,$rdev,$size) = stat($log);
    
        if ($size &amp;&amp; $size &gt;= 100000000) {
            print STDERR "logrotate $size\n";
        
            my $nlog = $log.'.'.time();
            my $res  = `cp $log $nlog 2&gt;&amp;1`;
            print STDERR $res,"\n" if $res;
        
            $res = `echo '' &gt; $log 2&gt;&amp;1`;
            print STDERR $res,"\n" if $res;
        }
    }
}

sub backup_cache {
    return unless (-d CACHE_DIR);
    opendir (DIR, CACHE_DIR) or die $!;

    while (my $file = readdir (DIR)) {
        next unless ($file =~ m/^\d+$/ &amp;&amp; $file ne '1');
        my $dir    = CACHE_DIR.'/'.$file;
        my $backup = CACHE_DIR.'/1';
        next unless (-d $dir);
        
        my $res = `mv -f $dir $backup 2&gt;&amp;1`;
        print STDERR $res,"\n" if $res;
    }

    closedir (DIR);
}


</pre>
<pre class="ipsCode prettyprint">
#!/usr/bin/perl
#
# Copyright 2014 by Denis Erygin,
# <a class="__cf_email__" data-cfemail="462223282f356823343f212f2806212b272f2a6825292b" href="https://epochmod.com/cdn-cgi/l/email-protection">[email protected]</a>
#

use JSON::XS;
use DBI;
use warnings;
use strict;

use constant {
    INSTANCE  =&gt; 13,          # Chernarus instance
    DB_NAME   =&gt; '*******',     # Set database name
    DB_LOGIN  =&gt; '*****',      # Set database login
    DB_PASSWD =&gt; '*****',      # Set database password
    DB_HOST   =&gt; 'localhost', # Set database host
    DB_PORT   =&gt; 3306,        # Set database port (default 3306)

   CACHE_DIR =&gt; $ENV{'PWD'}.'/cache/',
    # Start inventory of player
    INVENTORY =&gt; '[[],[]]',
    BACKPACK  =&gt; '["",[],[]]',
    MODEL     =&gt; '"Survivor2_DZ"'
};

my %cid_inv = ();
my %obj_inv = ();

my $myPlayerCounter = 1;

my %FN_IPC  = (
    11  =&gt; \&amp;h_player_counter,
    21  =&gt; \&amp;h_player_split_inventory,
    22  =&gt; \&amp;h_player_split_backpack,
    31  =&gt; \&amp;h_object_change_lock_code,
    33  =&gt; \&amp;h_object_split_inventory,
    39  =&gt; \&amp;h_object_uid_split_inventory,
    101 =&gt; \&amp;h_load_player,
	102 =&gt; \&amp;h_load_character,
    103 =&gt; \&amp;h_log_login,
    201 =&gt; \&amp;h_player_update,
    202 =&gt; \&amp;h_player_death,
    204 =&gt; \&amp;h_player_disconnect,
	298 =&gt; \&amp;h_load_bank,
	299 =&gt; \&amp;h_bank_update,
    303 =&gt; \&amp;h_object_update_inventory,
    304 =&gt; \&amp;h_object_delete,
    305 =&gt; \&amp;h_vehicle_moved,
    306 =&gt; \&amp;h_vehicle_damaged,
    308 =&gt; \&amp;h_object_publish,
    309 =&gt; \&amp;h_object_uid_update_inventory,
    310 =&gt; \&amp;h_object_uid_delete,
    396 =&gt; \&amp;h_object_reset_damage,
    397 =&gt; \&amp;h_object_uid_reset_damage,
    398 =&gt; \&amp;h_trade_object,
);

my $dbh   = connect_to_db();
my $coder = JSON::XS-&gt;new-&gt;ascii(1)-&gt;shrink(1)-&gt;allow_nonref(1)-&gt;max_depth(5)-&gt;max_size(1048576);

mkdir (CACHE_DIR) unless (-d CACHE_DIR);

init_traders           ();
init_objects_id        ();
init_objects           ();
init_default_player    ();
init_default_character ();
init_default_bank      ();
update_players_cache   ();

open (LOG, "&gt;&gt;dump.log") or die $!;
while (&lt;STDIN&gt;) {
    next if ($_ =~ m/Duplicate magazine/ || $_ =~ m/arrived from nonowner/);
    print STDERR $_;
    print LOG $_;

    if ($_ =~ m/CHILD:/) {
        chop;
        my ($pref, $data) = split /CHILD:/ =&gt; $_;
        my @arr = split /:/ =&gt; $data;
        my $cmd = $arr[0];
        next unless $cmd;
        
        my $fn = $FN_IPC{$cmd};
        $fn-&gt;(\@arr) if $fn;
    } else {
        init_login_uid ($_);
    }
}
close(LOG);

$dbh-&gt;disconnect;
exit;

#---------------------------------------------------------------------------
sub connect_to_db {
    my $dbh = DBI-&gt;connect('dbi:mysql:'.DB_NAME.':'.DB_HOST.':'.DB_PORT, DB_LOGIN, DB_PASSWD,
              {'PrintError' =&gt; 1, 'RaiseError' =&gt; 1, 'AutoCommit' =&gt; 1})
              or die "Can't connect to mysql: $!";
    $dbh-&gt;{'mysql_auto_reconnect'} = 1;
    return $dbh;
}

sub parse_json {
    my $str = shift;
    return unless $str;
    
    my $data;
    eval { $data = $coder-&gt;decode ($str); };
    return if $@;
    return $data;
}

sub init_traders {
    h_load_trader_details();
}

sub init_objects_id {
    h_load_objects_id();
}

sub init_objects {
    h_stream_objects();
}

sub init_default_player {
    my $file = CACHE_DIR.'default.sqf';
    open  (OUT, "&gt;$file") or die "Can't open '$file'";
    print OUT '["PASS",false,"1",[],'.INVENTORY.','.BACKPACK.',[0,0,0],'.MODEL.',0.96,0]';
    close (OUT);
}

sub init_default_character {
    my $file = CACHE_DIR.'default-char.sqf';
    open  (OUT, "&gt;$file") or die "Can't open '$file'";
    print OUT '["PASS",[],[0,0,0,0],[],[],2500,"1",0]';
    close (OUT);
}

sub init_default_bank {
    my $file = CACHE_DIR.'default-bank.sqf';
    open  (OUT, "&gt;$file") or die "Can't open '$file'";
    print OUT '["PASS",0]';
    close (OUT);
}

sub update_players_cache {
    my $sql = 'SELECT PlayerUID FROM Player_DATA';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ();
    return unless $res;
    
    my $PLAYERS_DIR = CACHE_DIR.'players/'.$myPlayerCounter;
    mkdir ($PLAYERS_DIR) unless (-d $PLAYERS_DIR);
    
    my @uids = ();
    while (my ($playerId) = $sth-&gt;fetchrow_array) {
        next unless $playerId;
        my $file = $PLAYERS_DIR.'/'.lc($playerId).'.sqf';
        next if (-f $file);
    
        push @uids, $playerId;
    }
    $sth-&gt;finish;
    return unless @uids;
    
    for my $playerId (@uids) {
        update_player_cache ($playerId);
		update_bank_cache ($playerId);
    }
}

sub get_playerId_by_characterId {
    my $characterId = shift;
    return unless $characterId;
    
    my $sql = 'SELECT PlayerUID FROM Character_DATA WHERE CharacterID=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($characterId);
    return unless $res;
    
    my ($playerId) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;
    
    return $playerId;
}

sub update_player_cache {
    my $playerId = shift;
    return unless $playerId;

    my $sql = "SELECT CharacterID, Worldspace, Inventory, Backpack,
               TIMESTAMPDIFF(MINUTE, Datestamp, LastLogin) as SurvivalTime,
               TIMESTAMPDIFF(MINUTE, LastAte, NOW()) as MinsLastAte,
               TIMESTAMPDIFF(MINUTE, LastDrank, NOW()) as MinsLastDrank,
               Model, Humanity, KillsZ, HeadshotsZ, KillsH, KillsB, CurrentState, Medical, CashMoney 
               FROM Character_DATA
               WHERE PlayerUID=? AND Alive = 1 AND InstanceID=? ORDER BY CharacterID DESC LIMIT 1";
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($playerId, INSTANCE);
    #return unless $res;
    
    my ($characterId, $worldSpace, $inventory, $backpack, $survivalTime, $minsLastAte, $minsLastDrank, $model,
        $humanity, $killsZ, $headshotsZ, $killsH, $killsB, $currentState, $medical, $cashMoney) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;
    return unless (defined $characterId);
    
    my $survival = '[0,0,0]';
    $survival    = '['.$survivalTime.','.$minsLastAte.','.$minsLastDrank.']' if (defined $survivalTime &amp;&amp;
                                                                                 defined $minsLastAte  &amp;&amp;
                                                                                 defined $minsLastDrank);
    my $PLAYERS_DIR = CACHE_DIR.'players/'.$myPlayerCounter;
    mkdir ($PLAYERS_DIR) unless (-d $PLAYERS_DIR);
                                                                                 
    my $file = $PLAYERS_DIR.'/'.lc($playerId).'.sqf';
    open  (OUT, "&gt;$file") or print STDERR $!;
    print OUT '["PASS",false,"'.$characterId.'",'.$worldSpace.','.$inventory.','.$backpack.','.$survival.','.$model.',0.96]';
    close (OUT);
        
    my $stats = '[0,0,0,0]';
    $stats    = '['.$killsZ.','.$headshotsZ.','.$killsH.','.$killsB.']' if (defined $killsZ &amp;&amp; defined $headshotsZ &amp;&amp; defined $killsH &amp;&amp; defined $killsB);
    
    $file = $PLAYERS_DIR.'/'.lc($playerId).'-char.sqf';
    open  (OUT, "&gt;$file") or print STDERR $!;
    print OUT '["PASS",'.$medical.','.$stats.','.$currentState.','.$worldSpace.','.$humanity.',"'.$characterId.'",'.$cashMoney.']';
    close (OUT);
	
    return $characterId;
}

sub update_bank_cache {
    my $playerId = shift;
    return unless $playerId;

	my $sql = "SELECT BankSaldo
			   FROM Banking_DATA
		       WHERE PlayerUID=?";
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($playerId);
    
    my ($bankSaldo) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;
	return unless (defined $bankSaldo);

	my $PLAYERS_DIR = CACHE_DIR.'players/'.$myPlayerCounter;
    mkdir ($PLAYERS_DIR) unless (-d $PLAYERS_DIR);
	
    my $file = $PLAYERS_DIR.'/'.lc($playerId).'-bank.sqf';
    open  (OUT, "&gt;$file") or print STDERR $!;
    print OUT '["PASS",'.$bankSaldo.']';
    close (OUT);
	
	return $bankSaldo;
}

sub init_login_uid {
    my $dump = shift;
    return unless $dump;
        
    return unless ($dump =~ m/\sconnected/);
    return if ($dump =~ m/BattlEye Server: Player/);
    
    my ($p, $str)   = split (/Player\s/, $dump);
    return unless (defined $str);
    
    my ($name, $uid) = split (/\sconnected\s/, $str);
    return unless ($name &amp;&amp; $uid);
    
    #if ($uid =~ m/(\d+)/) {
    if ($uid =~ m/=(\w+)/) {
        $uid = $1;
    } 
    return unless $uid;
    print STDERR "$uid =&gt; $name\n";
    
    #my $PLAYERS_DIR = CACHE_DIR.'players/'.$myPlayerCounter;
    #my $file        = $PLAYERS_DIR.'/'.$uid.'.sqf';
    #return if (-e $file);

    h_load_player ([101, $uid, INSTANCE, $name]);
	print STDERR "EXECUTED h_load_player($uid): with name: $name\n";
	h_load_bank ([298, $uid, INSTANCE, $name]);
    print STDERR "EXECUTED h_load_bank($uid): with name: $name\n";
}

# 11
sub h_player_counter {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $counter) = @$p;
    return unless ($counter &amp;&amp; int($counter) &gt; 0);
    $counter = int($counter);
    
    my $old = CACHE_DIR.'players/'.$myPlayerCounter;
    my $new = CACHE_DIR.'players/'.$counter;
    if (-d $old) {
        rename ($old, $new);
    } else {
        print STDERR "Error h_player_counter($counter): old '$myPlayerCounter' not found!\n";
        mkdir ($new) or print STDERR $!,"\n";
    }
    
    $myPlayerCounter = $counter;
}

# 21
sub h_player_split_inventory {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $cid, $idx, $data) = @$p;
    unless ($cid &amp;&amp; defined $idx &amp;&amp; defined $data) {
        print STDERR "Error h_player_split_inventory(): characterId or idx or data undefined!\n";
        return;
    }

    unless ( parse_json ($data) ) {
        print STDERR "Error h_player_split_inventory(): data invalid json!\n";
        $cid_inv{$cid} = undef;
        return;
    }

    # Save weapons
    if ($idx == 0) {
        $cid_inv{$cid} = $data;
        return;
    }
    # Save weapons + magazines
    if ($idx == 1 &amp;&amp; $cid_inv{$cid}) {
        my $inv        = '['.$cid_inv{$cid}.','.$data.']';
        $cid_inv{$cid} = undef;
        print STDERR "Size plr inv: ".length($inv)."\n";

        unless ( parse_json($inv) ) {
            print STDERR "Error h_player_split_inventory(): inventory invalid json!\n";
            return;
        }

        my $sth = $dbh-&gt;prepare ('UPDATE Character_DATA SET Inventory=? WHERE CharacterID=?');
        my $res = $sth-&gt;execute ($cid, $inv);
        return $res;
    }
}

# 22
sub h_player_split_backpack {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $cid, $data) = @$p;
    unless ($cid &amp;&amp; defined $data) {
        print STDERR "Error h_player_split_backpack(): characterId or data undefined!\n";
        return;
    }

    unless ( parse_json ($data) ) {
        print STDERR "Error h_player_split_backpack(): backpack invalid json!\n";
        return;
    }
    return if ($data eq '[]');

    my $sth = $dbh-&gt;prepare ('UPDATE Character_DATA SET Backpack=? WHERE CharacterID=?');
    my $res = $sth-&gt;execute ($cid, $data);
    return $res;
}

# 31
sub h_object_change_lock_code {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $oid, $code) = @$p;
    unless ($oid &amp;&amp; $code) {
        print STDERR "Error h_object_change_lock_code(): objectId or code undefined!\n";
        return;
    }
    $oid =~ s/"//g;
    
    my $sth = $dbh-&gt;prepare ('UPDATE Object_DATA SET CharacterID=? WHERE ObjectID=? AND Instance=?');
    my $res = $sth-&gt;execute ($code, $oid, INSTANCE);
    return $res;
}

# 33
sub h_object_split_inventory {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $oid, $idx, $data) = @$p;
    unless ($oid &amp;&amp; defined $idx &amp;&amp; defined $data) {
        print STDERR "Error h_object_split_inventory(): objectId or idx or data undefined!\n";
        return;
    }
    $oid =~ s/"//g;

    unless ( parse_json ($data) ) {
        print STDERR "Error h_object_split_inventory($oid): data invalid json!\n";
        $obj_inv{$oid} = undef;
        return;
    }

    # Save weapons
    if ($idx == 0) {
        $obj_inv{$oid} = $data;
        return;
    }
    # Save weapons + magazines
    if ($idx == 1 &amp;&amp; $obj_inv{$oid}) {
        $obj_inv{$oid} .= ','.$data;
        return;
    }
    # Save weapons + magazines + backpack
    if ($idx == 2 &amp;&amp; $obj_inv{$oid}) {
        my $inv        = '['.$obj_inv{$oid}.','.$data.']';
        $obj_inv{$oid} = undef;
        print STDERR "Size obj inv: ".length($inv)."\n";

        unless ( parse_json($inv) ) {
            print STDERR "Error h_object_split_inventory($oid): inventory invalid json!\n";
            return;
        }

        my $sth = $dbh-&gt;prepare ('UPDATE Object_DATA SET Inventory=? WHERE ObjectID=? AND Instance=?');
        my $res = $sth-&gt;execute ($inv, $oid, INSTANCE);
        return $res;
    }
}

# 39
sub h_object_uid_split_inventory {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $uid, $idx, $data) = @$p;
    unless ($uid &amp;&amp; defined $idx &amp;&amp; defined $data) {
        print STDERR "Error h_object_uid_split_inventory(): objectUID or idx or data undefined!\n";
        return;
    }
    $uid =~ s/"//g;

    unless ( parse_json ($data) ) {
        print STDERR "Error h_object_uid_split_inventory($uid): data invalid json!\n";
        $obj_inv{$uid} = undef;
        return;
    }

    # Save weapons
    if ($idx == 0) {
        $obj_inv{$uid} = $data;
        return;
    }
    # Save weapons + magazines
    if ($idx == 1 &amp;&amp; $obj_inv{$uid}) {
        $obj_inv{$uid} .= ','.$data;
        return;
    }
    # Save weapons + magazines + backpack
    if ($idx == 2 &amp;&amp; $obj_inv{$uid}) {
        my $inv        = '['.$obj_inv{$uid}.','.$data.']';
        $obj_inv{$uid} = undef;
        print STDERR "Size obj uid inv: ".length($inv)."\n";

        unless ( parse_json($inv) ) {
            print STDERR "Error h_object_uid_split_inventory($uid): inventory invalid json!\n";
            return;
        }

        my $sth = $dbh-&gt;prepare ('UPDATE Object_DATA SET Inventory=? WHERE ObjectUID=? AND Instance=?');
        my $res = $sth-&gt;execute ($inv, $uid, INSTANCE);
        return $res;
    }
}

# 101
sub h_load_player {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $playerId, $serverId, $playerName) = @$p;
    unless ($playerId &amp;&amp; $serverId) {
        print STDERR "Error h_load_player(): playerId or serverId undefined!\n";
        return;
    }
    $playerId =~ s/['"]//g;
    $serverId ||= INSTANCE;
    
    my $PLAYERS_DIR = CACHE_DIR.'players/'.$myPlayerCounter;
    mkdir ($PLAYERS_DIR) unless (-d $PLAYERS_DIR);
    
    my $sql = 'SELECT PlayerName, PlayerSex FROM Player_DATA WHERE PlayerUID=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($playerId);
    
    my ($name, $sex) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;
    
    my $newPlayer = 0;
    if (defined $name) {
        if ($playerName &amp;&amp; $playerName ne $name) {
		
            $sql = 'UPDATE Player_DATA SET PlayerName=? WHERE PlayerUID=?';
            $sth = $dbh-&gt;prepare ($sql);
            $res = $sth-&gt;execute ($playerName, $playerId);
			
            print STDERR "Changed name of player $playerId from '$name' to '$playerName' in table Player_DATA\n";
        }
    } else {
        $newPlayer  = 1;
        $playerName = 'Unknown' unless $playerName;
        
        $sql = 'INSERT INTO Player_DATA(PlayerUID, PlayerName) VALUES (?, ?)';
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($playerId, $playerName);
		
        print STDERR "Created a new player $playerId named '$playerName' in table Player_DATA\n";
    }
    
    $sql = "SELECT CharacterID, Worldspace, Inventory, Backpack, 
            TIMESTAMPDIFF(MINUTE, Datestamp, LastLogin) as SurvivalTime,
            TIMESTAMPDIFF(MINUTE, LastAte, NOW()) as MinsLastAte, 
            TIMESTAMPDIFF(MINUTE, LastDrank, NOW()) as MinsLastDrank,
            Model, Medical, Humanity, KillsZ, HeadshotsZ, KillsH, KillsB, CurrentState, CashMoney  
            FROM  Character_DATA 
            WHERE PlayerUID=? AND Alive = 1 AND InstanceID=? ORDER BY CharacterID DESC LIMIT 1";
    $sth = $dbh-&gt;prepare ($sql);
    $res = $sth-&gt;execute ($playerId, $serverId);
    
    my ($characterId, $worldSpace, $inventory, $backpack, $survivalTime, $minsLastAte, $minsLastDrank, 
        $model, $medical, $humanity, $killsZ, $headshotsZ, $killsH, $killsB, $currentState, $cashMoney) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;
    
    $currentState = '[]'      unless (defined $currentState);
    $humanity     = 2500      unless (defined $humanity);
	$cashMoney    = 0         unless (defined $cashMoney);
    $medical      = '[]'      unless (defined $medical);
    $worldSpace   = '[]'      unless (defined $worldSpace);
    $inventory    = INVENTORY unless (defined $inventory);  # '[]'
    $backpack     = BACKPACK  unless (defined $backpack);   # '[]'
    $model        = MODEL     unless (defined $model);      # ''
    
    my $survival = '[0,0,0]';
    $survival    = '['.$survivalTime.','.$minsLastAte.','.$minsLastDrank.']' if (defined $survivalTime &amp;&amp; 
                                                                                 defined $minsLastAte  &amp;&amp; 
                                                                                 defined $minsLastDrank);
    my $newChar = 0;
    if (defined $characterId) {
        $sql = 'UPDATE Character_DATA SET LastLogin = CURRENT_TIMESTAMP WHERE CharacterID=?';
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($characterId);
        
        my $stats = '[0,0,0,0]';
        $stats    = '['.$killsZ.','.$headshotsZ.','.$killsH.','.$killsB.']' if (defined $killsZ &amp;&amp; defined $headshotsZ &amp;&amp;
                                                                                defined $killsH &amp;&amp; defined $killsB);        
        my $file = $PLAYERS_DIR.'/'.lc($playerId).'-char.sqf';
        open  (OUT, "&gt;$file");
        print OUT '["PASS",'.$medical.','.$stats.','.$currentState.','.$worldSpace.','.$humanity.',"'.$characterId.'",'.$cashMoney.']';
        close (OUT); 
    } else {
        $newChar = 1;
        
        $sql = "SELECT Generation, Humanity, Model FROM Character_DATA 
                WHERE PlayerUID=? AND Alive = 0 AND InstanceID=? ORDER BY CharacterID DESC LIMIT 1";
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($playerId, $serverId);
        
        my ($generation, $humanity, $cmodel) = $sth-&gt;fetchrow_array;
        $sth-&gt;finish;
        
        if (defined $generation) {
            $generation++;
        } else {
            $generation = 1;
        }
        
        $humanity     = 2500      unless (defined $humanity);
		$cashMoney    = 0         unless (defined $cashMoney);
        $model        = $cmodel   if (defined $cmodel); 
        
        $sql = "INSERT INTO Character_DATA(PlayerUID, InstanceID, Worldspace, Inventory, Backpack, Medical,
                                           Generation, Datestamp, LastLogin, LastAte, LastDrank, Humanity, CashMoney) 
                VALUES (?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?)";
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($playerId, $serverId, $worldSpace, $inventory, $backpack, $medical, $generation, $humanity, $cashMoney);
        
        $sql = 'SELECT CharacterID FROM Character_DATA WHERE PlayerUID=? AND Alive = 1 AND InstanceID=? ORDER BY CharacterID DESC LIMIT 1';
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($playerId, $serverId);
        
        ($characterId) = $sth-&gt;fetchrow_array;
        $sth-&gt;finish;
        
        $playerName = 'Unknown' unless $playerName;
        
        if (defined $characterId) {
            print STDERR "Created a new character $characterId for player '$playerName' ($playerId)\n";
            my $file = $PLAYERS_DIR.'/'.lc($playerId).'-char.sqf';
            open  (OUT, "&gt;$file");
            print OUT '["PASS",'.$medical.',[0,0,0,0],[],'.$worldSpace.','.$humanity.',"'.$characterId.'",'.$cashMoney.']';
            close (OUT);
        } else {
            print STDERR "Can't found new character for player '$playerName' ($playerId)\n";
        }
    }
    
    my $file = $PLAYERS_DIR.'/'.lc($playerId).'.sqf';
    open  (OUT, "&gt;$file");
    print OUT '["PASS",false,"'.$characterId.'",'.$worldSpace.','.$inventory.','.$backpack.','.$survival.','.$model.',0.96,'.$cashMoney.']';
    close (OUT);
    
    print STDERR "CHILD:101 Save player: $file\n";
    return $res;
}

# 102
sub h_load_character {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $characterId, $playerId) = @$p;
    unless ($characterId) {
        print STDERR "Error h_load_character(): characterId undefined!\n";
        return;
    }
    $characterId =~ s/"//g;
    $playerId    =~ s/['"]//g;
    
    if ($characterId == 1 &amp;&amp; $playerId) {
        my $sql = 'SELECT CharacterID FROM Character_DATA WHERE PlayerUID=? AND Alive = 1 AND InstanceID=? ORDER BY CharacterID DESC LIMIT 1';
        my $sth = $dbh-&gt;prepare ($sql);
        my $res = $sth-&gt;execute ($playerId, INSTANCE);
        return unless $res;
        
        ($characterId) = $sth-&gt;fetchrow_array;
        $sth-&gt;finish;
    }
    unless ($characterId) {
        print STDERR "Error h_load_character(): characterId undefined!\n";
        return;
    }
    
    my $sql = "SELECT Worldspace, Medical, Generation, KillsZ, HeadshotsZ, KillsH, KillsB, CurrentState, Humanity, PlayerUID, CashMoney
               FROM Character_DATA WHERE CharacterID=?";
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($characterId);
    
    my ($worldSpace, $medical, $generation, $killsZ, $headshotsZ, $killsH, $killsB, $currentState, $humanity, $playerUID, $cashMoney) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;
    return unless (defined $worldSpace);
    
    $playerId = $playerUID if (defined $playerUID);
    
    $worldSpace   ||= '[]';
    $medical      ||= '[]';
    $generation   ||= 1;
    $currentState ||= '[]';
    $humanity       = 2500 unless (defined $humanity);
	$cashMoney      = 0	unless (defined $cashMoney);
    
    my $stats = '[0,0,0,0]';
    $stats    = '['.$killsZ.','.$headshotsZ.','.$killsH.','.$killsB.']' if (defined $killsZ &amp;&amp; defined $headshotsZ &amp;&amp; 
                                                                            defined $killsH &amp;&amp; defined $killsB);
    
    my $file = CACHE_DIR.'players/'.$myPlayerCounter.'/'.lc($playerId).'-char.sqf';
    open  (OUT, "&gt;$file");
    print OUT '["PASS",'.$medical.','.$stats.','.$currentState.','.$worldSpace.','.$humanity.',"'.$characterId.'",'.$cashMoney.']';
    close (OUT);
    
    print STDERR "CHILD:102 Save character: $file\n";
    return $res;
}

# 103
sub h_log_login {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $playerId, $characterId, $action) = @$p;
    unless ($playerId) {
        print STDERR "Error h_log_login(): playerId undefined!\n";
        return;
    }
    $playerId    =~ s/['"]//g;
    $characterId =~ s/"//g;
    
    my $sql = 'INSERT INTO Player_LOGIN(PlayerUID, CharacterID, Datestamp, Action) VALUES (?, ?, CURRENT_TIMESTAMP, ?)';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($playerId, $characterId, $action);
    return $res;
}

# 201
sub h_player_update {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $characterId, $worldSpace, $inventory, $backpack, $medical, $justAte, $justDrank, 
        $killsZ, $headshotsZ, $distanceWalked, $durationLived, $currentState, $killsH, $killsB, $model,
        $humanity, $cashMoney) = @$p;
    unless ($characterId) {
        print STDERR "Error h_player_update(): characterId undefined!\n";
        return;
    }
    $characterId =~ s/"//g;
    
    if ($worldSpace) {
        my $ws = parse_json ($worldSpace);
        unless ($ws) {
            print STDERR "Error h_player_update(): worldSpace invalid json!\n";
            return;
        }
        if (@$ws) {
            if ($ws-&gt;[1] &amp;&amp; ref($ws-&gt;[1]) eq 'ARRAY') {
                my ($x, $y) = @{$ws-&gt;[1]};
                if ($x &amp;&amp; $x &lt; -18000) {
                    print STDERR "Error h_player_update(): worldSpace invalid!\n";
                    return;
                }
            }
        }
    }
    if ($inventory) {
        unless ( parse_json ($inventory) ) {
            print STDERR "Error h_player_update(): inventory invalid json!\n";
            $inventory = undef;
        }
    }
    if ($backpack) {
        unless ( parse_json ($backpack) ) {
            print STDERR "Error h_player_update(): backpack invalid json!\n";
            $backpack = undef;
        }
    }
    if ($medical) {
        unless ( parse_json ($medical) ) {
            print STDERR "Error h_player_update(): medical invalid json!\n";
            $medical = undef;
        }
    }
    if ($currentState) {
        unless ( parse_json ($currentState) ) {
            print STDERR "Error h_player_update(): currentState invalid json!\n";
            $currentState = undef;
        }
    }
    if ($model) {
        $model = '"'.$model.'"' if (length($model) &gt; 3 &amp;&amp; $model !~ m/"/);
        unless ( parse_json ($model) ) {
            print STDERR "Error h_player_update(): model invalid json!\n";
            $model = undef;
        }
    }
    
    my $str = '';
    $str .= 'Worldspace='.$dbh-&gt;quote($worldSpace).','            if ($worldSpace &amp;&amp; $worldSpace ne '[]');
    $str .= 'Inventory='.$dbh-&gt;quote($inventory).','              if ($inventory  &amp;&amp; $inventory  ne INVENTORY &amp;&amp; $inventory ne '[]');
    $str .= 'Backpack='.$dbh-&gt;quote($backpack).','                if ($backpack   &amp;&amp; $backpack   ne BACKPACK &amp;&amp; $backpack ne '[]');
    $str .= 'Medical='.$dbh-&gt;quote($medical).','                  if ($medical    &amp;&amp; $medical    ne '[]');
    $str .= 'CurrentState='.$dbh-&gt;quote($currentState).','        if ($currentState &amp;&amp; $currentState ne '[]');
    $str .= 'Model='.$dbh-&gt;quote($model).','                      if ($model &amp;&amp; $model ne MODEL);
    
    $str .= 'LastAte=CURRENT_TIMESTAMP,'                          if ($justAte   &amp;&amp; $justAte   eq 'true');
    $str .= 'LastDrank=CURRENT_TIMESTAMP,'                        if ($justDrank &amp;&amp; $justDrank eq 'true');
    
    $str .= 'KillsZ=KillsZ+'.int($killsZ).','                     if ($killsZ     &amp;&amp; $killsZ &gt; 0);
    $str .= 'HeadshotsZ=HeadshotsZ+'.int($headshotsZ).','         if ($headshotsZ &amp;&amp; $headshotsZ &gt; 0);
    $str .= 'DistanceFoot=DistanceFoot+'.int($distanceWalked).',' if ($distanceWalked &amp;&amp; $distanceWalked &gt; 0);
    $str .= 'KillsH=KillsH+'.int($killsH).','                     if ($killsH     &amp;&amp; $killsH &gt; 0);
    $str .= 'KillsB=KillsB+'.int($killsB).','                     if ($killsB     &amp;&amp; $killsB &gt; 0);
    
    if ($humanity) {    
        if ($humanity &lt; 0) {
            $str .= 'Humanity=Humanity-'.int(-1*$humanity).',';
        } else {
            $str .= 'Humanity=Humanity+'.int($humanity).',';
        }
    }
	
	if ($cashMoney) {    
        if ($cashMoney &lt; 0) {
            $str .= 'CashMoney=CashMoney-'.int(-1*$cashMoney).',';
        } else {
            $str .= 'CashMoney=CashMoney+'.int($cashMoney).',';
        }
    }
	
    return unless $str;
    
    $str .= 'Duration=Duration+'.int($durationLived || 0);
    
    my $sql = 'UPDATE Character_DATA SET ';
    $sql   .= $str;
    $sql   .= ' WHERE CharacterID=?';
    
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($characterId);
    return $res;
}

# 202
sub h_player_death {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $characterId, $duration) = @$p;
    unless ($characterId) {
        print STDERR "Error h_player_death(): characterId undefined!\n";
        return;
    }
    $characterId =~ s/"//g;
    
    my $sql =  "UPDATE Character_DATA SET Alive = 0, LastLogin = DATE_SUB(CURRENT_TIMESTAMP, INTERVAL ? MINUTE) 
                WHERE CharacterID=? AND Alive = 1";
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute (int($duration), $characterId);
    return unless $res;    
    
    # Reset profile
    my $playerId = get_playerId_by_characterId ($characterId);
    if ($playerId) {    
        h_load_player ([101, $playerId, INSTANCE]);
		h_load_bank ([298, $playerId, INSTANCE]);
    } else {
        print STDERR "Error h_player_death('$characterId'): playerId not found!\n";
    }
}

# 204
sub h_player_disconnect {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $playerId) = @$p;
    $playerId =~ s/[A-Z"]//g;
    
    update_player_cache ($playerId);
	update_bank_cache ($playerId);
}

# 298
sub h_load_bank {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $playerId, $serverId, $playerName) = @$p;
    unless ($playerId) {
        print STDERR "Error h_load_bank(): playerId undefined!\n";
        return;
    }
    $playerId =~ s/['"]//g;
    $serverId ||= INSTANCE;
    
    my $PLAYERS_DIR = CACHE_DIR.'players/'.$myPlayerCounter;
    mkdir ($PLAYERS_DIR) unless (-d $PLAYERS_DIR);
    
    my $sql = 'SELECT PlayerName FROM Banking_DATA WHERE PlayerUID=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($playerId);
    
    my ($name) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;
    
    my $newPlayer = 0;
    if (defined $name) {
        if ($playerName &amp;&amp; $playerName ne $name) {
			$sql = 'UPDATE Banking_DATA SET PlayerName=? WHERE PlayerUID=?';
            $sth = $dbh-&gt;prepare ($sql);
            $res = $sth-&gt;execute ($playerName, $playerId);
            print STDERR "Changed name of player $playerId from '$name' to '$playerName' in table Banking_DATA\n";
        }
    } else {
        $newPlayer  = 1;
        $playerName = 'Unknown' unless $playerName;
		$sql = 'INSERT INTO Banking_DATA(PlayerUID, PlayerName, LastUpdated) VALUES (?, ?, CURRENT_TIMESTAMP)';
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($playerId, $playerName);
        print STDERR "Created a new player $playerId named '$playerName' in table Banking_DATA\n";
    }
	
	$sql = "SELECT BankSaldo
            FROM  Banking_DATA 
            WHERE PlayerUID=?";
    $sth = $dbh-&gt;prepare ($sql);
    $res = $sth-&gt;execute ($playerId);
    
    my ($bankSaldo) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;

	$bankSaldo    = 0         unless (defined $bankSaldo);
    
    my $file = $PLAYERS_DIR.'/'.lc($playerId).'-bank.sqf';
    open  (OUT, "&gt;$file");
    print OUT '["PASS",'.$bankSaldo.']';
    close (OUT);
    
    print STDERR "CHILD:298 Save bank: $file with BankSaldo: $bankSaldo\n";
    return $res;
}

# 299
sub h_bank_update {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $playerId, $bankSaldo) = @$p;
    unless ($playerId) {
        print STDERR "Error h_player_bank_save(): playerId undefined!\n";
        return;
    }
    $playerId    =~ s/['"]//g;
	
    my $str = '';
	
	$str .= 'BankSaldo='.int($bankSaldo).',';
	
    return unless $str;
    
    $str .= 'LastUpdated=CURRENT_TIMESTAMP';
    
    my $sql = 'UPDATE Banking_DATA SET ';
    $sql   .= $str;
    $sql   .= ' WHERE PlayerUID=?';
    
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($playerId);
    return $res;
}

# 302
sub h_stream_objects {
    # Clean objects
    for my $sql ('DELETE FROM Object_DATA WHERE Instance=? AND ClassName="TentStorage" AND (Inventory="[[[],[]],[[],[]],[[],[]]]" OR Damage=1)',
                 'DELETE FROM Object_DATA where Instance=? AND Damage &gt; 0.9 AND ObjectID &gt; 89') {
        my $sth = $dbh-&gt;prepare ($sql);
        $sth-&gt;execute (INSTANCE);
    }
    
    my $sql = "SELECT ObjectID, CharacterID, Worldspace, Inventory, Hitpoints, Fuel, Damage 
                 FROM Object_init_DATA WHERE Instance=? AND Classname IS NOT NULL ORDER BY ObjectID";
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute (INSTANCE);
    return unless $res;
    
    my %init = ();
    while (my ($objId, $ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage) = $sth-&gt;fetchrow_array) {
        next unless $objId;

        $ownerId    ||= 0;
        $worldSpace ||= '[]';
        $inventory  ||= '[]';
        $hitpoints  ||= '[]';
        $fuel       ||= 0;
        $damage     ||= 0;
    
        $init{$objId} = [$ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage];
    }
    $sth-&gt;finish;
    
    $sql = "SELECT ObjectID, Classname, CharacterID, Worldspace, Inventory, Hitpoints, Fuel, Damage
            FROM Object_DATA WHERE Instance=? AND Classname IS NOT NULL ORDER BY ObjectID";
    $sth = $dbh-&gt;prepare ($sql);
    $res = $sth-&gt;execute (INSTANCE);
    return unless $res;
    
    my $str     = '';
    my @updates = ();
    while (my ($objId, $className, $ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage) = $sth-&gt;fetchrow_array) {
        if ( $objId &amp;&amp; $damage &amp;&amp; $damage &gt; 0.7 &amp;&amp; $init{$objId} ) {
            print STDERR "Respawn '$className' ($objId)\n";
            ($ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage) = @{$init{$objId}};
            push @updates, $objId;
        }
        
        $ownerId    ||= 0;
        $worldSpace ||= '[]';
        $inventory  ||= '[]';
        $hitpoints  ||= '[]';
        $fuel       ||= 0;
        $damage     ||= 0;
        
        $fuel   = sprintf ("%.3f", $fuel);
        $damage = sprintf ("%.3f", $damage);
        
        $str .= ',' if $str;
        $str .= '["OBJ","'.$objId.'","'.$className.'","'.$ownerId.'",'.$worldSpace.','.$inventory.','.$hitpoints.','.$fuel.','.$damage.']';
    }
    $sth-&gt;finish;
    
    for my $objId (@updates) {
        my ($ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage) = @{$init{$objId}};
        $sql = 'UPDATE Object_DATA SET CharacterID=?, Worldspace=?, Inventory=?, Hitpoints=?, Fuel=?, Damage=? WHERE Instance=? AND ObjectID=?';
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage, INSTANCE, $objId);
    }    
    #return unless $str;
    
    my $file = CACHE_DIR.'objects.sqf';
    open  (OUT, "&gt;$file");
    print OUT '['.$str.']';
    close (OUT);    
}

# 303
sub h_object_update_inventory {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $objectId, $inventory) = @$p;
    unless ($objectId &amp;&amp; $inventory) {
        print STDERR "Error h_object_update_inventory(): objectId or inventory undefined!\n";
        return;
    }
    $objectId =~ s/"//g;
    
    unless ( parse_json ($inventory) ) {
        print STDERR "Error h_object_update_inventory($objectId): inventory invalid json!\n";
        return;
    }
    
    my $sql = 'UPDATE Object_DATA SET Inventory=? WHERE ObjectID=? AND Instance=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($inventory, $objectId, INSTANCE);
    return $res;
}

# 304
sub h_object_delete {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $objectId) = @$p;
    unless ($objectId) {
        print STDERR "Error h_object_delete(): objectId undefined!\n";
        return;
    }
    $objectId =~ s/"//g;
    
    my $sql = 'DELETE FROM Object_DATA WHERE ObjectID=? AND Instance=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($objectId, INSTANCE);
    
    if ($res) {
        $sql = 'DELETE FROM Object_init_DATA WHERE ObjectID=? AND Instance=?';
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($objectId, INSTANCE);
    }    
    return $res;
}

# 305
sub h_vehicle_moved {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $objectId, $worldSpace, $fuel) = @$p;
    unless ($objectId &amp;&amp; $worldSpace) {
        print STDERR "Error h_vehicle_moved(): objectId undefined!\n";
        return;
    }
    $objectId =~ s/"//g;
    
    unless ( parse_json ($worldSpace) ) {
        print STDERR "Error h_vehicle_moved($objectId): worldSpace invalid json!\n";
        return;
    }
    
    my $sql = 'UPDATE Object_DATA SET Worldspace=?, Fuel=? WHERE ObjectID=? AND Instance=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($worldSpace, $fuel, $objectId, INSTANCE);
    return $res;
}

# 306
sub h_vehicle_damaged {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $objectId, $hitPoints, $damage) = @$p;
    unless ($objectId &amp;&amp; defined $hitPoints &amp;&amp; defined $damage) {
        print STDERR "Error h_vehicle_damaged(): objectId undefined!\n";
        return;
    }
    $objectId =~ s/"//g;
    
    if ($hitPoints) {
        unless ( parse_json ($hitPoints) ) {
            print STDERR "Error h_vehicle_damaged($objectId): hitPoints invalid json!\n";
            return;
        }
    }
    
    $hitPoints ||= '[]';
    $damage    ||= 0;
    
    my $sql = 'UPDATE Object_DATA SET Hitpoints=?, Damage=? WHERE ObjectID=? AND Instance=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($hitPoints, $damage, $objectId, INSTANCE);
    return $res;
}

# 308
sub h_object_publish {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $serverId, $className, $damage, $characterId, $worldSpace, $inventory, $hitPoints, $fuel, $objectUID) = @$p;
    unless ($className) {
        print STDERR "Error h_object_publish(): className undefined!\n";
        return;
    }
    $characterId =~ s/"//g;
    $objectUID   =~ s/"//g;
    
    if ($worldSpace) {
        unless ( parse_json ($worldSpace) ) {
            print STDERR "Error h_object_publish($className): worldSpace invalid json!\n";
            return;
        }
    }
    if ($inventory) {
        unless ( parse_json ($inventory) ) {
            print STDERR "Error h_object_publish($className): inventory invalid json!\n";
            $inventory = '[]';
        }
    }
    if ($hitPoints) {
        unless ( parse_json ($hitPoints) ) {
            print STDERR "Error h_object_publish($className): hitPoints invalid json!\n";
            $hitPoints = '[]';
        }
    }
    
    $serverId   ||= INSTANCE;
    $worldSpace ||= '[]';
    $inventory  ||= '[]';
    $hitPoints  ||= '[]';
    $damage     ||= 0;
    $fuel       ||= 0;
    
    my $sql = "INSERT INTO Object_DATA(ObjectUID, Instance, Classname, Damage, CharacterID, Worldspace, Inventory, 
                                       Hitpoints, Fuel, Datestamp) 
               VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)";
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($objectUID, $serverId, $className, $damage, $characterId, $worldSpace, $inventory, $hitPoints, $fuel);
    
    # Cache object ID
    $sql = 'SELECT ObjectID FROM Object_DATA WHERE ObjectUID=? AND Instance=?';
    $sth = $dbh-&gt;prepare ($sql);
    $res = $sth-&gt;execute ($objectUID, $serverId);
    return unless $res;
                
    my ($objectId) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;
    return unless (defined $objectId);

    my $file = CACHE_DIR.'objects/'.$objectUID.'.sqf';
    open  (OUT, "&gt;$file");
    print OUT '["PASS","'.$objectId.'"]';
    close (OUT);
}

# 309
sub h_object_uid_update_inventory {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $objectUID, $inventory) = @$p;
    unless ($objectUID &amp;&amp; $inventory) {
        print STDERR "Error h_object_uid_update_inventory(): objectUID or inventory undefined!\n";
        return;
    }
    $objectUID =~ s/"//g;
    
    unless ( parse_json ($inventory) ) {
        print STDERR "Error h_object_uid_update_inventory($objectUID): inventory invalid json!\n";
        return;
    }
    
    my $sql = 'UPDATE Object_DATA SET Inventory=? WHERE ObjectUID=? AND Instance=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($inventory, $objectUID, INSTANCE);
    return $res;
}

# 310
sub h_object_uid_delete {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $objectUID) = @$p;
    unless ($objectUID) {
        print STDERR "Error h_object_uid_delete(): objectUID undefined!\n";
        return;
    }
    $objectUID =~ s/"//g;
    
    my $sql = 'DELETE FROM Object_DATA WHERE ObjectUID=? AND Instance=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($objectUID, INSTANCE);
    
    if ($res) {
        $sql = 'DELETE FROM Object_init_DATA WHERE ObjectUID=? AND Instance=?';
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($objectUID, INSTANCE);
    }
    return $res;
}

# 388 - loadObjectID
sub h_load_objects_id {
    my $sql = 'SELECT ObjectID, ObjectUID FROM Object_DATA WHERE Instance=? ORDER BY ObjectUID';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute (INSTANCE);
    #return unless $res;
    
    while (my ($objectId, $objectUID) = $sth-&gt;fetchrow_array) {
        next unless (defined $objectId);
        
        my $file = CACHE_DIR.'objects/'.$objectUID.'.sqf';
        open  (OUT, "&gt;$file");
        print OUT '["PASS","'.$objectId.'"]';
        close (OUT);
    }
    $sth-&gt;finish;
}

# 396
sub h_object_reset_damage {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $oid) = @$p;
    unless ($oid) {
        print STDERR "Error h_object_reset_damage(): objectId undefined!\n";
        return;
    }
    $oid =~ s/"//g;
    
    my $sth = $dbh-&gt;prepare ('UPDATE Object_DATA SET Damage=0 WHERE ObjectID=? AND Instance=?');
    my $res = $sth-&gt;execute ($oid, INSTANCE);
    return $res;
}

# 397
sub h_object_uid_reset_damage {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $uid) = @$p;
    unless ($uid) {
        print STDERR "Error h_object_uid_reset_damage(): objectUID undefined!\n";
        return;
    }
    $uid =~ s/"//g;
    
    my $sth = $dbh-&gt;prepare ('UPDATE Object_DATA SET Damage=0 WHERE ObjectUID=? AND Instance=?');
    my $res = $sth-&gt;execute ($uid, INSTANCE);
    return $res;
}

# 398 - tradeObject 
sub h_trade_object {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $traderObjectId, $action) = @$p;
    return unless ($traderObjectId &amp;&amp; defined $action);
    
    my $sql;
    if ($action == 0) {
        $sql = 'UPDATE Traders_DATA SET qty = qty - 1 WHERE id=? AND qty &gt; 0';
    } else {
        $sql = 'UPDATE Traders_DATA SET qty = qty + 1 WHERE id=?';
    }
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($traderObjectId);    
    return $res;
}

# 399 - loadTraderDetails
sub h_load_trader_details {
    my $sql = 'SELECT id, item, qty, buy, sell, `order`, tid, afile FROM Traders_DATA';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ();
    return unless $res;
    
    my %tids = ();
    my $charecterId = 0;
    while (my ($id, $item, $qty, $buy, $sell, $order, $tid, $afile) = $sth-&gt;fetchrow_array) {
        next unless $tid;
        $tids{$tid} = [] unless $tids{$tid};
        
        push @{$tids{$tid}}, '['.$id.','.$item.','.$qty.','.$buy.','.$sell.','.$order.','.$tid.',"'.$afile.'"]';
    }     
    $sth-&gt;finish;
    
    return unless %tids;
    
    while (my ($tid, $v) = each %tids) {
        next unless ($v &amp;&amp; @$v);
        my $str = join (',', @$v);
    
        my $file = CACHE_DIR.'traders/'.$tid.'.sqf';
        open  (OUT, "&gt;$file");
        print OUT '['.$str.']';
        close (OUT);
    }
    
    undef %tids;
}

</pre>
<pre class="ipsCode prettyprint">
["PASS",false,"1",[],[[],[]],["",[],[]],[0,0,0],"Survivor2_DZ",0.96,0]
</pre>
<pre class="ipsCode prettyprint">
["PASS",[],[0,0,0,0],[],[],2500,"1",0]
</pre>
</div>
</div>
<div class="ipsPadding ipsHide cPostShareMenu" id="elShareComment_162320_menu">
<h5 class="ipsType_normal ipsType_reset">Link to comment</h5>
<input class="ipsField_fullWidth" type="text" value="https://epochmod.com/forum/topic/27487-inventory-rollbacks/"/>
<h5 class="ipsType_normal ipsType_reset ipsSpacer_top">Share on other sites</h5>
<ul class="ipsList_inline ipsList_noSpacing ipsClearfix" data-controller="core.front.core.sharelink">
<li>
<a class="cShareLink cShareLink_twitter" data-ipstooltip="" data-role="shareLink" href="https://twitter.com/share?url=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F%3Fdo%3DfindComment%26comment%3D162320" rel="nofollow noopener" target="_blank" title="Share on Twitter">
<i class="fa fa-twitter"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_facebook" data-ipstooltip="" data-role="shareLink" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F%3Fdo%3DfindComment%26comment%3D162320" rel="noopener nofollow" target="_blank" title="Share on Facebook">
<i class="fa fa-facebook"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_reddit" data-ipstooltip="" href="https://www.reddit.com/submit?url=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F%3Fdo%3DfindComment%26comment%3D162320&amp;title=Inventory+Rollbacks" rel="nofollow noopener" target="_blank" title="Share on Reddit">
<i class="fa fa-reddit"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_pinterest" data-ipstooltip="" data-role="shareLink" href="https://pinterest.com/pin/create/button/?url=https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment%26comment=162320&amp;media=https://epochmod.com/forum/uploads/monthly_2018_04/logo_only_black.png.c85695b79cad231dd136cd63c4db8256.png" rel="nofollow noopener" target="_blank" title="Share on Pinterest">
<i class="fa fa-pinterest"></i>
</a></li>
</ul>
<hr class="ipsHr"/>
<button class="ipsHide ipsButton ipsButton_small ipsButton_light ipsButton_fullWidth ipsMargin_top:half" data-controller="core.front.core.webshare" data-role="webShare" data-websharetext="Hello Guys need some help 
some Player notall have the Rollback Problem if they relog 

#!/usr/bin/perl
#
# Copyright 2013 by Denis Erygin,
# denis.erygin@gmail.com
#

use warnings;
use strict;

use constant PORT      =&gt; 2302; # Change it with epoch.sh
use constant PATH      =&gt; $ENV{'PWD'}.'/'; # Set your epoch server dir
use constant PIDFILE   =&gt; PATH.PORT.'.pid';
use constant CACHE_DIR =&gt; PATH.'cache/players';

unless (-f PATH.'epoch') {
    print STDERR &quot;Can't found server binary!\n&quot;;
    exit;
}

set_time  ();
logrotate ();

if (-f PIDFILE) {
    open  (IN, '&lt;'.PIDFILE) or die &quot;Can't open: $!&quot;;
    my $pid = int(&lt;IN&gt;);
    close (IN);

    `sync`;
    my $res = `kill -SIGINT $pid 2&gt;&amp;1`;
    print STDERR $res,&quot;\n&quot; if $res;
   
    unlink (PIDFILE) if (-f PIDFILE);    
    backup_cache();
}

print STDERR &quot;Restart Dayz Epoch server...\n&quot;;
chdir (PATH);

my $cmd = '/usr/bin/screen -h 20000 -fa -d -m -S epoch '.PATH.'epoch.sh';
my $res = `$cmd`;
print STDERR $res,&quot;\n&quot; if $res;
exit;

#-----------------------------------------------------------------------------------------------
sub set_time {
    my ($s, $m, $h, $day, $mon, $y) = localtime(time() - 0*3600);
    $y += 1900;
    $mon++;
    
    # Uncomment to disabe night
    ($h, $m) = (17, 0) if ($h &gt; 17 || ($h &gt;= 0 &amp;&amp; $h &lt; 4));
    
    my $file = PATH.'cache/set_time.sqf';
    open  (IN, &quot;&gt;$file&quot;) or die &quot;Can't find $file&quot;;
    # [&quot;PASS&quot;, [year, month, day, hour, minute]]
    print IN '[&quot;PASS&quot;,[2012,6,6,'.$h.','.$m.']]'; # with full moon
    close (IN);
}

sub logrotate {
    my $log = PATH.'dump.log';
    if (-f $log) {
        my ($dev,$ino,$mode,$nlink,$uid,$gid,$rdev,$size) = stat($log);
    
        if ($size &amp;&amp; $size &gt;= 100000000) {
            print STDERR &quot;logrotate $size\n&quot;;
        
            my $nlog = $log.'.'.time();
            my $res  = `cp $log $nlog 2&gt;&amp;1`;
            print STDERR $res,&quot;\n&quot; if $res;
        
            $res = `echo '' &gt; $log 2&gt;&amp;1`;
            print STDERR $res,&quot;\n&quot; if $res;
        }
    }
}

sub backup_cache {
    return unless (-d CACHE_DIR);
    opendir (DIR, CACHE_DIR) or die $!;

    while (my $file = readdir (DIR)) {
        next unless ($file =~ m/^\d+$/ &amp;&amp; $file ne '1');
        my $dir    = CACHE_DIR.'/'.$file;
        my $backup = CACHE_DIR.'/1';
        next unless (-d $dir);
        
        my $res = `mv -f $dir $backup 2&gt;&amp;1`;
        print STDERR $res,&quot;\n&quot; if $res;
    }

    closedir (DIR);
}




#!/usr/bin/perl
#
# Copyright 2014 by Denis Erygin,
# denis.erygin@gmail.com
#

use JSON::XS;
use DBI;
use warnings;
use strict;

use constant {
    INSTANCE  =&gt; 13,          # Chernarus instance
    DB_NAME   =&gt; '*******',     # Set database name
    DB_LOGIN  =&gt; '*****',      # Set database login
    DB_PASSWD =&gt; '*****',      # Set database password
    DB_HOST   =&gt; 'localhost', # Set database host
    DB_PORT   =&gt; 3306,        # Set database port (default 3306)

   CACHE_DIR =&gt; $ENV{'PWD'}.'/cache/',
    # Start inventory of player
    INVENTORY =&gt; '[[],[]]',
    BACKPACK  =&gt; '[&quot;&quot;,[],[]]',
    MODEL     =&gt; '&quot;Survivor2_DZ&quot;'
};

my %cid_inv = ();
my %obj_inv = ();

my $myPlayerCounter = 1;

my %FN_IPC  = (
    11  =&gt; \&amp;h_player_counter,
    21  =&gt; \&amp;h_player_split_inventory,
    22  =&gt; \&amp;h_player_split_backpack,
    31  =&gt; \&amp;h_object_change_lock_code,
    33  =&gt; \&amp;h_object_split_inventory,
    39  =&gt; \&amp;h_object_uid_split_inventory,
    101 =&gt; \&amp;h_load_player,
	102 =&gt; \&amp;h_load_character,
    103 =&gt; \&amp;h_log_login,
    201 =&gt; \&amp;h_player_update,
    202 =&gt; \&amp;h_player_death,
    204 =&gt; \&amp;h_player_disconnect,
	298 =&gt; \&amp;h_load_bank,
	299 =&gt; \&amp;h_bank_update,
    303 =&gt; \&amp;h_object_update_inventory,
    304 =&gt; \&amp;h_object_delete,
    305 =&gt; \&amp;h_vehicle_moved,
    306 =&gt; \&amp;h_vehicle_damaged,
    308 =&gt; \&amp;h_object_publish,
    309 =&gt; \&amp;h_object_uid_update_inventory,
    310 =&gt; \&amp;h_object_uid_delete,
    396 =&gt; \&amp;h_object_reset_damage,
    397 =&gt; \&amp;h_object_uid_reset_damage,
    398 =&gt; \&amp;h_trade_object,
);

my $dbh   = connect_to_db();
my $coder = JSON::XS-&gt;new-&gt;ascii(1)-&gt;shrink(1)-&gt;allow_nonref(1)-&gt;max_depth(5)-&gt;max_size(1048576);

mkdir (CACHE_DIR) unless (-d CACHE_DIR);

init_traders           ();
init_objects_id        ();
init_objects           ();
init_default_player    ();
init_default_character ();
init_default_bank      ();
update_players_cache   ();

open (LOG, &quot;&gt;&gt;dump.log&quot;) or die $!;
while (&lt;STDIN&gt;) {
    next if ($_ =~ m/Duplicate magazine/ || $_ =~ m/arrived from nonowner/);
    print STDERR $_;
    print LOG $_;

    if ($_ =~ m/CHILD:/) {
        chop;
        my ($pref, $data) = split /CHILD:/ =&gt; $_;
        my @arr = split /:/ =&gt; $data;
        my $cmd = $arr[0];
        next unless $cmd;
        
        my $fn = $FN_IPC{$cmd};
        $fn-&gt;(\@arr) if $fn;
    } else {
        init_login_uid ($_);
    }
}
close(LOG);

$dbh-&gt;disconnect;
exit;

#---------------------------------------------------------------------------
sub connect_to_db {
    my $dbh = DBI-&gt;connect('dbi:mysql:'.DB_NAME.':'.DB_HOST.':'.DB_PORT, DB_LOGIN, DB_PASSWD,
              {'PrintError' =&gt; 1, 'RaiseError' =&gt; 1, 'AutoCommit' =&gt; 1})
              or die &quot;Can't connect to mysql: $!&quot;;
    $dbh-&gt;{'mysql_auto_reconnect'} = 1;
    return $dbh;
}

sub parse_json {
    my $str = shift;
    return unless $str;
    
    my $data;
    eval { $data = $coder-&gt;decode ($str); };
    return if $@;
    return $data;
}

sub init_traders {
    h_load_trader_details();
}

sub init_objects_id {
    h_load_objects_id();
}

sub init_objects {
    h_stream_objects();
}

sub init_default_player {
    my $file = CACHE_DIR.'default.sqf';
    open  (OUT, &quot;&gt;$file&quot;) or die &quot;Can't open '$file'&quot;;
    print OUT '[&quot;PASS&quot;,false,&quot;1&quot;,[],'.INVENTORY.','.BACKPACK.',[0,0,0],'.MODEL.',0.96,0]';
    close (OUT);
}

sub init_default_character {
    my $file = CACHE_DIR.'default-char.sqf';
    open  (OUT, &quot;&gt;$file&quot;) or die &quot;Can't open '$file'&quot;;
    print OUT '[&quot;PASS&quot;,[],[0,0,0,0],[],[],2500,&quot;1&quot;,0]';
    close (OUT);
}

sub init_default_bank {
    my $file = CACHE_DIR.'default-bank.sqf';
    open  (OUT, &quot;&gt;$file&quot;) or die &quot;Can't open '$file'&quot;;
    print OUT '[&quot;PASS&quot;,0]';
    close (OUT);
}

sub update_players_cache {
    my $sql = 'SELECT PlayerUID FROM Player_DATA';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ();
    return unless $res;
    
    my $PLAYERS_DIR = CACHE_DIR.'players/'.$myPlayerCounter;
    mkdir ($PLAYERS_DIR) unless (-d $PLAYERS_DIR);
    
    my @uids = ();
    while (my ($playerId) = $sth-&gt;fetchrow_array) {
        next unless $playerId;
        my $file = $PLAYERS_DIR.'/'.lc($playerId).'.sqf';
        next if (-f $file);
    
        push @uids, $playerId;
    }
    $sth-&gt;finish;
    return unless @uids;
    
    for my $playerId (@uids) {
        update_player_cache ($playerId);
		update_bank_cache ($playerId);
    }
}

sub get_playerId_by_characterId {
    my $characterId = shift;
    return unless $characterId;
    
    my $sql = 'SELECT PlayerUID FROM Character_DATA WHERE CharacterID=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($characterId);
    return unless $res;
    
    my ($playerId) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;
    
    return $playerId;
}

sub update_player_cache {
    my $playerId = shift;
    return unless $playerId;

    my $sql = &quot;SELECT CharacterID, Worldspace, Inventory, Backpack,
               TIMESTAMPDIFF(MINUTE, Datestamp, LastLogin) as SurvivalTime,
               TIMESTAMPDIFF(MINUTE, LastAte, NOW()) as MinsLastAte,
               TIMESTAMPDIFF(MINUTE, LastDrank, NOW()) as MinsLastDrank,
               Model, Humanity, KillsZ, HeadshotsZ, KillsH, KillsB, CurrentState, Medical, CashMoney 
               FROM Character_DATA
               WHERE PlayerUID=? AND Alive = 1 AND InstanceID=? ORDER BY CharacterID DESC LIMIT 1&quot;;
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($playerId, INSTANCE);
    #return unless $res;
    
    my ($characterId, $worldSpace, $inventory, $backpack, $survivalTime, $minsLastAte, $minsLastDrank, $model,
        $humanity, $killsZ, $headshotsZ, $killsH, $killsB, $currentState, $medical, $cashMoney) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;
    return unless (defined $characterId);
    
    my $survival = '[0,0,0]';
    $survival    = '['.$survivalTime.','.$minsLastAte.','.$minsLastDrank.']' if (defined $survivalTime &amp;&amp;
                                                                                 defined $minsLastAte  &amp;&amp;
                                                                                 defined $minsLastDrank);
    my $PLAYERS_DIR = CACHE_DIR.'players/'.$myPlayerCounter;
    mkdir ($PLAYERS_DIR) unless (-d $PLAYERS_DIR);
                                                                                 
    my $file = $PLAYERS_DIR.'/'.lc($playerId).'.sqf';
    open  (OUT, &quot;&gt;$file&quot;) or print STDERR $!;
    print OUT '[&quot;PASS&quot;,false,&quot;'.$characterId.'&quot;,'.$worldSpace.','.$inventory.','.$backpack.','.$survival.','.$model.',0.96]';
    close (OUT);
        
    my $stats = '[0,0,0,0]';
    $stats    = '['.$killsZ.','.$headshotsZ.','.$killsH.','.$killsB.']' if (defined $killsZ &amp;&amp; defined $headshotsZ &amp;&amp; defined $killsH &amp;&amp; defined $killsB);
    
    $file = $PLAYERS_DIR.'/'.lc($playerId).'-char.sqf';
    open  (OUT, &quot;&gt;$file&quot;) or print STDERR $!;
    print OUT '[&quot;PASS&quot;,'.$medical.','.$stats.','.$currentState.','.$worldSpace.','.$humanity.',&quot;'.$characterId.'&quot;,'.$cashMoney.']';
    close (OUT);
	
    return $characterId;
}

sub update_bank_cache {
    my $playerId = shift;
    return unless $playerId;

	my $sql = &quot;SELECT BankSaldo
			   FROM Banking_DATA
		       WHERE PlayerUID=?&quot;;
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($playerId);
    
    my ($bankSaldo) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;
	return unless (defined $bankSaldo);

	my $PLAYERS_DIR = CACHE_DIR.'players/'.$myPlayerCounter;
    mkdir ($PLAYERS_DIR) unless (-d $PLAYERS_DIR);
	
    my $file = $PLAYERS_DIR.'/'.lc($playerId).'-bank.sqf';
    open  (OUT, &quot;&gt;$file&quot;) or print STDERR $!;
    print OUT '[&quot;PASS&quot;,'.$bankSaldo.']';
    close (OUT);
	
	return $bankSaldo;
}

sub init_login_uid {
    my $dump = shift;
    return unless $dump;
        
    return unless ($dump =~ m/\sconnected/);
    return if ($dump =~ m/BattlEye Server: Player/);
    
    my ($p, $str)   = split (/Player\s/, $dump);
    return unless (defined $str);
    
    my ($name, $uid) = split (/\sconnected\s/, $str);
    return unless ($name &amp;&amp; $uid);
    
    #if ($uid =~ m/(\d+)/) {
    if ($uid =~ m/=(\w+)/) {
        $uid = $1;
    } 
    return unless $uid;
    print STDERR &quot;$uid =&gt; $name\n&quot;;
    
    #my $PLAYERS_DIR = CACHE_DIR.'players/'.$myPlayerCounter;
    #my $file        = $PLAYERS_DIR.'/'.$uid.'.sqf';
    #return if (-e $file);

    h_load_player ([101, $uid, INSTANCE, $name]);
	print STDERR &quot;EXECUTED h_load_player($uid): with name: $name\n&quot;;
	h_load_bank ([298, $uid, INSTANCE, $name]);
    print STDERR &quot;EXECUTED h_load_bank($uid): with name: $name\n&quot;;
}

# 11
sub h_player_counter {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $counter) = @$p;
    return unless ($counter &amp;&amp; int($counter) &gt; 0);
    $counter = int($counter);
    
    my $old = CACHE_DIR.'players/'.$myPlayerCounter;
    my $new = CACHE_DIR.'players/'.$counter;
    if (-d $old) {
        rename ($old, $new);
    } else {
        print STDERR &quot;Error h_player_counter($counter): old '$myPlayerCounter' not found!\n&quot;;
        mkdir ($new) or print STDERR $!,&quot;\n&quot;;
    }
    
    $myPlayerCounter = $counter;
}

# 21
sub h_player_split_inventory {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $cid, $idx, $data) = @$p;
    unless ($cid &amp;&amp; defined $idx &amp;&amp; defined $data) {
        print STDERR &quot;Error h_player_split_inventory(): characterId or idx or data undefined!\n&quot;;
        return;
    }

    unless ( parse_json ($data) ) {
        print STDERR &quot;Error h_player_split_inventory(): data invalid json!\n&quot;;
        $cid_inv{$cid} = undef;
        return;
    }

    # Save weapons
    if ($idx == 0) {
        $cid_inv{$cid} = $data;
        return;
    }
    # Save weapons + magazines
    if ($idx == 1 &amp;&amp; $cid_inv{$cid}) {
        my $inv        = '['.$cid_inv{$cid}.','.$data.']';
        $cid_inv{$cid} = undef;
        print STDERR &quot;Size plr inv: &quot;.length($inv).&quot;\n&quot;;

        unless ( parse_json($inv) ) {
            print STDERR &quot;Error h_player_split_inventory(): inventory invalid json!\n&quot;;
            return;
        }

        my $sth = $dbh-&gt;prepare ('UPDATE Character_DATA SET Inventory=? WHERE CharacterID=?');
        my $res = $sth-&gt;execute ($cid, $inv);
        return $res;
    }
}

# 22
sub h_player_split_backpack {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $cid, $data) = @$p;
    unless ($cid &amp;&amp; defined $data) {
        print STDERR &quot;Error h_player_split_backpack(): characterId or data undefined!\n&quot;;
        return;
    }

    unless ( parse_json ($data) ) {
        print STDERR &quot;Error h_player_split_backpack(): backpack invalid json!\n&quot;;
        return;
    }
    return if ($data eq '[]');

    my $sth = $dbh-&gt;prepare ('UPDATE Character_DATA SET Backpack=? WHERE CharacterID=?');
    my $res = $sth-&gt;execute ($cid, $data);
    return $res;
}

# 31
sub h_object_change_lock_code {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $oid, $code) = @$p;
    unless ($oid &amp;&amp; $code) {
        print STDERR &quot;Error h_object_change_lock_code(): objectId or code undefined!\n&quot;;
        return;
    }
    $oid =~ s/&quot;//g;
    
    my $sth = $dbh-&gt;prepare ('UPDATE Object_DATA SET CharacterID=? WHERE ObjectID=? AND Instance=?');
    my $res = $sth-&gt;execute ($code, $oid, INSTANCE);
    return $res;
}

# 33
sub h_object_split_inventory {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $oid, $idx, $data) = @$p;
    unless ($oid &amp;&amp; defined $idx &amp;&amp; defined $data) {
        print STDERR &quot;Error h_object_split_inventory(): objectId or idx or data undefined!\n&quot;;
        return;
    }
    $oid =~ s/&quot;//g;

    unless ( parse_json ($data) ) {
        print STDERR &quot;Error h_object_split_inventory($oid): data invalid json!\n&quot;;
        $obj_inv{$oid} = undef;
        return;
    }

    # Save weapons
    if ($idx == 0) {
        $obj_inv{$oid} = $data;
        return;
    }
    # Save weapons + magazines
    if ($idx == 1 &amp;&amp; $obj_inv{$oid}) {
        $obj_inv{$oid} .= ','.$data;
        return;
    }
    # Save weapons + magazines + backpack
    if ($idx == 2 &amp;&amp; $obj_inv{$oid}) {
        my $inv        = '['.$obj_inv{$oid}.','.$data.']';
        $obj_inv{$oid} = undef;
        print STDERR &quot;Size obj inv: &quot;.length($inv).&quot;\n&quot;;

        unless ( parse_json($inv) ) {
            print STDERR &quot;Error h_object_split_inventory($oid): inventory invalid json!\n&quot;;
            return;
        }

        my $sth = $dbh-&gt;prepare ('UPDATE Object_DATA SET Inventory=? WHERE ObjectID=? AND Instance=?');
        my $res = $sth-&gt;execute ($inv, $oid, INSTANCE);
        return $res;
    }
}

# 39
sub h_object_uid_split_inventory {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $uid, $idx, $data) = @$p;
    unless ($uid &amp;&amp; defined $idx &amp;&amp; defined $data) {
        print STDERR &quot;Error h_object_uid_split_inventory(): objectUID or idx or data undefined!\n&quot;;
        return;
    }
    $uid =~ s/&quot;//g;

    unless ( parse_json ($data) ) {
        print STDERR &quot;Error h_object_uid_split_inventory($uid): data invalid json!\n&quot;;
        $obj_inv{$uid} = undef;
        return;
    }

    # Save weapons
    if ($idx == 0) {
        $obj_inv{$uid} = $data;
        return;
    }
    # Save weapons + magazines
    if ($idx == 1 &amp;&amp; $obj_inv{$uid}) {
        $obj_inv{$uid} .= ','.$data;
        return;
    }
    # Save weapons + magazines + backpack
    if ($idx == 2 &amp;&amp; $obj_inv{$uid}) {
        my $inv        = '['.$obj_inv{$uid}.','.$data.']';
        $obj_inv{$uid} = undef;
        print STDERR &quot;Size obj uid inv: &quot;.length($inv).&quot;\n&quot;;

        unless ( parse_json($inv) ) {
            print STDERR &quot;Error h_object_uid_split_inventory($uid): inventory invalid json!\n&quot;;
            return;
        }

        my $sth = $dbh-&gt;prepare ('UPDATE Object_DATA SET Inventory=? WHERE ObjectUID=? AND Instance=?');
        my $res = $sth-&gt;execute ($inv, $uid, INSTANCE);
        return $res;
    }
}

# 101
sub h_load_player {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $playerId, $serverId, $playerName) = @$p;
    unless ($playerId &amp;&amp; $serverId) {
        print STDERR &quot;Error h_load_player(): playerId or serverId undefined!\n&quot;;
        return;
    }
    $playerId =~ s/['&quot;]//g;
    $serverId ||= INSTANCE;
    
    my $PLAYERS_DIR = CACHE_DIR.'players/'.$myPlayerCounter;
    mkdir ($PLAYERS_DIR) unless (-d $PLAYERS_DIR);
    
    my $sql = 'SELECT PlayerName, PlayerSex FROM Player_DATA WHERE PlayerUID=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($playerId);
    
    my ($name, $sex) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;
    
    my $newPlayer = 0;
    if (defined $name) {
        if ($playerName &amp;&amp; $playerName ne $name) {
		
            $sql = 'UPDATE Player_DATA SET PlayerName=? WHERE PlayerUID=?';
            $sth = $dbh-&gt;prepare ($sql);
            $res = $sth-&gt;execute ($playerName, $playerId);
			
            print STDERR &quot;Changed name of player $playerId from '$name' to '$playerName' in table Player_DATA\n&quot;;
        }
    } else {
        $newPlayer  = 1;
        $playerName = 'Unknown' unless $playerName;
        
        $sql = 'INSERT INTO Player_DATA(PlayerUID, PlayerName) VALUES (?, ?)';
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($playerId, $playerName);
		
        print STDERR &quot;Created a new player $playerId named '$playerName' in table Player_DATA\n&quot;;
    }
    
    $sql = &quot;SELECT CharacterID, Worldspace, Inventory, Backpack, 
            TIMESTAMPDIFF(MINUTE, Datestamp, LastLogin) as SurvivalTime,
            TIMESTAMPDIFF(MINUTE, LastAte, NOW()) as MinsLastAte, 
            TIMESTAMPDIFF(MINUTE, LastDrank, NOW()) as MinsLastDrank,
            Model, Medical, Humanity, KillsZ, HeadshotsZ, KillsH, KillsB, CurrentState, CashMoney  
            FROM  Character_DATA 
            WHERE PlayerUID=? AND Alive = 1 AND InstanceID=? ORDER BY CharacterID DESC LIMIT 1&quot;;
    $sth = $dbh-&gt;prepare ($sql);
    $res = $sth-&gt;execute ($playerId, $serverId);
    
    my ($characterId, $worldSpace, $inventory, $backpack, $survivalTime, $minsLastAte, $minsLastDrank, 
        $model, $medical, $humanity, $killsZ, $headshotsZ, $killsH, $killsB, $currentState, $cashMoney) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;
    
    $currentState = '[]'      unless (defined $currentState);
    $humanity     = 2500      unless (defined $humanity);
	$cashMoney    = 0         unless (defined $cashMoney);
    $medical      = '[]'      unless (defined $medical);
    $worldSpace   = '[]'      unless (defined $worldSpace);
    $inventory    = INVENTORY unless (defined $inventory);  # '[]'
    $backpack     = BACKPACK  unless (defined $backpack);   # '[]'
    $model        = MODEL     unless (defined $model);      # ''
    
    my $survival = '[0,0,0]';
    $survival    = '['.$survivalTime.','.$minsLastAte.','.$minsLastDrank.']' if (defined $survivalTime &amp;&amp; 
                                                                                 defined $minsLastAte  &amp;&amp; 
                                                                                 defined $minsLastDrank);
    my $newChar = 0;
    if (defined $characterId) {
        $sql = 'UPDATE Character_DATA SET LastLogin = CURRENT_TIMESTAMP WHERE CharacterID=?';
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($characterId);
        
        my $stats = '[0,0,0,0]';
        $stats    = '['.$killsZ.','.$headshotsZ.','.$killsH.','.$killsB.']' if (defined $killsZ &amp;&amp; defined $headshotsZ &amp;&amp;
                                                                                defined $killsH &amp;&amp; defined $killsB);        
        my $file = $PLAYERS_DIR.'/'.lc($playerId).'-char.sqf';
        open  (OUT, &quot;&gt;$file&quot;);
        print OUT '[&quot;PASS&quot;,'.$medical.','.$stats.','.$currentState.','.$worldSpace.','.$humanity.',&quot;'.$characterId.'&quot;,'.$cashMoney.']';
        close (OUT); 
    } else {
        $newChar = 1;
        
        $sql = &quot;SELECT Generation, Humanity, Model FROM Character_DATA 
                WHERE PlayerUID=? AND Alive = 0 AND InstanceID=? ORDER BY CharacterID DESC LIMIT 1&quot;;
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($playerId, $serverId);
        
        my ($generation, $humanity, $cmodel) = $sth-&gt;fetchrow_array;
        $sth-&gt;finish;
        
        if (defined $generation) {
            $generation++;
        } else {
            $generation = 1;
        }
        
        $humanity     = 2500      unless (defined $humanity);
		$cashMoney    = 0         unless (defined $cashMoney);
        $model        = $cmodel   if (defined $cmodel); 
        
        $sql = &quot;INSERT INTO Character_DATA(PlayerUID, InstanceID, Worldspace, Inventory, Backpack, Medical,
                                           Generation, Datestamp, LastLogin, LastAte, LastDrank, Humanity, CashMoney) 
                VALUES (?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?)&quot;;
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($playerId, $serverId, $worldSpace, $inventory, $backpack, $medical, $generation, $humanity, $cashMoney);
        
        $sql = 'SELECT CharacterID FROM Character_DATA WHERE PlayerUID=? AND Alive = 1 AND InstanceID=? ORDER BY CharacterID DESC LIMIT 1';
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($playerId, $serverId);
        
        ($characterId) = $sth-&gt;fetchrow_array;
        $sth-&gt;finish;
        
        $playerName = 'Unknown' unless $playerName;
        
        if (defined $characterId) {
            print STDERR &quot;Created a new character $characterId for player '$playerName' ($playerId)\n&quot;;
            my $file = $PLAYERS_DIR.'/'.lc($playerId).'-char.sqf';
            open  (OUT, &quot;&gt;$file&quot;);
            print OUT '[&quot;PASS&quot;,'.$medical.',[0,0,0,0],[],'.$worldSpace.','.$humanity.',&quot;'.$characterId.'&quot;,'.$cashMoney.']';
            close (OUT);
        } else {
            print STDERR &quot;Can't found new character for player '$playerName' ($playerId)\n&quot;;
        }
    }
    
    my $file = $PLAYERS_DIR.'/'.lc($playerId).'.sqf';
    open  (OUT, &quot;&gt;$file&quot;);
    print OUT '[&quot;PASS&quot;,false,&quot;'.$characterId.'&quot;,'.$worldSpace.','.$inventory.','.$backpack.','.$survival.','.$model.',0.96,'.$cashMoney.']';
    close (OUT);
    
    print STDERR &quot;CHILD:101 Save player: $file\n&quot;;
    return $res;
}

# 102
sub h_load_character {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $characterId, $playerId) = @$p;
    unless ($characterId) {
        print STDERR &quot;Error h_load_character(): characterId undefined!\n&quot;;
        return;
    }
    $characterId =~ s/&quot;//g;
    $playerId    =~ s/['&quot;]//g;
    
    if ($characterId == 1 &amp;&amp; $playerId) {
        my $sql = 'SELECT CharacterID FROM Character_DATA WHERE PlayerUID=? AND Alive = 1 AND InstanceID=? ORDER BY CharacterID DESC LIMIT 1';
        my $sth = $dbh-&gt;prepare ($sql);
        my $res = $sth-&gt;execute ($playerId, INSTANCE);
        return unless $res;
        
        ($characterId) = $sth-&gt;fetchrow_array;
        $sth-&gt;finish;
    }
    unless ($characterId) {
        print STDERR &quot;Error h_load_character(): characterId undefined!\n&quot;;
        return;
    }
    
    my $sql = &quot;SELECT Worldspace, Medical, Generation, KillsZ, HeadshotsZ, KillsH, KillsB, CurrentState, Humanity, PlayerUID, CashMoney
               FROM Character_DATA WHERE CharacterID=?&quot;;
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($characterId);
    
    my ($worldSpace, $medical, $generation, $killsZ, $headshotsZ, $killsH, $killsB, $currentState, $humanity, $playerUID, $cashMoney) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;
    return unless (defined $worldSpace);
    
    $playerId = $playerUID if (defined $playerUID);
    
    $worldSpace   ||= '[]';
    $medical      ||= '[]';
    $generation   ||= 1;
    $currentState ||= '[]';
    $humanity       = 2500 unless (defined $humanity);
	$cashMoney      = 0	unless (defined $cashMoney);
    
    my $stats = '[0,0,0,0]';
    $stats    = '['.$killsZ.','.$headshotsZ.','.$killsH.','.$killsB.']' if (defined $killsZ &amp;&amp; defined $headshotsZ &amp;&amp; 
                                                                            defined $killsH &amp;&amp; defined $killsB);
    
    my $file = CACHE_DIR.'players/'.$myPlayerCounter.'/'.lc($playerId).'-char.sqf';
    open  (OUT, &quot;&gt;$file&quot;);
    print OUT '[&quot;PASS&quot;,'.$medical.','.$stats.','.$currentState.','.$worldSpace.','.$humanity.',&quot;'.$characterId.'&quot;,'.$cashMoney.']';
    close (OUT);
    
    print STDERR &quot;CHILD:102 Save character: $file\n&quot;;
    return $res;
}

# 103
sub h_log_login {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $playerId, $characterId, $action) = @$p;
    unless ($playerId) {
        print STDERR &quot;Error h_log_login(): playerId undefined!\n&quot;;
        return;
    }
    $playerId    =~ s/['&quot;]//g;
    $characterId =~ s/&quot;//g;
    
    my $sql = 'INSERT INTO Player_LOGIN(PlayerUID, CharacterID, Datestamp, Action) VALUES (?, ?, CURRENT_TIMESTAMP, ?)';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($playerId, $characterId, $action);
    return $res;
}

# 201
sub h_player_update {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $characterId, $worldSpace, $inventory, $backpack, $medical, $justAte, $justDrank, 
        $killsZ, $headshotsZ, $distanceWalked, $durationLived, $currentState, $killsH, $killsB, $model,
        $humanity, $cashMoney) = @$p;
    unless ($characterId) {
        print STDERR &quot;Error h_player_update(): characterId undefined!\n&quot;;
        return;
    }
    $characterId =~ s/&quot;//g;
    
    if ($worldSpace) {
        my $ws = parse_json ($worldSpace);
        unless ($ws) {
            print STDERR &quot;Error h_player_update(): worldSpace invalid json!\n&quot;;
            return;
        }
        if (@$ws) {
            if ($ws-&gt;[1] &amp;&amp; ref($ws-&gt;[1]) eq 'ARRAY') {
                my ($x, $y) = @{$ws-&gt;[1]};
                if ($x &amp;&amp; $x &lt; -18000) {
                    print STDERR &quot;Error h_player_update(): worldSpace invalid!\n&quot;;
                    return;
                }
            }
        }
    }
    if ($inventory) {
        unless ( parse_json ($inventory) ) {
            print STDERR &quot;Error h_player_update(): inventory invalid json!\n&quot;;
            $inventory = undef;
        }
    }
    if ($backpack) {
        unless ( parse_json ($backpack) ) {
            print STDERR &quot;Error h_player_update(): backpack invalid json!\n&quot;;
            $backpack = undef;
        }
    }
    if ($medical) {
        unless ( parse_json ($medical) ) {
            print STDERR &quot;Error h_player_update(): medical invalid json!\n&quot;;
            $medical = undef;
        }
    }
    if ($currentState) {
        unless ( parse_json ($currentState) ) {
            print STDERR &quot;Error h_player_update(): currentState invalid json!\n&quot;;
            $currentState = undef;
        }
    }
    if ($model) {
        $model = '&quot;'.$model.'&quot;' if (length($model) &gt; 3 &amp;&amp; $model !~ m/&quot;/);
        unless ( parse_json ($model) ) {
            print STDERR &quot;Error h_player_update(): model invalid json!\n&quot;;
            $model = undef;
        }
    }
    
    my $str = '';
    $str .= 'Worldspace='.$dbh-&gt;quote($worldSpace).','            if ($worldSpace &amp;&amp; $worldSpace ne '[]');
    $str .= 'Inventory='.$dbh-&gt;quote($inventory).','              if ($inventory  &amp;&amp; $inventory  ne INVENTORY &amp;&amp; $inventory ne '[]');
    $str .= 'Backpack='.$dbh-&gt;quote($backpack).','                if ($backpack   &amp;&amp; $backpack   ne BACKPACK &amp;&amp; $backpack ne '[]');
    $str .= 'Medical='.$dbh-&gt;quote($medical).','                  if ($medical    &amp;&amp; $medical    ne '[]');
    $str .= 'CurrentState='.$dbh-&gt;quote($currentState).','        if ($currentState &amp;&amp; $currentState ne '[]');
    $str .= 'Model='.$dbh-&gt;quote($model).','                      if ($model &amp;&amp; $model ne MODEL);
    
    $str .= 'LastAte=CURRENT_TIMESTAMP,'                          if ($justAte   &amp;&amp; $justAte   eq 'true');
    $str .= 'LastDrank=CURRENT_TIMESTAMP,'                        if ($justDrank &amp;&amp; $justDrank eq 'true');
    
    $str .= 'KillsZ=KillsZ+'.int($killsZ).','                     if ($killsZ     &amp;&amp; $killsZ &gt; 0);
    $str .= 'HeadshotsZ=HeadshotsZ+'.int($headshotsZ).','         if ($headshotsZ &amp;&amp; $headshotsZ &gt; 0);
    $str .= 'DistanceFoot=DistanceFoot+'.int($distanceWalked).',' if ($distanceWalked &amp;&amp; $distanceWalked &gt; 0);
    $str .= 'KillsH=KillsH+'.int($killsH).','                     if ($killsH     &amp;&amp; $killsH &gt; 0);
    $str .= 'KillsB=KillsB+'.int($killsB).','                     if ($killsB     &amp;&amp; $killsB &gt; 0);
    
    if ($humanity) {    
        if ($humanity &lt; 0) {
            $str .= 'Humanity=Humanity-'.int(-1*$humanity).',';
        } else {
            $str .= 'Humanity=Humanity+'.int($humanity).',';
        }
    }
	
	if ($cashMoney) {    
        if ($cashMoney &lt; 0) {
            $str .= 'CashMoney=CashMoney-'.int(-1*$cashMoney).',';
        } else {
            $str .= 'CashMoney=CashMoney+'.int($cashMoney).',';
        }
    }
	
    return unless $str;
    
    $str .= 'Duration=Duration+'.int($durationLived || 0);
    
    my $sql = 'UPDATE Character_DATA SET ';
    $sql   .= $str;
    $sql   .= ' WHERE CharacterID=?';
    
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($characterId);
    return $res;
}

# 202
sub h_player_death {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $characterId, $duration) = @$p;
    unless ($characterId) {
        print STDERR &quot;Error h_player_death(): characterId undefined!\n&quot;;
        return;
    }
    $characterId =~ s/&quot;//g;
    
    my $sql =  &quot;UPDATE Character_DATA SET Alive = 0, LastLogin = DATE_SUB(CURRENT_TIMESTAMP, INTERVAL ? MINUTE) 
                WHERE CharacterID=? AND Alive = 1&quot;;
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute (int($duration), $characterId);
    return unless $res;    
    
    # Reset profile
    my $playerId = get_playerId_by_characterId ($characterId);
    if ($playerId) {    
        h_load_player ([101, $playerId, INSTANCE]);
		h_load_bank ([298, $playerId, INSTANCE]);
    } else {
        print STDERR &quot;Error h_player_death('$characterId'): playerId not found!\n&quot;;
    }
}

# 204
sub h_player_disconnect {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $playerId) = @$p;
    $playerId =~ s/[A-Z&quot;]//g;
    
    update_player_cache ($playerId);
	update_bank_cache ($playerId);
}

# 298
sub h_load_bank {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $playerId, $serverId, $playerName) = @$p;
    unless ($playerId) {
        print STDERR &quot;Error h_load_bank(): playerId undefined!\n&quot;;
        return;
    }
    $playerId =~ s/['&quot;]//g;
    $serverId ||= INSTANCE;
    
    my $PLAYERS_DIR = CACHE_DIR.'players/'.$myPlayerCounter;
    mkdir ($PLAYERS_DIR) unless (-d $PLAYERS_DIR);
    
    my $sql = 'SELECT PlayerName FROM Banking_DATA WHERE PlayerUID=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($playerId);
    
    my ($name) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;
    
    my $newPlayer = 0;
    if (defined $name) {
        if ($playerName &amp;&amp; $playerName ne $name) {
			$sql = 'UPDATE Banking_DATA SET PlayerName=? WHERE PlayerUID=?';
            $sth = $dbh-&gt;prepare ($sql);
            $res = $sth-&gt;execute ($playerName, $playerId);
            print STDERR &quot;Changed name of player $playerId from '$name' to '$playerName' in table Banking_DATA\n&quot;;
        }
    } else {
        $newPlayer  = 1;
        $playerName = 'Unknown' unless $playerName;
		$sql = 'INSERT INTO Banking_DATA(PlayerUID, PlayerName, LastUpdated) VALUES (?, ?, CURRENT_TIMESTAMP)';
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($playerId, $playerName);
        print STDERR &quot;Created a new player $playerId named '$playerName' in table Banking_DATA\n&quot;;
    }
	
	$sql = &quot;SELECT BankSaldo
            FROM  Banking_DATA 
            WHERE PlayerUID=?&quot;;
    $sth = $dbh-&gt;prepare ($sql);
    $res = $sth-&gt;execute ($playerId);
    
    my ($bankSaldo) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;

	$bankSaldo    = 0         unless (defined $bankSaldo);
    
    my $file = $PLAYERS_DIR.'/'.lc($playerId).'-bank.sqf';
    open  (OUT, &quot;&gt;$file&quot;);
    print OUT '[&quot;PASS&quot;,'.$bankSaldo.']';
    close (OUT);
    
    print STDERR &quot;CHILD:298 Save bank: $file with BankSaldo: $bankSaldo\n&quot;;
    return $res;
}

# 299
sub h_bank_update {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $playerId, $bankSaldo) = @$p;
    unless ($playerId) {
        print STDERR &quot;Error h_player_bank_save(): playerId undefined!\n&quot;;
        return;
    }
    $playerId    =~ s/['&quot;]//g;
	
    my $str = '';
	
	$str .= 'BankSaldo='.int($bankSaldo).',';
	
    return unless $str;
    
    $str .= 'LastUpdated=CURRENT_TIMESTAMP';
    
    my $sql = 'UPDATE Banking_DATA SET ';
    $sql   .= $str;
    $sql   .= ' WHERE PlayerUID=?';
    
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($playerId);
    return $res;
}

# 302
sub h_stream_objects {
    # Clean objects
    for my $sql ('DELETE FROM Object_DATA WHERE Instance=? AND ClassName=&quot;TentStorage&quot; AND (Inventory=&quot;[[[],[]],[[],[]],[[],[]]]&quot; OR Damage=1)',
                 'DELETE FROM Object_DATA where Instance=? AND Damage &gt; 0.9 AND ObjectID &gt; 89') {
        my $sth = $dbh-&gt;prepare ($sql);
        $sth-&gt;execute (INSTANCE);
    }
    
    my $sql = &quot;SELECT ObjectID, CharacterID, Worldspace, Inventory, Hitpoints, Fuel, Damage 
                 FROM Object_init_DATA WHERE Instance=? AND Classname IS NOT NULL ORDER BY ObjectID&quot;;
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute (INSTANCE);
    return unless $res;
    
    my %init = ();
    while (my ($objId, $ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage) = $sth-&gt;fetchrow_array) {
        next unless $objId;

        $ownerId    ||= 0;
        $worldSpace ||= '[]';
        $inventory  ||= '[]';
        $hitpoints  ||= '[]';
        $fuel       ||= 0;
        $damage     ||= 0;
    
        $init{$objId} = [$ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage];
    }
    $sth-&gt;finish;
    
    $sql = &quot;SELECT ObjectID, Classname, CharacterID, Worldspace, Inventory, Hitpoints, Fuel, Damage
            FROM Object_DATA WHERE Instance=? AND Classname IS NOT NULL ORDER BY ObjectID&quot;;
    $sth = $dbh-&gt;prepare ($sql);
    $res = $sth-&gt;execute (INSTANCE);
    return unless $res;
    
    my $str     = '';
    my @updates = ();
    while (my ($objId, $className, $ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage) = $sth-&gt;fetchrow_array) {
        if ( $objId &amp;&amp; $damage &amp;&amp; $damage &gt; 0.7 &amp;&amp; $init{$objId} ) {
            print STDERR &quot;Respawn '$className' ($objId)\n&quot;;
            ($ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage) = @{$init{$objId}};
            push @updates, $objId;
        }
        
        $ownerId    ||= 0;
        $worldSpace ||= '[]';
        $inventory  ||= '[]';
        $hitpoints  ||= '[]';
        $fuel       ||= 0;
        $damage     ||= 0;
        
        $fuel   = sprintf (&quot;%.3f&quot;, $fuel);
        $damage = sprintf (&quot;%.3f&quot;, $damage);
        
        $str .= ',' if $str;
        $str .= '[&quot;OBJ&quot;,&quot;'.$objId.'&quot;,&quot;'.$className.'&quot;,&quot;'.$ownerId.'&quot;,'.$worldSpace.','.$inventory.','.$hitpoints.','.$fuel.','.$damage.']';
    }
    $sth-&gt;finish;
    
    for my $objId (@updates) {
        my ($ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage) = @{$init{$objId}};
        $sql = 'UPDATE Object_DATA SET CharacterID=?, Worldspace=?, Inventory=?, Hitpoints=?, Fuel=?, Damage=? WHERE Instance=? AND ObjectID=?';
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage, INSTANCE, $objId);
    }    
    #return unless $str;
    
    my $file = CACHE_DIR.'objects.sqf';
    open  (OUT, &quot;&gt;$file&quot;);
    print OUT '['.$str.']';
    close (OUT);    
}

# 303
sub h_object_update_inventory {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $objectId, $inventory) = @$p;
    unless ($objectId &amp;&amp; $inventory) {
        print STDERR &quot;Error h_object_update_inventory(): objectId or inventory undefined!\n&quot;;
        return;
    }
    $objectId =~ s/&quot;//g;
    
    unless ( parse_json ($inventory) ) {
        print STDERR &quot;Error h_object_update_inventory($objectId): inventory invalid json!\n&quot;;
        return;
    }
    
    my $sql = 'UPDATE Object_DATA SET Inventory=? WHERE ObjectID=? AND Instance=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($inventory, $objectId, INSTANCE);
    return $res;
}

# 304
sub h_object_delete {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $objectId) = @$p;
    unless ($objectId) {
        print STDERR &quot;Error h_object_delete(): objectId undefined!\n&quot;;
        return;
    }
    $objectId =~ s/&quot;//g;
    
    my $sql = 'DELETE FROM Object_DATA WHERE ObjectID=? AND Instance=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($objectId, INSTANCE);
    
    if ($res) {
        $sql = 'DELETE FROM Object_init_DATA WHERE ObjectID=? AND Instance=?';
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($objectId, INSTANCE);
    }    
    return $res;
}

# 305
sub h_vehicle_moved {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $objectId, $worldSpace, $fuel) = @$p;
    unless ($objectId &amp;&amp; $worldSpace) {
        print STDERR &quot;Error h_vehicle_moved(): objectId undefined!\n&quot;;
        return;
    }
    $objectId =~ s/&quot;//g;
    
    unless ( parse_json ($worldSpace) ) {
        print STDERR &quot;Error h_vehicle_moved($objectId): worldSpace invalid json!\n&quot;;
        return;
    }
    
    my $sql = 'UPDATE Object_DATA SET Worldspace=?, Fuel=? WHERE ObjectID=? AND Instance=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($worldSpace, $fuel, $objectId, INSTANCE);
    return $res;
}

# 306
sub h_vehicle_damaged {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $objectId, $hitPoints, $damage) = @$p;
    unless ($objectId &amp;&amp; defined $hitPoints &amp;&amp; defined $damage) {
        print STDERR &quot;Error h_vehicle_damaged(): objectId undefined!\n&quot;;
        return;
    }
    $objectId =~ s/&quot;//g;
    
    if ($hitPoints) {
        unless ( parse_json ($hitPoints) ) {
            print STDERR &quot;Error h_vehicle_damaged($objectId): hitPoints invalid json!\n&quot;;
            return;
        }
    }
    
    $hitPoints ||= '[]';
    $damage    ||= 0;
    
    my $sql = 'UPDATE Object_DATA SET Hitpoints=?, Damage=? WHERE ObjectID=? AND Instance=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($hitPoints, $damage, $objectId, INSTANCE);
    return $res;
}

# 308
sub h_object_publish {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $serverId, $className, $damage, $characterId, $worldSpace, $inventory, $hitPoints, $fuel, $objectUID) = @$p;
    unless ($className) {
        print STDERR &quot;Error h_object_publish(): className undefined!\n&quot;;
        return;
    }
    $characterId =~ s/&quot;//g;
    $objectUID   =~ s/&quot;//g;
    
    if ($worldSpace) {
        unless ( parse_json ($worldSpace) ) {
            print STDERR &quot;Error h_object_publish($className): worldSpace invalid json!\n&quot;;
            return;
        }
    }
    if ($inventory) {
        unless ( parse_json ($inventory) ) {
            print STDERR &quot;Error h_object_publish($className): inventory invalid json!\n&quot;;
            $inventory = '[]';
        }
    }
    if ($hitPoints) {
        unless ( parse_json ($hitPoints) ) {
            print STDERR &quot;Error h_object_publish($className): hitPoints invalid json!\n&quot;;
            $hitPoints = '[]';
        }
    }
    
    $serverId   ||= INSTANCE;
    $worldSpace ||= '[]';
    $inventory  ||= '[]';
    $hitPoints  ||= '[]';
    $damage     ||= 0;
    $fuel       ||= 0;
    
    my $sql = &quot;INSERT INTO Object_DATA(ObjectUID, Instance, Classname, Damage, CharacterID, Worldspace, Inventory, 
                                       Hitpoints, Fuel, Datestamp) 
               VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)&quot;;
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($objectUID, $serverId, $className, $damage, $characterId, $worldSpace, $inventory, $hitPoints, $fuel);
    
    # Cache object ID
    $sql = 'SELECT ObjectID FROM Object_DATA WHERE ObjectUID=? AND Instance=?';
    $sth = $dbh-&gt;prepare ($sql);
    $res = $sth-&gt;execute ($objectUID, $serverId);
    return unless $res;
                
    my ($objectId) = $sth-&gt;fetchrow_array;
    $sth-&gt;finish;
    return unless (defined $objectId);

    my $file = CACHE_DIR.'objects/'.$objectUID.'.sqf';
    open  (OUT, &quot;&gt;$file&quot;);
    print OUT '[&quot;PASS&quot;,&quot;'.$objectId.'&quot;]';
    close (OUT);
}

# 309
sub h_object_uid_update_inventory {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $objectUID, $inventory) = @$p;
    unless ($objectUID &amp;&amp; $inventory) {
        print STDERR &quot;Error h_object_uid_update_inventory(): objectUID or inventory undefined!\n&quot;;
        return;
    }
    $objectUID =~ s/&quot;//g;
    
    unless ( parse_json ($inventory) ) {
        print STDERR &quot;Error h_object_uid_update_inventory($objectUID): inventory invalid json!\n&quot;;
        return;
    }
    
    my $sql = 'UPDATE Object_DATA SET Inventory=? WHERE ObjectUID=? AND Instance=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($inventory, $objectUID, INSTANCE);
    return $res;
}

# 310
sub h_object_uid_delete {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $objectUID) = @$p;
    unless ($objectUID) {
        print STDERR &quot;Error h_object_uid_delete(): objectUID undefined!\n&quot;;
        return;
    }
    $objectUID =~ s/&quot;//g;
    
    my $sql = 'DELETE FROM Object_DATA WHERE ObjectUID=? AND Instance=?';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($objectUID, INSTANCE);
    
    if ($res) {
        $sql = 'DELETE FROM Object_init_DATA WHERE ObjectUID=? AND Instance=?';
        $sth = $dbh-&gt;prepare ($sql);
        $res = $sth-&gt;execute ($objectUID, INSTANCE);
    }
    return $res;
}

# 388 - loadObjectID
sub h_load_objects_id {
    my $sql = 'SELECT ObjectID, ObjectUID FROM Object_DATA WHERE Instance=? ORDER BY ObjectUID';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute (INSTANCE);
    #return unless $res;
    
    while (my ($objectId, $objectUID) = $sth-&gt;fetchrow_array) {
        next unless (defined $objectId);
        
        my $file = CACHE_DIR.'objects/'.$objectUID.'.sqf';
        open  (OUT, &quot;&gt;$file&quot;);
        print OUT '[&quot;PASS&quot;,&quot;'.$objectId.'&quot;]';
        close (OUT);
    }
    $sth-&gt;finish;
}

# 396
sub h_object_reset_damage {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $oid) = @$p;
    unless ($oid) {
        print STDERR &quot;Error h_object_reset_damage(): objectId undefined!\n&quot;;
        return;
    }
    $oid =~ s/&quot;//g;
    
    my $sth = $dbh-&gt;prepare ('UPDATE Object_DATA SET Damage=0 WHERE ObjectID=? AND Instance=?');
    my $res = $sth-&gt;execute ($oid, INSTANCE);
    return $res;
}

# 397
sub h_object_uid_reset_damage {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $uid) = @$p;
    unless ($uid) {
        print STDERR &quot;Error h_object_uid_reset_damage(): objectUID undefined!\n&quot;;
        return;
    }
    $uid =~ s/&quot;//g;
    
    my $sth = $dbh-&gt;prepare ('UPDATE Object_DATA SET Damage=0 WHERE ObjectUID=? AND Instance=?');
    my $res = $sth-&gt;execute ($uid, INSTANCE);
    return $res;
}

# 398 - tradeObject 
sub h_trade_object {
    my $p = shift;
    return unless ($p &amp;&amp; ref($p) eq 'ARRAY');
    my ($cmd, $traderObjectId, $action) = @$p;
    return unless ($traderObjectId &amp;&amp; defined $action);
    
    my $sql;
    if ($action == 0) {
        $sql = 'UPDATE Traders_DATA SET qty = qty - 1 WHERE id=? AND qty &gt; 0';
    } else {
        $sql = 'UPDATE Traders_DATA SET qty = qty + 1 WHERE id=?';
    }
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ($traderObjectId);    
    return $res;
}

# 399 - loadTraderDetails
sub h_load_trader_details {
    my $sql = 'SELECT id, item, qty, buy, sell, `order`, tid, afile FROM Traders_DATA';
    my $sth = $dbh-&gt;prepare ($sql);
    my $res = $sth-&gt;execute ();
    return unless $res;
    
    my %tids = ();
    my $charecterId = 0;
    while (my ($id, $item, $qty, $buy, $sell, $order, $tid, $afile) = $sth-&gt;fetchrow_array) {
        next unless $tid;
        $tids{$tid} = [] unless $tids{$tid};
        
        push @{$tids{$tid}}, '['.$id.','.$item.','.$qty.','.$buy.','.$sell.','.$order.','.$tid.',&quot;'.$afile.'&quot;]';
    }     
    $sth-&gt;finish;
    
    return unless %tids;
    
    while (my ($tid, $v) = each %tids) {
        next unless ($v &amp;&amp; @$v);
        my $str = join (',', @$v);
    
        my $file = CACHE_DIR.'traders/'.$tid.'.sqf';
        open  (OUT, &quot;&gt;$file&quot;);
        print OUT '['.$str.']';
        close (OUT);
    }
    
    undef %tids;
}



[&quot;PASS&quot;,false,&quot;1&quot;,[],[[],[]],[&quot;&quot;,[],[]],[0,0,0],&quot;Survivor2_DZ&quot;,0.96,0]


[&quot;PASS&quot;,[],[0,0,0,0],[],[],2500,&quot;1&quot;,0]

" data-websharetitle="Inventory Rollbacks" data-webshareurl="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=162320">More sharing options...</button>
</div>
</div>
</div>
</article>
<a id="comment-162353"></a>
<article class="cPost ipsBox ipsResponsive_pull ipsComment ipsComment_parent ipsClearfix ipsClear ipsColumns ipsColumns_noSpacing ipsColumns_collapsePhone" id="elComment_162353">
<div class="cAuthorPane_mobile ipsResponsive_showPhone">
<div class="cAuthorPane_photo">
<div class="cAuthorPane_photoWrap">
<a class="ipsUserPhoto ipsUserPhoto_large" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/12866-leodr99/?do=hovercard" data-ipshover-width="370" href="https://epochmod.com/forum/profile/12866-leodr99/" rel="nofollow" title="Go to leodr99's profile">
<img alt="leodr99" loading="lazy" src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%201024%201024%22%20style%3D%22background%3A%23c4c462%22%3E%3Cg%3E%3Ctext%20text-anchor%3D%22middle%22%20dy%3D%22.35em%22%20x%3D%22512%22%20y%3D%22512%22%20fill%3D%22%23ffffff%22%20font-size%3D%22700%22%20font-family%3D%22-apple-system%2C%20BlinkMacSystemFont%2C%20Roboto%2C%20Helvetica%2C%20Arial%2C%20sans-serif%22%3EL%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fsvg%3E"/>
</a>
<a href="https://epochmod.com/forum/profile/12866-leodr99/badges/" rel="nofollow">
<img alt="Newbie" class="cAuthorPane_badge cAuthorPane_badge--rank ipsOutline ipsOutline:2px" data-ipstooltip="" loading="lazy" src="https://epochmod.com/forum/uploads/monthly_2023_04/1_Newbie.svg" title="Rank: Newbie (1/14)"/>
</a>
</div>
</div>
<div class="cAuthorPane_content">
<h3 class="ipsType_sectionHead cAuthorPane_author ipsType_break ipsType_blendLinks ipsFlex ipsFlex-ai:center">
<a class="ipsType_break" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/12866-leodr99/?do=hovercard&amp;referrer=https%253A%252F%252Fepochmod.com%252Fforum%252Ftopic%252F27487-inventory-rollbacks%252F" data-ipshover-width="370" href="https://epochmod.com/forum/profile/12866-leodr99/" rel="nofollow" title="Go to leodr99's profile"><span style="color:#">leodr99</span></a>
</h3>
<div class="ipsType_light ipsType_reset">
<a class="ipsType_blendLinks" href="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=162353" rel="nofollow">Posted <time data-short="10 yr" datetime="2014-11-01T14:57:44Z" title="11/01/14 02:57  PM">November 1, 2014</time></a>
</div>
</div>
</div>
<aside class="ipsComment_author cAuthorPane ipsColumn ipsColumn_medium ipsResponsive_hidePhone">
<h3 class="ipsType_sectionHead cAuthorPane_author ipsType_blendLinks ipsType_break"><strong>
<a class="ipsType_break" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/12866-leodr99/?do=hovercard&amp;referrer=https%253A%252F%252Fepochmod.com%252Fforum%252Ftopic%252F27487-inventory-rollbacks%252F" data-ipshover-width="370" href="https://epochmod.com/forum/profile/12866-leodr99/" rel="nofollow" title="Go to leodr99's profile">leodr99</a></strong>
</h3>
<ul class="cAuthorPane_info ipsList_reset">
<li class="cAuthorPane_photo" data-role="photo">
<div class="cAuthorPane_photoWrap">
<a class="ipsUserPhoto ipsUserPhoto_large" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/12866-leodr99/?do=hovercard" data-ipshover-width="370" href="https://epochmod.com/forum/profile/12866-leodr99/" rel="nofollow" title="Go to leodr99's profile">
<img alt="leodr99" loading="lazy" src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%201024%201024%22%20style%3D%22background%3A%23c4c462%22%3E%3Cg%3E%3Ctext%20text-anchor%3D%22middle%22%20dy%3D%22.35em%22%20x%3D%22512%22%20y%3D%22512%22%20fill%3D%22%23ffffff%22%20font-size%3D%22700%22%20font-family%3D%22-apple-system%2C%20BlinkMacSystemFont%2C%20Roboto%2C%20Helvetica%2C%20Arial%2C%20sans-serif%22%3EL%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fsvg%3E"/>
</a>
<img alt="Newbie" class="cAuthorPane_badge cAuthorPane_badge--rank ipsOutline ipsOutline:2px" data-ipstooltip="" loading="lazy" src="https://epochmod.com/forum/uploads/monthly_2023_04/1_Newbie.svg" title="Rank: Newbie (1/14)"/>
</div>
</li>
<li data-role="group"><span style="color:#">Member</span></li>
<li class="ipsMargin_top" data-role="stats">
<ul class="ipsList_reset ipsType_light ipsFlex ipsFlex-ai:center ipsFlex-jc:center ipsGap_row:2 cAuthorPane_stats">
<li>
<a class="ipsType_blendLinks" data-ipstooltip="" href="https://epochmod.com/forum/profile/12866-leodr99/content/" rel="nofollow" title="4 posts">
<i class="fa fa-comment"></i> 4
							
								</a>
</li>
</ul>
</li>
</ul>
</aside>
<div class="ipsColumn ipsColumn_fluid ipsMargin:none">
<div class="ipsComment_content ipsType_medium" data-commentapp="forums" data-commentid="162353" data-commenttype="forums" data-controller="core.front.core.comment" data-quotedata='{"userid":12866,"username":"leodr99","timestamp":1414853864,"contentapp":"forums","contenttype":"forums","contentid":27487,"contentclass":"forums_Topic","contentcommentid":162353}' id="comment-162353_wrap">
<div class="ipsComment_meta ipsType_light ipsFlex ipsFlex-ai:center ipsFlex-jc:between ipsFlex-fd:row-reverse">
<div class="ipsType_light ipsType_reset ipsType_blendLinks ipsComment_toolWrap">
<div class="ipsResponsive_hidePhone ipsComment_badges">
<ul class="ipsList_reset ipsFlex ipsFlex-jc:end ipsFlex-fw:wrap ipsGap:2 ipsGap_row:1">
</ul>
</div>
<ul class="ipsList_reset ipsComment_tools">
<li>
<a class="ipsComment_ellipsis" data-ipsmenu="" data-ipsmenu-appendto="#comment-162353_wrap" href="#elControls_162353_menu" id="elControls_162353" title="More options..."><i class="fa fa-ellipsis-h"></i></a>
<ul class="ipsMenu ipsMenu_narrow ipsHide" id="elControls_162353_menu">
<li class="ipsMenu_item"><a data-action="reportComment" data-ipsdialog="" data-ipsdialog-flashmessage="Thanks for your report." data-ipsdialog-remotesubmit="" data-ipsdialog-size="medium" data-ipsdialog-title="Report post" href="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=reportComment&amp;comment=162353" title="Report this content">Report</a></li>
<li class="ipsMenu_item"><a data-ipsdialog="" data-ipsdialog-content="#elShareComment_162353_menu" data-ipsdialog-size="narrow" data-ipsdialog-title="Share this post" data-role="shareComment" href="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=162353" id="elSharePost_162353" rel="nofollow" title="Share this post">Share</a></li>
</ul>
</li>
</ul>
</div>
<div class="ipsType_reset ipsResponsive_hidePhone">
<a class="ipsType_blendLinks" href="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=162353" rel="nofollow">Posted <time data-short="10 yr" datetime="2014-11-01T14:57:44Z" title="11/01/14 02:57  PM">November 1, 2014</time></a>
<span class="ipsResponsive_hidePhone">
</span>
</div>
</div>
<div class="cPost_contentWrap">
<div class="ipsType_normal ipsType_richText ipsPadding_bottom ipsContained" data-controller="core.front.core.lightboxedImages" data-role="commentContent">
<p>Hi there,</p>
<p> </p>
<p>Does this happens during player relog, or before/after server restart?</p>
<p>If it happens just before/after server restart, you need to edit the server start script to clear the player cache folder, in order to update the latter upon server start with the player loadout on the database. <iframe data-embed-src="https://epochmod.com/forum/index.php?/topic/12561-rollbacks-empty-backpack-missing-items-double-processes-yellowred-chains/&amp;do=embed&amp;embedComment=89108.&amp;embedDo=findComment" data-embedcontent="" frameborder="0" src="http://epochmod.com/forum/applications/core/interface/js/spacer.png"></iframe></p>
<p>Just look for the <u>epoch.sh</u> script file on the game root folder and add this after the <strong>export LD_LIB...</strong> line, like so:</p>
<p> </p>
<div>
<pre class="ipsCode prettyprint">
export LD_LIBRARY_PATH=.:/usr/lib32:$LD_LIBRARY_PATH
# Clear the cache to eliminate the rollback bug
rm -rf cache/players/*
rm -rf cache/traders/*
rm -rf cache/objects/*</pre>
<p>This will make it, that just before the server start it will recreate the player cache files with the up-to-date data in the database.</p>
<p> </p>
<p>Cheers.</p>
</div>
</div>
</div>
<div class="ipsPadding ipsHide cPostShareMenu" id="elShareComment_162353_menu">
<h5 class="ipsType_normal ipsType_reset">Link to comment</h5>
<input class="ipsField_fullWidth" type="text" value="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=162353"/>
<h5 class="ipsType_normal ipsType_reset ipsSpacer_top">Share on other sites</h5>
<ul class="ipsList_inline ipsList_noSpacing ipsClearfix" data-controller="core.front.core.sharelink">
<li>
<a class="cShareLink cShareLink_twitter" data-ipstooltip="" data-role="shareLink" href="https://twitter.com/share?url=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F%3Fdo%3DfindComment%26comment%3D162353" rel="nofollow noopener" target="_blank" title="Share on Twitter">
<i class="fa fa-twitter"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_facebook" data-ipstooltip="" data-role="shareLink" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F%3Fdo%3DfindComment%26comment%3D162353" rel="noopener nofollow" target="_blank" title="Share on Facebook">
<i class="fa fa-facebook"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_reddit" data-ipstooltip="" href="https://www.reddit.com/submit?url=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F%3Fdo%3DfindComment%26comment%3D162353&amp;title=Inventory+Rollbacks" rel="nofollow noopener" target="_blank" title="Share on Reddit">
<i class="fa fa-reddit"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_pinterest" data-ipstooltip="" data-role="shareLink" href="https://pinterest.com/pin/create/button/?url=https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment%26comment=162353&amp;media=https://epochmod.com/forum/uploads/monthly_2018_04/logo_only_black.png.c85695b79cad231dd136cd63c4db8256.png" rel="nofollow noopener" target="_blank" title="Share on Pinterest">
<i class="fa fa-pinterest"></i>
</a></li>
</ul>
<hr class="ipsHr"/>
<button class="ipsHide ipsButton ipsButton_small ipsButton_light ipsButton_fullWidth ipsMargin_top:half" data-controller="core.front.core.webshare" data-role="webShare" data-websharetext="Hi there, 
  
Does this happens during player relog, or before/after server restart? 
If it happens just before/after server restart, you need to edit the server start script to clear the player cache folder, in order to update the latter upon server start with the player loadout on the database.  
Just look for the epoch.sh script file on the game root folder and add this after the export LD_LIB... line, like so: 
  


export LD_LIBRARY_PATH=.:/usr/lib32:$LD_LIBRARY_PATH
# Clear the cache to eliminate the rollback bug
rm -rf cache/players/*
rm -rf cache/traders/*
rm -rf cache/objects/*
This will make it, that just before the server start it will recreate the player cache files with the up-to-date data in the database. 
  
Cheers. 

" data-websharetitle="Inventory Rollbacks" data-webshareurl="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=162353">More sharing options...</button>
</div>
</div>
</div>
</article>
<a id="comment-162363"></a>
<article class="cPost ipsBox ipsResponsive_pull ipsComment ipsComment_parent ipsClearfix ipsClear ipsColumns ipsColumns_noSpacing ipsColumns_collapsePhone" id="elComment_162363">
<div class="cAuthorPane_mobile ipsResponsive_showPhone">
<div class="cAuthorPane_photo">
<div class="cAuthorPane_photoWrap">
<a class="ipsUserPhoto ipsUserPhoto_large" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/15715-backtrack/?do=hovercard" data-ipshover-width="370" href="../../profile/15715-backtrack/index.html" rel="nofollow" title="Go to Backtrack's profile">
<img alt="Backtrack" loading="lazy" src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%201024%201024%22%20style%3D%22background%3A%2362a8c4%22%3E%3Cg%3E%3Ctext%20text-anchor%3D%22middle%22%20dy%3D%22.35em%22%20x%3D%22512%22%20y%3D%22512%22%20fill%3D%22%23ffffff%22%20font-size%3D%22700%22%20font-family%3D%22-apple-system%2C%20BlinkMacSystemFont%2C%20Roboto%2C%20Helvetica%2C%20Arial%2C%20sans-serif%22%3EB%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fsvg%3E"/>
</a>
<a href="../../profile/15715-backtrack/badges/index.html" rel="nofollow">
<img alt="Newbie" class="cAuthorPane_badge cAuthorPane_badge--rank ipsOutline ipsOutline:2px" data-ipstooltip="" loading="lazy" src="https://epochmod.com/forum/uploads/monthly_2023_04/1_Newbie.svg" title="Rank: Newbie (1/14)"/>
</a>
</div>
</div>
<div class="cAuthorPane_content">
<h3 class="ipsType_sectionHead cAuthorPane_author ipsType_break ipsType_blendLinks ipsFlex ipsFlex-ai:center">
<a class="ipsType_break" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/15715-backtrack/?do=hovercard&amp;referrer=https%253A%252F%252Fepochmod.com%252Fforum%252Ftopic%252F27487-inventory-rollbacks%252F" data-ipshover-width="370" href="../../profile/15715-backtrack/index.html" rel="nofollow" title="Go to Backtrack's profile"><span style="color:#">Backtrack</span></a>
</h3>
<div class="ipsType_light ipsType_reset">
<a class="ipsType_blendLinks" href="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=162363" rel="nofollow">Posted <time data-short="10 yr" datetime="2014-11-01T15:23:16Z" title="11/01/14 03:23  PM">November 1, 2014</time></a>
</div>
</div>
</div>
<aside class="ipsComment_author cAuthorPane ipsColumn ipsColumn_medium ipsResponsive_hidePhone">
<h3 class="ipsType_sectionHead cAuthorPane_author ipsType_blendLinks ipsType_break"><strong>
<a class="ipsType_break" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/15715-backtrack/?do=hovercard&amp;referrer=https%253A%252F%252Fepochmod.com%252Fforum%252Ftopic%252F27487-inventory-rollbacks%252F" data-ipshover-width="370" href="../../profile/15715-backtrack/index.html" rel="nofollow" title="Go to Backtrack's profile">Backtrack</a></strong>
</h3>
<ul class="cAuthorPane_info ipsList_reset">
<li class="cAuthorPane_photo" data-role="photo">
<div class="cAuthorPane_photoWrap">
<a class="ipsUserPhoto ipsUserPhoto_large" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/15715-backtrack/?do=hovercard" data-ipshover-width="370" href="../../profile/15715-backtrack/index.html" rel="nofollow" title="Go to Backtrack's profile">
<img alt="Backtrack" loading="lazy" src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%201024%201024%22%20style%3D%22background%3A%2362a8c4%22%3E%3Cg%3E%3Ctext%20text-anchor%3D%22middle%22%20dy%3D%22.35em%22%20x%3D%22512%22%20y%3D%22512%22%20fill%3D%22%23ffffff%22%20font-size%3D%22700%22%20font-family%3D%22-apple-system%2C%20BlinkMacSystemFont%2C%20Roboto%2C%20Helvetica%2C%20Arial%2C%20sans-serif%22%3EB%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fsvg%3E"/>
</a>
<img alt="Newbie" class="cAuthorPane_badge cAuthorPane_badge--rank ipsOutline ipsOutline:2px" data-ipstooltip="" loading="lazy" src="https://epochmod.com/forum/uploads/monthly_2023_04/1_Newbie.svg" title="Rank: Newbie (1/14)"/>
</div>
</li>
<li data-role="group"><span style="color:#">Member</span></li>
<li class="ipsMargin_top" data-role="stats">
<ul class="ipsList_reset ipsType_light ipsFlex ipsFlex-ai:center ipsFlex-jc:center ipsGap_row:2 cAuthorPane_stats">
<li>
<a class="ipsType_blendLinks" data-ipstooltip="" href="../../profile/15715-backtrack/content/index.html" rel="nofollow" title="154 posts">
<i class="fa fa-comment"></i> 154
							
								</a>
</li>
</ul>
</li>
</ul>
</aside>
<div class="ipsColumn ipsColumn_fluid ipsMargin:none">
<div class="ipsComment_content ipsType_medium" data-commentapp="forums" data-commentid="162363" data-commenttype="forums" data-controller="core.front.core.comment" data-quotedata='{"userid":15715,"username":"Backtrack","timestamp":1414855396,"contentapp":"forums","contenttype":"forums","contentid":27487,"contentclass":"forums_Topic","contentcommentid":162363}' id="comment-162363_wrap">
<div class="ipsComment_meta ipsType_light ipsFlex ipsFlex-ai:center ipsFlex-jc:between ipsFlex-fd:row-reverse">
<div class="ipsType_light ipsType_reset ipsType_blendLinks ipsComment_toolWrap">
<div class="ipsResponsive_hidePhone ipsComment_badges">
<ul class="ipsList_reset ipsFlex ipsFlex-jc:end ipsFlex-fw:wrap ipsGap:2 ipsGap_row:1">
<li><strong class="ipsBadge ipsBadge_large ipsComment_authorBadge">Author</strong></li>
</ul>
</div>
<ul class="ipsList_reset ipsComment_tools">
<li>
<a class="ipsComment_ellipsis" data-ipsmenu="" data-ipsmenu-appendto="#comment-162363_wrap" href="#elControls_162363_menu" id="elControls_162363" title="More options..."><i class="fa fa-ellipsis-h"></i></a>
<ul class="ipsMenu ipsMenu_narrow ipsHide" id="elControls_162363_menu">
<li class="ipsMenu_item"><a data-action="reportComment" data-ipsdialog="" data-ipsdialog-flashmessage="Thanks for your report." data-ipsdialog-remotesubmit="" data-ipsdialog-size="medium" data-ipsdialog-title="Report post" href="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=reportComment&amp;comment=162363" title="Report this content">Report</a></li>
<li class="ipsMenu_item"><a data-ipsdialog="" data-ipsdialog-content="#elShareComment_162363_menu" data-ipsdialog-size="narrow" data-ipsdialog-title="Share this post" data-role="shareComment" href="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=162363" id="elSharePost_162363" rel="nofollow" title="Share this post">Share</a></li>
</ul>
</li>
</ul>
</div>
<div class="ipsType_reset ipsResponsive_hidePhone">
<a class="ipsType_blendLinks" href="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=162363" rel="nofollow">Posted <time data-short="10 yr" datetime="2014-11-01T15:23:16Z" title="11/01/14 03:23  PM">November 1, 2014</time></a>
<span class="ipsResponsive_hidePhone">
</span>
</div>
</div>
<div class="cPost_contentWrap">
<div class="ipsType_normal ipsType_richText ipsPadding_bottom ipsContained" data-controller="core.front.core.lightboxedImages" data-role="commentContent">
<p>It is only after relog</p>
</div>
</div>
<div class="ipsPadding ipsHide cPostShareMenu" id="elShareComment_162363_menu">
<h5 class="ipsType_normal ipsType_reset">Link to comment</h5>
<input class="ipsField_fullWidth" type="text" value="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=162363"/>
<h5 class="ipsType_normal ipsType_reset ipsSpacer_top">Share on other sites</h5>
<ul class="ipsList_inline ipsList_noSpacing ipsClearfix" data-controller="core.front.core.sharelink">
<li>
<a class="cShareLink cShareLink_twitter" data-ipstooltip="" data-role="shareLink" href="https://twitter.com/share?url=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F%3Fdo%3DfindComment%26comment%3D162363" rel="nofollow noopener" target="_blank" title="Share on Twitter">
<i class="fa fa-twitter"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_facebook" data-ipstooltip="" data-role="shareLink" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F%3Fdo%3DfindComment%26comment%3D162363" rel="noopener nofollow" target="_blank" title="Share on Facebook">
<i class="fa fa-facebook"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_reddit" data-ipstooltip="" href="https://www.reddit.com/submit?url=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F%3Fdo%3DfindComment%26comment%3D162363&amp;title=Inventory+Rollbacks" rel="nofollow noopener" target="_blank" title="Share on Reddit">
<i class="fa fa-reddit"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_pinterest" data-ipstooltip="" data-role="shareLink" href="https://pinterest.com/pin/create/button/?url=https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment%26comment=162363&amp;media=https://epochmod.com/forum/uploads/monthly_2018_04/logo_only_black.png.c85695b79cad231dd136cd63c4db8256.png" rel="nofollow noopener" target="_blank" title="Share on Pinterest">
<i class="fa fa-pinterest"></i>
</a></li>
</ul>
<hr class="ipsHr"/>
<button class="ipsHide ipsButton ipsButton_small ipsButton_light ipsButton_fullWidth ipsMargin_top:half" data-controller="core.front.core.webshare" data-role="webShare" data-websharetext="It is only after relog 
" data-websharetitle="Inventory Rollbacks" data-webshareurl="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=162363">More sharing options...</button>
</div>
</div>
</div>
</article>
<a id="comment-164357"></a>
<article class="cPost ipsBox ipsResponsive_pull ipsComment ipsComment_parent ipsClearfix ipsClear ipsColumns ipsColumns_noSpacing ipsColumns_collapsePhone" id="elComment_164357">
<div class="cAuthorPane_mobile ipsResponsive_showPhone">
<div class="cAuthorPane_photo">
<div class="cAuthorPane_photoWrap">
<a class="ipsUserPhoto ipsUserPhoto_large" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/12468-a-pollo/?do=hovercard" data-ipshover-width="370" href="../../profile/12468-a-pollo/index.html" rel="nofollow" title="Go to A Pollo's profile">
<img alt="A Pollo" loading="lazy" src="https://epochmod.com/forum/uploads/profile/photo-thumb-12468.jpg"/>
</a>
<a href="../../profile/12468-a-pollo/badges/index.html" rel="nofollow">
<img alt="Newbie" class="cAuthorPane_badge cAuthorPane_badge--rank ipsOutline ipsOutline:2px" data-ipstooltip="" loading="lazy" src="https://epochmod.com/forum/uploads/monthly_2023_04/1_Newbie.svg" title="Rank: Newbie (1/14)"/>
</a>
</div>
</div>
<div class="cAuthorPane_content">
<h3 class="ipsType_sectionHead cAuthorPane_author ipsType_break ipsType_blendLinks ipsFlex ipsFlex-ai:center">
<a class="ipsType_break" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/12468-a-pollo/?do=hovercard&amp;referrer=https%253A%252F%252Fepochmod.com%252Fforum%252Ftopic%252F27487-inventory-rollbacks%252F" data-ipshover-width="370" href="../../profile/12468-a-pollo/index.html" rel="nofollow" title="Go to A Pollo's profile"><span style="color:#">A Pollo</span></a>
</h3>
<div class="ipsType_light ipsType_reset">
<a class="ipsType_blendLinks" href="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=164357" rel="nofollow">Posted <time data-short="10 yr" datetime="2014-11-05T06:26:29Z" title="11/05/14 06:26  AM">November 5, 2014</time></a>
</div>
</div>
</div>
<aside class="ipsComment_author cAuthorPane ipsColumn ipsColumn_medium ipsResponsive_hidePhone">
<h3 class="ipsType_sectionHead cAuthorPane_author ipsType_blendLinks ipsType_break"><strong>
<a class="ipsType_break" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/12468-a-pollo/?do=hovercard&amp;referrer=https%253A%252F%252Fepochmod.com%252Fforum%252Ftopic%252F27487-inventory-rollbacks%252F" data-ipshover-width="370" href="../../profile/12468-a-pollo/index.html" rel="nofollow" title="Go to A Pollo's profile">A Pollo</a></strong>
</h3>
<ul class="cAuthorPane_info ipsList_reset">
<li class="cAuthorPane_photo" data-role="photo">
<div class="cAuthorPane_photoWrap">
<a class="ipsUserPhoto ipsUserPhoto_large" data-ipshover="" data-ipshover-target="https://epochmod.com/forum/profile/12468-a-pollo/?do=hovercard" data-ipshover-width="370" href="../../profile/12468-a-pollo/index.html" rel="nofollow" title="Go to A Pollo's profile">
<img alt="A Pollo" loading="lazy" src="https://epochmod.com/forum/uploads/profile/photo-thumb-12468.jpg"/>
</a>
<img alt="Newbie" class="cAuthorPane_badge cAuthorPane_badge--rank ipsOutline ipsOutline:2px" data-ipstooltip="" loading="lazy" src="https://epochmod.com/forum/uploads/monthly_2023_04/1_Newbie.svg" title="Rank: Newbie (1/14)"/>
</div>
</li>
<li data-role="group"><span style="color:#">Member</span></li>
<li class="ipsMargin_top" data-role="stats">
<ul class="ipsList_reset ipsType_light ipsFlex ipsFlex-ai:center ipsFlex-jc:center ipsGap_row:2 cAuthorPane_stats">
<li>
<a class="ipsType_blendLinks" data-ipstooltip="" href="../../profile/12468-a-pollo/content/index.html" rel="nofollow" title="37 posts">
<i class="fa fa-comment"></i> 37
							
								</a>
</li>
</ul>
</li>
<li class="ipsResponsive_hidePhone ipsType_break" data-role="custom-field">
<span class="ft">Location</span><span class="fc">Texas</span>
</li>
</ul>
</aside>
<div class="ipsColumn ipsColumn_fluid ipsMargin:none">
<div class="ipsComment_content ipsType_medium" data-commentapp="forums" data-commentid="164357" data-commenttype="forums" data-controller="core.front.core.comment" data-quotedata='{"userid":12468,"username":"A Pollo","timestamp":1415168789,"contentapp":"forums","contenttype":"forums","contentid":27487,"contentclass":"forums_Topic","contentcommentid":164357}' id="comment-164357_wrap">
<div class="ipsComment_meta ipsType_light ipsFlex ipsFlex-ai:center ipsFlex-jc:between ipsFlex-fd:row-reverse">
<div class="ipsType_light ipsType_reset ipsType_blendLinks ipsComment_toolWrap">
<div class="ipsResponsive_hidePhone ipsComment_badges">
<ul class="ipsList_reset ipsFlex ipsFlex-jc:end ipsFlex-fw:wrap ipsGap:2 ipsGap_row:1">
</ul>
</div>
<ul class="ipsList_reset ipsComment_tools">
<li>
<a class="ipsComment_ellipsis" data-ipsmenu="" data-ipsmenu-appendto="#comment-164357_wrap" href="#elControls_164357_menu" id="elControls_164357" title="More options..."><i class="fa fa-ellipsis-h"></i></a>
<ul class="ipsMenu ipsMenu_narrow ipsHide" id="elControls_164357_menu">
<li class="ipsMenu_item"><a data-action="reportComment" data-ipsdialog="" data-ipsdialog-flashmessage="Thanks for your report." data-ipsdialog-remotesubmit="" data-ipsdialog-size="medium" data-ipsdialog-title="Report post" href="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=reportComment&amp;comment=164357" title="Report this content">Report</a></li>
<li class="ipsMenu_item"><a data-ipsdialog="" data-ipsdialog-content="#elShareComment_164357_menu" data-ipsdialog-size="narrow" data-ipsdialog-title="Share this post" data-role="shareComment" href="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=164357" id="elSharePost_164357" rel="nofollow" title="Share this post">Share</a></li>
</ul>
</li>
</ul>
</div>
<div class="ipsType_reset ipsResponsive_hidePhone">
<a class="ipsType_blendLinks" href="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=164357" rel="nofollow">Posted <time data-short="10 yr" datetime="2014-11-05T06:26:29Z" title="11/05/14 06:26  AM">November 5, 2014</time></a>
<span class="ipsResponsive_hidePhone">
</span>
</div>
</div>
<div class="cPost_contentWrap">
<div class="ipsType_normal ipsType_richText ipsPadding_bottom ipsContained" data-controller="core.front.core.lightboxedImages" data-role="commentContent">
<blockquote class="ipsQuote" data-cite="Backtrack" data-ipsquote="" data-ipsquote-contentclass="forums_Topic" data-ipsquote-contentcommentid="162363" data-ipsquote-contentid="27487" data-ipsquote-contenttype="forums" data-ipsquote-timestamp="1414855396" data-ipsquote-username="Backtrack"><div>
<div>
<p>It is only after relog</p>
</div>
</div></blockquote>
<p> </p>
<p>It looks like you're using Dean's Gold Coin thing. Make sure your server_playerSetup.sqf is the one we supplied.</p>
</div>
</div>
<div class="ipsPadding ipsHide cPostShareMenu" id="elShareComment_164357_menu">
<h5 class="ipsType_normal ipsType_reset">Link to comment</h5>
<input class="ipsField_fullWidth" type="text" value="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=164357"/>
<h5 class="ipsType_normal ipsType_reset ipsSpacer_top">Share on other sites</h5>
<ul class="ipsList_inline ipsList_noSpacing ipsClearfix" data-controller="core.front.core.sharelink">
<li>
<a class="cShareLink cShareLink_twitter" data-ipstooltip="" data-role="shareLink" href="https://twitter.com/share?url=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F%3Fdo%3DfindComment%26comment%3D164357" rel="nofollow noopener" target="_blank" title="Share on Twitter">
<i class="fa fa-twitter"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_facebook" data-ipstooltip="" data-role="shareLink" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F%3Fdo%3DfindComment%26comment%3D164357" rel="noopener nofollow" target="_blank" title="Share on Facebook">
<i class="fa fa-facebook"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_reddit" data-ipstooltip="" href="https://www.reddit.com/submit?url=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F%3Fdo%3DfindComment%26comment%3D164357&amp;title=Inventory+Rollbacks" rel="nofollow noopener" target="_blank" title="Share on Reddit">
<i class="fa fa-reddit"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_pinterest" data-ipstooltip="" data-role="shareLink" href="https://pinterest.com/pin/create/button/?url=https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment%26comment=164357&amp;media=https://epochmod.com/forum/uploads/monthly_2018_04/logo_only_black.png.c85695b79cad231dd136cd63c4db8256.png" rel="nofollow noopener" target="_blank" title="Share on Pinterest">
<i class="fa fa-pinterest"></i>
</a></li>
</ul>
<hr class="ipsHr"/>
<button class="ipsHide ipsButton ipsButton_small ipsButton_light ipsButton_fullWidth ipsMargin_top:half" data-controller="core.front.core.webshare" data-role="webShare" data-websharetext="It looks like you're using Dean's Gold Coin thing. Make sure your server_playerSetup.sqf is the one we supplied. 
" data-websharetitle="Inventory Rollbacks" data-webshareurl="https://epochmod.com/forum/topic/27487-inventory-rollbacks/?do=findComment&amp;comment=164357">More sharing options...</button>
</div>
</div>
</div>
</article>
<input name="csrfKey" type="hidden" value="bbd96aef55be1a90d685e56a4524d73a">
</input></form>
</div>
<a id="replyForm"></a>
<div class="cTopicPostArea ipsBox ipsResponsive_pull ipsPadding cTopicPostArea_noSize ipsSpacer_top" data-role="replyArea">
<div>
<input name="csrfKey" type="hidden" value="bbd96aef55be1a90d685e56a4524d73a"/>
<div class="ipsType_center ipsPad">
<h2 class="ipsType_pageTitle">Please sign in to comment</h2>
<p class="ipsType_light ipsType_normal ipsType_reset ipsSpacer_top ipsSpacer_half">You will be able to leave a comment after signing in</p>
<br/>
<br/>
<a class="ipsButton ipsButton_alternate ipsButton_large" data-ipsdialog="" data-ipsdialog-remoteverify="false" data-ipsdialog-size="medium" data-ipsdialog-title="Sign In Now" href="https://epochmod.com/forum/login/?ref=aHR0cHM6Ly9kNDIyLmVwb2NobW9kLmNvbS9mb3J1bS90b3BpYy8yNzQ4Ny1pbnZlbnRvcnktcm9sbGJhY2tzLyNyZXBseUZvcm0=">Sign In Now</a>
</div>
</div>
</div>
<div class="ipsBox ipsPadding ipsResponsive_pull ipsResponsive_showPhone ipsMargin_top">
<div class="ipsShareLinks">
<a class="ipsShareButton ipsButton ipsButton_verySmall ipsButton_light" data-ipsmenu="" href="#elShareItem_menu" id="elShareItem">
<span><i class="fa fa-share-alt"></i></span>  Share
    </a>
<div class="ipsPadding ipsMenu ipsMenu_auto ipsHide" data-controller="core.front.core.sharelink" id="elShareItem_menu">
<ul class="ipsList_inline">
<li>
<a class="cShareLink cShareLink_twitter" data-ipstooltip="" data-role="shareLink" href="https://twitter.com/share?url=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F" rel="nofollow noopener" target="_blank" title="Share on Twitter">
<i class="fa fa-twitter"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_facebook" data-ipstooltip="" data-role="shareLink" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F" rel="noopener nofollow" target="_blank" title="Share on Facebook">
<i class="fa fa-facebook"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_reddit" data-ipstooltip="" href="https://www.reddit.com/submit?url=https%3A%2F%2Fepochmod.com%2Fforum%2Ftopic%2F27487-inventory-rollbacks%2F&amp;title=Inventory+Rollbacks" rel="nofollow noopener" target="_blank" title="Share on Reddit">
<i class="fa fa-reddit"></i>
</a></li>
<li>
<a class="cShareLink cShareLink_pinterest" data-ipstooltip="" data-role="shareLink" href="https://pinterest.com/pin/create/button/?url=https://epochmod.com/forum/topic/27487-inventory-rollbacks/&amp;media=https://epochmod.com/forum/uploads/monthly_2018_04/logo_only_black.png.c85695b79cad231dd136cd63c4db8256.png" rel="nofollow noopener" target="_blank" title="Share on Pinterest">
<i class="fa fa-pinterest"></i>
</a></li>
</ul>
<hr class="ipsHr"/>
<button class="ipsHide ipsButton ipsButton_verySmall ipsButton_light ipsButton_fullWidth ipsMargin_top:half" data-controller="core.front.core.webshare" data-role="webShare" data-websharetext="Inventory Rollbacks" data-websharetitle="Inventory Rollbacks" data-webshareurl="index.html">More sharing options...</button>
</div>
<div data-controller="core.front.core.followButton" data-followapp="forums" data-followarea="topic" data-followid="27487">
<a class="ipsFollow ipsPos_middle ipsButton ipsButton_light ipsButton_verySmall ipsButton_disabled" data-ipstooltip="" data-role="followButton" href="https://epochmod.com/forum/login/" rel="nofollow" title="Sign in to follow this">
<span>Followers</span>
<span class="ipsCommentCount">0</span>
</a>
</div>
</div>
</div>
</div>
<div class="ipsPager ipsSpacer_top">
<div class="ipsPager_prev">
<a href="../../forum/50-epoch-linux-server/index.html" rel="parent" title="Go to Epoch Linux Server">
<span class="ipsPager_type">Go to topic listing</span>
</a>
</div>
</div>
<div class="cWidgetContainer" data-orientation="horizontal" data-role="widgetReceiver" data-widgetarea="footer">
<ul class="ipsList_reset">
<li class="ipsWidget ipsWidget_horizontal ipsBox ipsWidgetHide ipsHide" data-blockconfig="true" data-blockerrormessage="This block cannot be shown. This could be because it needs configuring, is unable to show on this page, or will show after reloading this page." data-blockid="app_core_relatedContent_sido2emh4" data-blocktitle="Similar Content" data-controller="core.front.widgets.block"></li>
<li class="ipsWidget ipsWidget_horizontal ipsBox" data-blockconfig="true" data-blockerrormessage="This block cannot be shown. This could be because it needs configuring, is unable to show on this page, or will show after reloading this page." data-blockid="app_cms_Blocks_mtkskjhzs" data-blocktitle="Custom Blocks" data-controller="core.front.widgets.block">
Advertisement


</li>
</ul>
</div>
</div>
<div class="ipsLayout_sidebarright" data-controller="core.front.widgets.sidebar" id="ipsLayout_sidebar">
<div class="cWidgetContainer" data-orientation="vertical" data-role="widgetReceiver" data-widgetarea="sidebar">
<ul class="ipsList_reset">
<li class="ipsWidget ipsWidget_vertical ipsBox" data-blockconfig="true" data-blockerrormessage="This block cannot be shown. This could be because it needs configuring, is unable to show on this page, or will show after reloading this page." data-blockid="app_cms_Wysiwyg_hbjjvq53w" data-blocktitle="WYSIWYG Editor" data-controller="core.front.widgets.block">
<div class="ipsWidget_inner ipsPad ipsType_richText" data-controller="core.front.core.lightboxedImages">
<p>
<a href="https://discord.gg/0k4ynDDCsnMzkxk7" rel="external nofollow" style="color:inherit;"><img alt="Discord" src="http://i.imgur.com/hFgq3Rt.png" style="width:300px;height:auto;"/></a>
</p>
</div>
</li>
</ul>
</div>
</div>
<nav class="ipsBreadcrumb ipsBreadcrumb_bottom ipsFaded_withHover">
<ul class="ipsList_inline ipsPos_right">
<li>
<a class="ipsType_light" data-action="defaultStream" href="https://epochmod.com/forum/discover/"><i aria-hidden="true" class="fa fa-newspaper-o"></i> <span>All Activity</span></a>
</li>
</ul>
<ul data-role="breadcrumbList">
<li>
<a href="../../index.html" title="Home">
<span>Home <i class="fa fa-angle-right"></i></span>
</a>
</li>
<li>
<a href="../../forum/1-arma-2/index.html">
<span>ArmA 2 <i aria-hidden="true" class="fa fa-angle-right"></i></span>
</a>
</li>
<li>
<a href="../../forum/63-a2-community-projects/index.html">
<span>A2: Community Projects <i aria-hidden="true" class="fa fa-angle-right"></i></span>
</a>
</li>
<li>
<a href="../../forum/50-epoch-linux-server/index.html">
<span>Epoch Linux Server <i aria-hidden="true" class="fa fa-angle-right"></i></span>
</a>
</li>
<li>
				
					Inventory Rollbacks
				
			</li>
</ul>
</nav>
</div>
</div>
</main>
<footer class="ipsClearfix" id="ipsLayout_footer">
<div class="ipsLayout_container">
<ul class="ipsList_inline ipsType_center ipsSpacer_top" id="elFooterSocialLinks">
<li class="cUserNav_icon">
<a class="cShareLink cShareLink_facebook" href="https://facebook.com/EpochMod" rel="noopener noreferrer" target="_blank"><i class="fa fa-facebook"></i></a>
</li>
<li class="cUserNav_icon">
<a class="cShareLink cShareLink_twitter" href="https://twitter.com/EpochMod" rel="noopener noreferrer" target="_blank"><i class="fa fa-twitter"></i></a>
</li>
<li class="cUserNav_icon">
<a class="cShareLink cShareLink_github" href="https://github.com/EpochModTeam/" rel="noopener noreferrer" target="_blank"><i class="fa fa-github"></i></a>
</li>
</ul>
<ul class="ipsList_inline ipsType_center ipsSpacer_top" id="elFooterLinks">
<li><a data-ipsdialog="" data-ipsdialog-flashmessage="Thanks, your message has been sent to the administrators." data-ipsdialog-remotesubmit="" data-ipsdialog-title="Contact Us" href="https://epochmod.com/forum/contact/" rel="nofollow">Contact Us</a></li>
</ul>
<p id="elCopyright">
<span id="elCopyright_userLine">Copyright © 2019 Epoch Mod Team</span>
<a href="https://www.invisioncommunity.com/" rel="nofollow" title="Invision Community">Powered by Invision Community</a>
</p>
</div>
</footer>
<div class="ipsDrawer ipsHide" id="elMobileDrawer">
<div class="ipsDrawer_menu">
<a class="ipsDrawer_close" data-action="close" href="#"><span>×</span></a>
<div class="ipsDrawer_content ipsFlex ipsFlex-fd:column">
<div class="ipsPadding ipsBorder_bottom">
<ul class="ipsToolList ipsToolList_vertical">
<li>
<a class="ipsButton ipsButton_light ipsButton_small ipsButton_fullWidth" href="https://epochmod.com/forum/login/" id="elSigninButton_mobile">Existing user? Sign In</a>
</li>
</ul>
</div>
<ul class="ipsDrawer_list ipsFlex-flex:11">
<li><a href="http://epochmod.com/">Home</a></li>
<li><a href="https://epochmod.com/forum/projects/">Downloads</a></li>
<li><a href="../../index.html">Forums</a></li>
<li><a href="http://epochmod.gamepedia.com/" rel="noopener" target="_blank">Wiki</a></li>
<li class="ipsDrawer_itemParent">
<h4 class="ipsDrawer_title"><a href="#">Browse</a></h4>
<ul class="ipsDrawer_list">
<li data-action="back"><a href="#">Back</a></li>
<li>
<a href="https://epochmod.com/forum/staff/">
					Staff
				</a>
</li>
<li>
<a href="https://epochmod.com/forum/online/">
					Online Users
				</a>
</li>
</ul>
</li>
<li class="ipsDrawer_itemParent">
<h4 class="ipsDrawer_title"><a href="#">Activity</a></h4>
<ul class="ipsDrawer_list">
<li data-action="back"><a href="#">Back</a></li>
<li>
<a href="https://epochmod.com/forum/discover/">
					All Activity
				</a>
</li>
<li>
<a href="#">
					My Activity Streams
				</a>
</li>
<li>
<a href="https://epochmod.com/forum/discover/unread/">
					Unread Content
				</a>
</li>
<li>
<a href="https://epochmod.com/forum/discover/content-started/">
					Content I Started
				</a>
</li>
<li>
<a href="https://epochmod.com/forum/search/">
					Search
				</a>
</li>
</ul>
</li>
<li><a href="https://epochmod.com/forum/leaderboard/">Leaderboard</a></li>
</ul>
</div>
</div>
</div>
<div class="ipsDrawer ipsHide" id="elMobileCreateMenuDrawer">
<div class="ipsDrawer_menu">
<a class="ipsDrawer_close" data-action="close" href="#"><span>×</span></a>
<div class="ipsDrawer_content ipsSpacer_bottom ipsPad">
<ul class="ipsDrawer_list">
<li class="ipsDrawer_listTitle ipsType_reset">Create New...</li>
</ul>
</div>
</div>
</div>
<script data-cfasync="false" src="https://epochmod.com/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="text/javascript">
		var ipsDebug = false;		
	
		var CKEDITOR_BASEPATH = 'http://epochmod.com/forum/applications/core/interface/ckeditor/ckeditor/';
	
		var ipsSettings = {
			
			
			cookie_path: "/forum/",
			
			cookie_prefix: "ips4_",
			
			
			cookie_ssl: true,
			
			upload_imgURL: "",
			message_imgURL: "",
			notification_imgURL: "",
			baseURL: "//epochmod.com/forum/",
			jsURL: "//epochmod.com/forum/applications/core/interface/js/js.php",
			csrfKey: "bbd96aef55be1a90d685e56a4524d73a",
			antiCache: "7f6edac1d51681449780",
			jsAntiCache: "7f6edac1d51727923486",
			disableNotificationSounds: true,
			useCompiledFiles: true,
			links_external: true,
			memberID: 0,
			lazyLoadEnabled: true,
			blankImg: "//epochmod.com/forum/applications/core/interface/js/spacer.png",
			googleAnalyticsEnabled: true,
			matomoEnabled: false,
			viewProfiles: true,
			mapProvider: 'none',
			mapApiKey: '',
			pushPublicKey: "BLY90A45HZZHrwnCKz6BVlOhu0SsCnzllubxC73QTZM5sfEOds9DfPrBRijrqkg_Tm4PSeJkPCuKkWiWNi4sOC4",
			relativeDates: true
		};
		
		
		
		
			ipsSettings['maxImageDimensions'] = {
				width: 1000,
				height: 750
			};
		
		
	</script>
<script data-ips="" src="https://epochmod.com/forum/uploads/javascript_global/root_library.js?v=7f6edac1d51727923486" type="text/javascript"></script>
<script data-ips="" src="https://epochmod.com/forum/uploads/javascript_global/root_js_lang_1.js?v=7f6edac1d51727923486" type="text/javascript"></script>
<script data-ips="" src="https://epochmod.com/forum/uploads/javascript_global/root_framework.js?v=7f6edac1d51727923486" type="text/javascript"></script>
<script data-ips="" src="https://epochmod.com/forum/uploads/javascript_core/global_global_core.js?v=7f6edac1d51727923486" type="text/javascript"></script>
<script data-ips="" src="https://epochmod.com/forum/uploads/javascript_global/root_front.js?v=7f6edac1d51727923486" type="text/javascript"></script>
<script data-ips="" src="https://epochmod.com/forum/uploads/javascript_core/front_front_core.js?v=7f6edac1d51727923486" type="text/javascript"></script>
<script data-ips="" src="https://epochmod.com/forum/uploads/javascript_forums/front_front_topic.js?v=7f6edac1d51727923486" type="text/javascript"></script>
<script data-ips="" src="https://epochmod.com/forum/uploads/javascript_global/root_map.js?v=7f6edac1d51727923486" type="text/javascript"></script>
<script type="text/javascript">
		
			ips.setSetting( 'date_format', jQuery.parseJSON('"mm\/dd\/yy"') );
		
			ips.setSetting( 'date_first_day', jQuery.parseJSON('0') );
		
			ips.setSetting( 'ipb_url_filter_option', jQuery.parseJSON('"none"') );
		
			ips.setSetting( 'url_filter_any_action', jQuery.parseJSON('"allow"') );
		
			ips.setSetting( 'bypass_profanity', jQuery.parseJSON('0') );
		
			ips.setSetting( 'emoji_style', jQuery.parseJSON('"native"') );
		
			ips.setSetting( 'emoji_shortcodes', jQuery.parseJSON('true') );
		
			ips.setSetting( 'emoji_ascii', jQuery.parseJSON('true') );
		
			ips.setSetting( 'emoji_cache', jQuery.parseJSON('1681342651') );
		
			ips.setSetting( 'image_jpg_quality', jQuery.parseJSON('75') );
		
			ips.setSetting( 'cloud2', jQuery.parseJSON('false') );
		
			ips.setSetting( 'isAnonymous', jQuery.parseJSON('false') );
		
		
	</script>
<script type="application/ld+json">
{
    "name": "Inventory Rollbacks",
    "headline": "Inventory Rollbacks",
    "text": "Hello Guys need some help \nsome Player notall have the Rollback Problem if they relog \n\n#!/usr/bin/perl\n#\n# Copyright 2013 by Denis Erygin,\n# denis.erygin@gmail.com\n#\n\nuse warnings;\nuse strict;\n\nuse constant PORT      =\u0026gt; 2302; # Change it with epoch.sh\nuse constant PATH      =\u0026gt; $ENV{\u0027PWD\u0027}.\u0027/\u0027; # Set your epoch server dir\nuse constant PIDFILE   =\u0026gt; PATH.PORT.\u0027.pid\u0027;\nuse constant CACHE_DIR =\u0026gt; PATH.\u0027cache/players\u0027;\n\nunless (-f PATH.\u0027epoch\u0027) {\n    print STDERR \"Can\u0027t found server binary!\\n\";\n    exit;\n}\n\nset_time  ();\nlogrotate ();\n\nif (-f PIDFILE) {\n    open  (IN, \u0027\u0026lt;\u0027.PIDFILE) or die \"Can\u0027t open: $!\";\n    my $pid = int(\u0026lt;IN\u0026gt;);\n    close (IN);\n\n    `sync`;\n    my $res = `kill -SIGINT $pid 2\u0026gt;\u0026amp;1`;\n    print STDERR $res,\"\\n\" if $res;\n   \n    unlink (PIDFILE) if (-f PIDFILE);    \n    backup_cache();\n}\n\nprint STDERR \"Restart Dayz Epoch server...\\n\";\nchdir (PATH);\n\nmy $cmd = \u0027/usr/bin/screen -h 20000 -fa -d -m -S epoch \u0027.PATH.\u0027epoch.sh\u0027;\nmy $res = `$cmd`;\nprint STDERR $res,\"\\n\" if $res;\nexit;\n\n#-----------------------------------------------------------------------------------------------\nsub set_time {\n    my ($s, $m, $h, $day, $mon, $y) = localtime(time() - 0*3600);\n    $y += 1900;\n    $mon++;\n    \n    # Uncomment to disabe night\n    ($h, $m) = (17, 0) if ($h \u0026gt; 17 || ($h \u0026gt;= 0 \u0026amp;\u0026amp; $h \u0026lt; 4));\n    \n    my $file = PATH.\u0027cache/set_time.sqf\u0027;\n    open  (IN, \"\u0026gt;$file\") or die \"Can\u0027t find $file\";\n    # [\"PASS\", [year, month, day, hour, minute]]\n    print IN \u0027[\"PASS\",[2012,6,6,\u0027.$h.\u0027,\u0027.$m.\u0027]]\u0027; # with full moon\n    close (IN);\n}\n\nsub logrotate {\n    my $log = PATH.\u0027dump.log\u0027;\n    if (-f $log) {\n        my ($dev,$ino,$mode,$nlink,$uid,$gid,$rdev,$size) = stat($log);\n    \n        if ($size \u0026amp;\u0026amp; $size \u0026gt;= 100000000) {\n            print STDERR \"logrotate $size\\n\";\n        \n            my $nlog = $log.\u0027.\u0027.time();\n            my $res  = `cp $log $nlog 2\u0026gt;\u0026amp;1`;\n            print STDERR $res,\"\\n\" if $res;\n        \n            $res = `echo \u0027\u0027 \u0026gt; $log 2\u0026gt;\u0026amp;1`;\n            print STDERR $res,\"\\n\" if $res;\n        }\n    }\n}\n\nsub backup_cache {\n    return unless (-d CACHE_DIR);\n    opendir (DIR, CACHE_DIR) or die $!;\n\n    while (my $file = readdir (DIR)) {\n        next unless ($file =~ m/^\\d+$/ \u0026amp;\u0026amp; $file ne \u00271\u0027);\n        my $dir    = CACHE_DIR.\u0027/\u0027.$file;\n        my $backup = CACHE_DIR.\u0027/1\u0027;\n        next unless (-d $dir);\n        \n        my $res = `mv -f $dir $backup 2\u0026gt;\u0026amp;1`;\n        print STDERR $res,\"\\n\" if $res;\n    }\n\n    closedir (DIR);\n}\n\n\n\n\n#!/usr/bin/perl\n#\n# Copyright 2014 by Denis Erygin,\n# denis.erygin@gmail.com\n#\n\nuse JSON::XS;\nuse DBI;\nuse warnings;\nuse strict;\n\nuse constant {\n    INSTANCE  =\u0026gt; 13,          # Chernarus instance\n    DB_NAME   =\u0026gt; \u0027*******\u0027,     # Set database name\n    DB_LOGIN  =\u0026gt; \u0027*****\u0027,      # Set database login\n    DB_PASSWD =\u0026gt; \u0027*****\u0027,      # Set database password\n    DB_HOST   =\u0026gt; \u0027localhost\u0027, # Set database host\n    DB_PORT   =\u0026gt; 3306,        # Set database port (default 3306)\n\n   CACHE_DIR =\u0026gt; $ENV{\u0027PWD\u0027}.\u0027/cache/\u0027,\n    # Start inventory of player\n    INVENTORY =\u0026gt; \u0027[[],[]]\u0027,\n    BACKPACK  =\u0026gt; \u0027[\"\",[],[]]\u0027,\n    MODEL     =\u0026gt; \u0027\"Survivor2_DZ\"\u0027\n};\n\nmy %cid_inv = ();\nmy %obj_inv = ();\n\nmy $myPlayerCounter = 1;\n\nmy %FN_IPC  = (\n    11  =\u0026gt; \\\u0026amp;h_player_counter,\n    21  =\u0026gt; \\\u0026amp;h_player_split_inventory,\n    22  =\u0026gt; \\\u0026amp;h_player_split_backpack,\n    31  =\u0026gt; \\\u0026amp;h_object_change_lock_code,\n    33  =\u0026gt; \\\u0026amp;h_object_split_inventory,\n    39  =\u0026gt; \\\u0026amp;h_object_uid_split_inventory,\n    101 =\u0026gt; \\\u0026amp;h_load_player,\n\t102 =\u0026gt; \\\u0026amp;h_load_character,\n    103 =\u0026gt; \\\u0026amp;h_log_login,\n    201 =\u0026gt; \\\u0026amp;h_player_update,\n    202 =\u0026gt; \\\u0026amp;h_player_death,\n    204 =\u0026gt; \\\u0026amp;h_player_disconnect,\n\t298 =\u0026gt; \\\u0026amp;h_load_bank,\n\t299 =\u0026gt; \\\u0026amp;h_bank_update,\n    303 =\u0026gt; \\\u0026amp;h_object_update_inventory,\n    304 =\u0026gt; \\\u0026amp;h_object_delete,\n    305 =\u0026gt; \\\u0026amp;h_vehicle_moved,\n    306 =\u0026gt; \\\u0026amp;h_vehicle_damaged,\n    308 =\u0026gt; \\\u0026amp;h_object_publish,\n    309 =\u0026gt; \\\u0026amp;h_object_uid_update_inventory,\n    310 =\u0026gt; \\\u0026amp;h_object_uid_delete,\n    396 =\u0026gt; \\\u0026amp;h_object_reset_damage,\n    397 =\u0026gt; \\\u0026amp;h_object_uid_reset_damage,\n    398 =\u0026gt; \\\u0026amp;h_trade_object,\n);\n\nmy $dbh   = connect_to_db();\nmy $coder = JSON::XS-\u0026gt;new-\u0026gt;ascii(1)-\u0026gt;shrink(1)-\u0026gt;allow_nonref(1)-\u0026gt;max_depth(5)-\u0026gt;max_size(1048576);\n\nmkdir (CACHE_DIR) unless (-d CACHE_DIR);\n\ninit_traders           ();\ninit_objects_id        ();\ninit_objects           ();\ninit_default_player    ();\ninit_default_character ();\ninit_default_bank      ();\nupdate_players_cache   ();\n\nopen (LOG, \"\u0026gt;\u0026gt;dump.log\") or die $!;\nwhile (\u0026lt;STDIN\u0026gt;) {\n    next if ($_ =~ m/Duplicate magazine/ || $_ =~ m/arrived from nonowner/);\n    print STDERR $_;\n    print LOG $_;\n\n    if ($_ =~ m/CHILD:/) {\n        chop;\n        my ($pref, $data) = split /CHILD:/ =\u0026gt; $_;\n        my @arr = split /:/ =\u0026gt; $data;\n        my $cmd = $arr[0];\n        next unless $cmd;\n        \n        my $fn = $FN_IPC{$cmd};\n        $fn-\u0026gt;(\\@arr) if $fn;\n    } else {\n        init_login_uid ($_);\n    }\n}\nclose(LOG);\n\n$dbh-\u0026gt;disconnect;\nexit;\n\n#---------------------------------------------------------------------------\nsub connect_to_db {\n    my $dbh = DBI-\u0026gt;connect(\u0027dbi:mysql:\u0027.DB_NAME.\u0027:\u0027.DB_HOST.\u0027:\u0027.DB_PORT, DB_LOGIN, DB_PASSWD,\n              {\u0027PrintError\u0027 =\u0026gt; 1, \u0027RaiseError\u0027 =\u0026gt; 1, \u0027AutoCommit\u0027 =\u0026gt; 1})\n              or die \"Can\u0027t connect to mysql: $!\";\n    $dbh-\u0026gt;{\u0027mysql_auto_reconnect\u0027} = 1;\n    return $dbh;\n}\n\nsub parse_json {\n    my $str = shift;\n    return unless $str;\n    \n    my $data;\n    eval { $data = $coder-\u0026gt;decode ($str); };\n    return if $@;\n    return $data;\n}\n\nsub init_traders {\n    h_load_trader_details();\n}\n\nsub init_objects_id {\n    h_load_objects_id();\n}\n\nsub init_objects {\n    h_stream_objects();\n}\n\nsub init_default_player {\n    my $file = CACHE_DIR.\u0027default.sqf\u0027;\n    open  (OUT, \"\u0026gt;$file\") or die \"Can\u0027t open \u0027$file\u0027\";\n    print OUT \u0027[\"PASS\",false,\"1\",[],\u0027.INVENTORY.\u0027,\u0027.BACKPACK.\u0027,[0,0,0],\u0027.MODEL.\u0027,0.96,0]\u0027;\n    close (OUT);\n}\n\nsub init_default_character {\n    my $file = CACHE_DIR.\u0027default-char.sqf\u0027;\n    open  (OUT, \"\u0026gt;$file\") or die \"Can\u0027t open \u0027$file\u0027\";\n    print OUT \u0027[\"PASS\",[],[0,0,0,0],[],[],2500,\"1\",0]\u0027;\n    close (OUT);\n}\n\nsub init_default_bank {\n    my $file = CACHE_DIR.\u0027default-bank.sqf\u0027;\n    open  (OUT, \"\u0026gt;$file\") or die \"Can\u0027t open \u0027$file\u0027\";\n    print OUT \u0027[\"PASS\",0]\u0027;\n    close (OUT);\n}\n\nsub update_players_cache {\n    my $sql = \u0027SELECT PlayerUID FROM Player_DATA\u0027;\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ();\n    return unless $res;\n    \n    my $PLAYERS_DIR = CACHE_DIR.\u0027players/\u0027.$myPlayerCounter;\n    mkdir ($PLAYERS_DIR) unless (-d $PLAYERS_DIR);\n    \n    my @uids = ();\n    while (my ($playerId) = $sth-\u0026gt;fetchrow_array) {\n        next unless $playerId;\n        my $file = $PLAYERS_DIR.\u0027/\u0027.lc($playerId).\u0027.sqf\u0027;\n        next if (-f $file);\n    \n        push @uids, $playerId;\n    }\n    $sth-\u0026gt;finish;\n    return unless @uids;\n    \n    for my $playerId (@uids) {\n        update_player_cache ($playerId);\n\t\tupdate_bank_cache ($playerId);\n    }\n}\n\nsub get_playerId_by_characterId {\n    my $characterId = shift;\n    return unless $characterId;\n    \n    my $sql = \u0027SELECT PlayerUID FROM Character_DATA WHERE CharacterID=?\u0027;\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ($characterId);\n    return unless $res;\n    \n    my ($playerId) = $sth-\u0026gt;fetchrow_array;\n    $sth-\u0026gt;finish;\n    \n    return $playerId;\n}\n\nsub update_player_cache {\n    my $playerId = shift;\n    return unless $playerId;\n\n    my $sql = \"SELECT CharacterID, Worldspace, Inventory, Backpack,\n               TIMESTAMPDIFF(MINUTE, Datestamp, LastLogin) as SurvivalTime,\n               TIMESTAMPDIFF(MINUTE, LastAte, NOW()) as MinsLastAte,\n               TIMESTAMPDIFF(MINUTE, LastDrank, NOW()) as MinsLastDrank,\n               Model, Humanity, KillsZ, HeadshotsZ, KillsH, KillsB, CurrentState, Medical, CashMoney \n               FROM Character_DATA\n               WHERE PlayerUID=? AND Alive = 1 AND InstanceID=? ORDER BY CharacterID DESC LIMIT 1\";\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ($playerId, INSTANCE);\n    #return unless $res;\n    \n    my ($characterId, $worldSpace, $inventory, $backpack, $survivalTime, $minsLastAte, $minsLastDrank, $model,\n        $humanity, $killsZ, $headshotsZ, $killsH, $killsB, $currentState, $medical, $cashMoney) = $sth-\u0026gt;fetchrow_array;\n    $sth-\u0026gt;finish;\n    return unless (defined $characterId);\n    \n    my $survival = \u0027[0,0,0]\u0027;\n    $survival    = \u0027[\u0027.$survivalTime.\u0027,\u0027.$minsLastAte.\u0027,\u0027.$minsLastDrank.\u0027]\u0027 if (defined $survivalTime \u0026amp;\u0026amp;\n                                                                                 defined $minsLastAte  \u0026amp;\u0026amp;\n                                                                                 defined $minsLastDrank);\n    my $PLAYERS_DIR = CACHE_DIR.\u0027players/\u0027.$myPlayerCounter;\n    mkdir ($PLAYERS_DIR) unless (-d $PLAYERS_DIR);\n                                                                                 \n    my $file = $PLAYERS_DIR.\u0027/\u0027.lc($playerId).\u0027.sqf\u0027;\n    open  (OUT, \"\u0026gt;$file\") or print STDERR $!;\n    print OUT \u0027[\"PASS\",false,\"\u0027.$characterId.\u0027\",\u0027.$worldSpace.\u0027,\u0027.$inventory.\u0027,\u0027.$backpack.\u0027,\u0027.$survival.\u0027,\u0027.$model.\u0027,0.96]\u0027;\n    close (OUT);\n        \n    my $stats = \u0027[0,0,0,0]\u0027;\n    $stats    = \u0027[\u0027.$killsZ.\u0027,\u0027.$headshotsZ.\u0027,\u0027.$killsH.\u0027,\u0027.$killsB.\u0027]\u0027 if (defined $killsZ \u0026amp;\u0026amp; defined $headshotsZ \u0026amp;\u0026amp; defined $killsH \u0026amp;\u0026amp; defined $killsB);\n    \n    $file = $PLAYERS_DIR.\u0027/\u0027.lc($playerId).\u0027-char.sqf\u0027;\n    open  (OUT, \"\u0026gt;$file\") or print STDERR $!;\n    print OUT \u0027[\"PASS\",\u0027.$medical.\u0027,\u0027.$stats.\u0027,\u0027.$currentState.\u0027,\u0027.$worldSpace.\u0027,\u0027.$humanity.\u0027,\"\u0027.$characterId.\u0027\",\u0027.$cashMoney.\u0027]\u0027;\n    close (OUT);\n\t\n    return $characterId;\n}\n\nsub update_bank_cache {\n    my $playerId = shift;\n    return unless $playerId;\n\n\tmy $sql = \"SELECT BankSaldo\n\t\t\t   FROM Banking_DATA\n\t\t       WHERE PlayerUID=?\";\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ($playerId);\n    \n    my ($bankSaldo) = $sth-\u0026gt;fetchrow_array;\n    $sth-\u0026gt;finish;\n\treturn unless (defined $bankSaldo);\n\n\tmy $PLAYERS_DIR = CACHE_DIR.\u0027players/\u0027.$myPlayerCounter;\n    mkdir ($PLAYERS_DIR) unless (-d $PLAYERS_DIR);\n\t\n    my $file = $PLAYERS_DIR.\u0027/\u0027.lc($playerId).\u0027-bank.sqf\u0027;\n    open  (OUT, \"\u0026gt;$file\") or print STDERR $!;\n    print OUT \u0027[\"PASS\",\u0027.$bankSaldo.\u0027]\u0027;\n    close (OUT);\n\t\n\treturn $bankSaldo;\n}\n\nsub init_login_uid {\n    my $dump = shift;\n    return unless $dump;\n        \n    return unless ($dump =~ m/\\sconnected/);\n    return if ($dump =~ m/BattlEye Server: Player/);\n    \n    my ($p, $str)   = split (/Player\\s/, $dump);\n    return unless (defined $str);\n    \n    my ($name, $uid) = split (/\\sconnected\\s/, $str);\n    return unless ($name \u0026amp;\u0026amp; $uid);\n    \n    #if ($uid =~ m/(\\d+)/) {\n    if ($uid =~ m/=(\\w+)/) {\n        $uid = $1;\n    } \n    return unless $uid;\n    print STDERR \"$uid =\u0026gt; $name\\n\";\n    \n    #my $PLAYERS_DIR = CACHE_DIR.\u0027players/\u0027.$myPlayerCounter;\n    #my $file        = $PLAYERS_DIR.\u0027/\u0027.$uid.\u0027.sqf\u0027;\n    #return if (-e $file);\n\n    h_load_player ([101, $uid, INSTANCE, $name]);\n\tprint STDERR \"EXECUTED h_load_player($uid): with name: $name\\n\";\n\th_load_bank ([298, $uid, INSTANCE, $name]);\n    print STDERR \"EXECUTED h_load_bank($uid): with name: $name\\n\";\n}\n\n# 11\nsub h_player_counter {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $counter) = @$p;\n    return unless ($counter \u0026amp;\u0026amp; int($counter) \u0026gt; 0);\n    $counter = int($counter);\n    \n    my $old = CACHE_DIR.\u0027players/\u0027.$myPlayerCounter;\n    my $new = CACHE_DIR.\u0027players/\u0027.$counter;\n    if (-d $old) {\n        rename ($old, $new);\n    } else {\n        print STDERR \"Error h_player_counter($counter): old \u0027$myPlayerCounter\u0027 not found!\\n\";\n        mkdir ($new) or print STDERR $!,\"\\n\";\n    }\n    \n    $myPlayerCounter = $counter;\n}\n\n# 21\nsub h_player_split_inventory {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $cid, $idx, $data) = @$p;\n    unless ($cid \u0026amp;\u0026amp; defined $idx \u0026amp;\u0026amp; defined $data) {\n        print STDERR \"Error h_player_split_inventory(): characterId or idx or data undefined!\\n\";\n        return;\n    }\n\n    unless ( parse_json ($data) ) {\n        print STDERR \"Error h_player_split_inventory(): data invalid json!\\n\";\n        $cid_inv{$cid} = undef;\n        return;\n    }\n\n    # Save weapons\n    if ($idx == 0) {\n        $cid_inv{$cid} = $data;\n        return;\n    }\n    # Save weapons + magazines\n    if ($idx == 1 \u0026amp;\u0026amp; $cid_inv{$cid}) {\n        my $inv        = \u0027[\u0027.$cid_inv{$cid}.\u0027,\u0027.$data.\u0027]\u0027;\n        $cid_inv{$cid} = undef;\n        print STDERR \"Size plr inv: \".length($inv).\"\\n\";\n\n        unless ( parse_json($inv) ) {\n            print STDERR \"Error h_player_split_inventory(): inventory invalid json!\\n\";\n            return;\n        }\n\n        my $sth = $dbh-\u0026gt;prepare (\u0027UPDATE Character_DATA SET Inventory=? WHERE CharacterID=?\u0027);\n        my $res = $sth-\u0026gt;execute ($cid, $inv);\n        return $res;\n    }\n}\n\n# 22\nsub h_player_split_backpack {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $cid, $data) = @$p;\n    unless ($cid \u0026amp;\u0026amp; defined $data) {\n        print STDERR \"Error h_player_split_backpack(): characterId or data undefined!\\n\";\n        return;\n    }\n\n    unless ( parse_json ($data) ) {\n        print STDERR \"Error h_player_split_backpack(): backpack invalid json!\\n\";\n        return;\n    }\n    return if ($data eq \u0027[]\u0027);\n\n    my $sth = $dbh-\u0026gt;prepare (\u0027UPDATE Character_DATA SET Backpack=? WHERE CharacterID=?\u0027);\n    my $res = $sth-\u0026gt;execute ($cid, $data);\n    return $res;\n}\n\n# 31\nsub h_object_change_lock_code {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $oid, $code) = @$p;\n    unless ($oid \u0026amp;\u0026amp; $code) {\n        print STDERR \"Error h_object_change_lock_code(): objectId or code undefined!\\n\";\n        return;\n    }\n    $oid =~ s/\"//g;\n    \n    my $sth = $dbh-\u0026gt;prepare (\u0027UPDATE Object_DATA SET CharacterID=? WHERE ObjectID=? AND Instance=?\u0027);\n    my $res = $sth-\u0026gt;execute ($code, $oid, INSTANCE);\n    return $res;\n}\n\n# 33\nsub h_object_split_inventory {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $oid, $idx, $data) = @$p;\n    unless ($oid \u0026amp;\u0026amp; defined $idx \u0026amp;\u0026amp; defined $data) {\n        print STDERR \"Error h_object_split_inventory(): objectId or idx or data undefined!\\n\";\n        return;\n    }\n    $oid =~ s/\"//g;\n\n    unless ( parse_json ($data) ) {\n        print STDERR \"Error h_object_split_inventory($oid): data invalid json!\\n\";\n        $obj_inv{$oid} = undef;\n        return;\n    }\n\n    # Save weapons\n    if ($idx == 0) {\n        $obj_inv{$oid} = $data;\n        return;\n    }\n    # Save weapons + magazines\n    if ($idx == 1 \u0026amp;\u0026amp; $obj_inv{$oid}) {\n        $obj_inv{$oid} .= \u0027,\u0027.$data;\n        return;\n    }\n    # Save weapons + magazines + backpack\n    if ($idx == 2 \u0026amp;\u0026amp; $obj_inv{$oid}) {\n        my $inv        = \u0027[\u0027.$obj_inv{$oid}.\u0027,\u0027.$data.\u0027]\u0027;\n        $obj_inv{$oid} = undef;\n        print STDERR \"Size obj inv: \".length($inv).\"\\n\";\n\n        unless ( parse_json($inv) ) {\n            print STDERR \"Error h_object_split_inventory($oid): inventory invalid json!\\n\";\n            return;\n        }\n\n        my $sth = $dbh-\u0026gt;prepare (\u0027UPDATE Object_DATA SET Inventory=? WHERE ObjectID=? AND Instance=?\u0027);\n        my $res = $sth-\u0026gt;execute ($inv, $oid, INSTANCE);\n        return $res;\n    }\n}\n\n# 39\nsub h_object_uid_split_inventory {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $uid, $idx, $data) = @$p;\n    unless ($uid \u0026amp;\u0026amp; defined $idx \u0026amp;\u0026amp; defined $data) {\n        print STDERR \"Error h_object_uid_split_inventory(): objectUID or idx or data undefined!\\n\";\n        return;\n    }\n    $uid =~ s/\"//g;\n\n    unless ( parse_json ($data) ) {\n        print STDERR \"Error h_object_uid_split_inventory($uid): data invalid json!\\n\";\n        $obj_inv{$uid} = undef;\n        return;\n    }\n\n    # Save weapons\n    if ($idx == 0) {\n        $obj_inv{$uid} = $data;\n        return;\n    }\n    # Save weapons + magazines\n    if ($idx == 1 \u0026amp;\u0026amp; $obj_inv{$uid}) {\n        $obj_inv{$uid} .= \u0027,\u0027.$data;\n        return;\n    }\n    # Save weapons + magazines + backpack\n    if ($idx == 2 \u0026amp;\u0026amp; $obj_inv{$uid}) {\n        my $inv        = \u0027[\u0027.$obj_inv{$uid}.\u0027,\u0027.$data.\u0027]\u0027;\n        $obj_inv{$uid} = undef;\n        print STDERR \"Size obj uid inv: \".length($inv).\"\\n\";\n\n        unless ( parse_json($inv) ) {\n            print STDERR \"Error h_object_uid_split_inventory($uid): inventory invalid json!\\n\";\n            return;\n        }\n\n        my $sth = $dbh-\u0026gt;prepare (\u0027UPDATE Object_DATA SET Inventory=? WHERE ObjectUID=? AND Instance=?\u0027);\n        my $res = $sth-\u0026gt;execute ($inv, $uid, INSTANCE);\n        return $res;\n    }\n}\n\n# 101\nsub h_load_player {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $playerId, $serverId, $playerName) = @$p;\n    unless ($playerId \u0026amp;\u0026amp; $serverId) {\n        print STDERR \"Error h_load_player(): playerId or serverId undefined!\\n\";\n        return;\n    }\n    $playerId =~ s/[\u0027\"]//g;\n    $serverId ||= INSTANCE;\n    \n    my $PLAYERS_DIR = CACHE_DIR.\u0027players/\u0027.$myPlayerCounter;\n    mkdir ($PLAYERS_DIR) unless (-d $PLAYERS_DIR);\n    \n    my $sql = \u0027SELECT PlayerName, PlayerSex FROM Player_DATA WHERE PlayerUID=?\u0027;\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ($playerId);\n    \n    my ($name, $sex) = $sth-\u0026gt;fetchrow_array;\n    $sth-\u0026gt;finish;\n    \n    my $newPlayer = 0;\n    if (defined $name) {\n        if ($playerName \u0026amp;\u0026amp; $playerName ne $name) {\n\t\t\n            $sql = \u0027UPDATE Player_DATA SET PlayerName=? WHERE PlayerUID=?\u0027;\n            $sth = $dbh-\u0026gt;prepare ($sql);\n            $res = $sth-\u0026gt;execute ($playerName, $playerId);\n\t\t\t\n            print STDERR \"Changed name of player $playerId from \u0027$name\u0027 to \u0027$playerName\u0027 in table Player_DATA\\n\";\n        }\n    } else {\n        $newPlayer  = 1;\n        $playerName = \u0027Unknown\u0027 unless $playerName;\n        \n        $sql = \u0027INSERT INTO Player_DATA(PlayerUID, PlayerName) VALUES (?, ?)\u0027;\n        $sth = $dbh-\u0026gt;prepare ($sql);\n        $res = $sth-\u0026gt;execute ($playerId, $playerName);\n\t\t\n        print STDERR \"Created a new player $playerId named \u0027$playerName\u0027 in table Player_DATA\\n\";\n    }\n    \n    $sql = \"SELECT CharacterID, Worldspace, Inventory, Backpack, \n            TIMESTAMPDIFF(MINUTE, Datestamp, LastLogin) as SurvivalTime,\n            TIMESTAMPDIFF(MINUTE, LastAte, NOW()) as MinsLastAte, \n            TIMESTAMPDIFF(MINUTE, LastDrank, NOW()) as MinsLastDrank,\n            Model, Medical, Humanity, KillsZ, HeadshotsZ, KillsH, KillsB, CurrentState, CashMoney  \n            FROM  Character_DATA \n            WHERE PlayerUID=? AND Alive = 1 AND InstanceID=? ORDER BY CharacterID DESC LIMIT 1\";\n    $sth = $dbh-\u0026gt;prepare ($sql);\n    $res = $sth-\u0026gt;execute ($playerId, $serverId);\n    \n    my ($characterId, $worldSpace, $inventory, $backpack, $survivalTime, $minsLastAte, $minsLastDrank, \n        $model, $medical, $humanity, $killsZ, $headshotsZ, $killsH, $killsB, $currentState, $cashMoney) = $sth-\u0026gt;fetchrow_array;\n    $sth-\u0026gt;finish;\n    \n    $currentState = \u0027[]\u0027      unless (defined $currentState);\n    $humanity     = 2500      unless (defined $humanity);\n\t$cashMoney    = 0         unless (defined $cashMoney);\n    $medical      = \u0027[]\u0027      unless (defined $medical);\n    $worldSpace   = \u0027[]\u0027      unless (defined $worldSpace);\n    $inventory    = INVENTORY unless (defined $inventory);  # \u0027[]\u0027\n    $backpack     = BACKPACK  unless (defined $backpack);   # \u0027[]\u0027\n    $model        = MODEL     unless (defined $model);      # \u0027\u0027\n    \n    my $survival = \u0027[0,0,0]\u0027;\n    $survival    = \u0027[\u0027.$survivalTime.\u0027,\u0027.$minsLastAte.\u0027,\u0027.$minsLastDrank.\u0027]\u0027 if (defined $survivalTime \u0026amp;\u0026amp; \n                                                                                 defined $minsLastAte  \u0026amp;\u0026amp; \n                                                                                 defined $minsLastDrank);\n    my $newChar = 0;\n    if (defined $characterId) {\n        $sql = \u0027UPDATE Character_DATA SET LastLogin = CURRENT_TIMESTAMP WHERE CharacterID=?\u0027;\n        $sth = $dbh-\u0026gt;prepare ($sql);\n        $res = $sth-\u0026gt;execute ($characterId);\n        \n        my $stats = \u0027[0,0,0,0]\u0027;\n        $stats    = \u0027[\u0027.$killsZ.\u0027,\u0027.$headshotsZ.\u0027,\u0027.$killsH.\u0027,\u0027.$killsB.\u0027]\u0027 if (defined $killsZ \u0026amp;\u0026amp; defined $headshotsZ \u0026amp;\u0026amp;\n                                                                                defined $killsH \u0026amp;\u0026amp; defined $killsB);        \n        my $file = $PLAYERS_DIR.\u0027/\u0027.lc($playerId).\u0027-char.sqf\u0027;\n        open  (OUT, \"\u0026gt;$file\");\n        print OUT \u0027[\"PASS\",\u0027.$medical.\u0027,\u0027.$stats.\u0027,\u0027.$currentState.\u0027,\u0027.$worldSpace.\u0027,\u0027.$humanity.\u0027,\"\u0027.$characterId.\u0027\",\u0027.$cashMoney.\u0027]\u0027;\n        close (OUT); \n    } else {\n        $newChar = 1;\n        \n        $sql = \"SELECT Generation, Humanity, Model FROM Character_DATA \n                WHERE PlayerUID=? AND Alive = 0 AND InstanceID=? ORDER BY CharacterID DESC LIMIT 1\";\n        $sth = $dbh-\u0026gt;prepare ($sql);\n        $res = $sth-\u0026gt;execute ($playerId, $serverId);\n        \n        my ($generation, $humanity, $cmodel) = $sth-\u0026gt;fetchrow_array;\n        $sth-\u0026gt;finish;\n        \n        if (defined $generation) {\n            $generation++;\n        } else {\n            $generation = 1;\n        }\n        \n        $humanity     = 2500      unless (defined $humanity);\n\t\t$cashMoney    = 0         unless (defined $cashMoney);\n        $model        = $cmodel   if (defined $cmodel); \n        \n        $sql = \"INSERT INTO Character_DATA(PlayerUID, InstanceID, Worldspace, Inventory, Backpack, Medical,\n                                           Generation, Datestamp, LastLogin, LastAte, LastDrank, Humanity, CashMoney) \n                VALUES (?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, ?, ?)\";\n        $sth = $dbh-\u0026gt;prepare ($sql);\n        $res = $sth-\u0026gt;execute ($playerId, $serverId, $worldSpace, $inventory, $backpack, $medical, $generation, $humanity, $cashMoney);\n        \n        $sql = \u0027SELECT CharacterID FROM Character_DATA WHERE PlayerUID=? AND Alive = 1 AND InstanceID=? ORDER BY CharacterID DESC LIMIT 1\u0027;\n        $sth = $dbh-\u0026gt;prepare ($sql);\n        $res = $sth-\u0026gt;execute ($playerId, $serverId);\n        \n        ($characterId) = $sth-\u0026gt;fetchrow_array;\n        $sth-\u0026gt;finish;\n        \n        $playerName = \u0027Unknown\u0027 unless $playerName;\n        \n        if (defined $characterId) {\n            print STDERR \"Created a new character $characterId for player \u0027$playerName\u0027 ($playerId)\\n\";\n            my $file = $PLAYERS_DIR.\u0027/\u0027.lc($playerId).\u0027-char.sqf\u0027;\n            open  (OUT, \"\u0026gt;$file\");\n            print OUT \u0027[\"PASS\",\u0027.$medical.\u0027,[0,0,0,0],[],\u0027.$worldSpace.\u0027,\u0027.$humanity.\u0027,\"\u0027.$characterId.\u0027\",\u0027.$cashMoney.\u0027]\u0027;\n            close (OUT);\n        } else {\n            print STDERR \"Can\u0027t found new character for player \u0027$playerName\u0027 ($playerId)\\n\";\n        }\n    }\n    \n    my $file = $PLAYERS_DIR.\u0027/\u0027.lc($playerId).\u0027.sqf\u0027;\n    open  (OUT, \"\u0026gt;$file\");\n    print OUT \u0027[\"PASS\",false,\"\u0027.$characterId.\u0027\",\u0027.$worldSpace.\u0027,\u0027.$inventory.\u0027,\u0027.$backpack.\u0027,\u0027.$survival.\u0027,\u0027.$model.\u0027,0.96,\u0027.$cashMoney.\u0027]\u0027;\n    close (OUT);\n    \n    print STDERR \"CHILD:101 Save player: $file\\n\";\n    return $res;\n}\n\n# 102\nsub h_load_character {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $characterId, $playerId) = @$p;\n    unless ($characterId) {\n        print STDERR \"Error h_load_character(): characterId undefined!\\n\";\n        return;\n    }\n    $characterId =~ s/\"//g;\n    $playerId    =~ s/[\u0027\"]//g;\n    \n    if ($characterId == 1 \u0026amp;\u0026amp; $playerId) {\n        my $sql = \u0027SELECT CharacterID FROM Character_DATA WHERE PlayerUID=? AND Alive = 1 AND InstanceID=? ORDER BY CharacterID DESC LIMIT 1\u0027;\n        my $sth = $dbh-\u0026gt;prepare ($sql);\n        my $res = $sth-\u0026gt;execute ($playerId, INSTANCE);\n        return unless $res;\n        \n        ($characterId) = $sth-\u0026gt;fetchrow_array;\n        $sth-\u0026gt;finish;\n    }\n    unless ($characterId) {\n        print STDERR \"Error h_load_character(): characterId undefined!\\n\";\n        return;\n    }\n    \n    my $sql = \"SELECT Worldspace, Medical, Generation, KillsZ, HeadshotsZ, KillsH, KillsB, CurrentState, Humanity, PlayerUID, CashMoney\n               FROM Character_DATA WHERE CharacterID=?\";\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ($characterId);\n    \n    my ($worldSpace, $medical, $generation, $killsZ, $headshotsZ, $killsH, $killsB, $currentState, $humanity, $playerUID, $cashMoney) = $sth-\u0026gt;fetchrow_array;\n    $sth-\u0026gt;finish;\n    return unless (defined $worldSpace);\n    \n    $playerId = $playerUID if (defined $playerUID);\n    \n    $worldSpace   ||= \u0027[]\u0027;\n    $medical      ||= \u0027[]\u0027;\n    $generation   ||= 1;\n    $currentState ||= \u0027[]\u0027;\n    $humanity       = 2500 unless (defined $humanity);\n\t$cashMoney      = 0\tunless (defined $cashMoney);\n    \n    my $stats = \u0027[0,0,0,0]\u0027;\n    $stats    = \u0027[\u0027.$killsZ.\u0027,\u0027.$headshotsZ.\u0027,\u0027.$killsH.\u0027,\u0027.$killsB.\u0027]\u0027 if (defined $killsZ \u0026amp;\u0026amp; defined $headshotsZ \u0026amp;\u0026amp; \n                                                                            defined $killsH \u0026amp;\u0026amp; defined $killsB);\n    \n    my $file = CACHE_DIR.\u0027players/\u0027.$myPlayerCounter.\u0027/\u0027.lc($playerId).\u0027-char.sqf\u0027;\n    open  (OUT, \"\u0026gt;$file\");\n    print OUT \u0027[\"PASS\",\u0027.$medical.\u0027,\u0027.$stats.\u0027,\u0027.$currentState.\u0027,\u0027.$worldSpace.\u0027,\u0027.$humanity.\u0027,\"\u0027.$characterId.\u0027\",\u0027.$cashMoney.\u0027]\u0027;\n    close (OUT);\n    \n    print STDERR \"CHILD:102 Save character: $file\\n\";\n    return $res;\n}\n\n# 103\nsub h_log_login {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $playerId, $characterId, $action) = @$p;\n    unless ($playerId) {\n        print STDERR \"Error h_log_login(): playerId undefined!\\n\";\n        return;\n    }\n    $playerId    =~ s/[\u0027\"]//g;\n    $characterId =~ s/\"//g;\n    \n    my $sql = \u0027INSERT INTO Player_LOGIN(PlayerUID, CharacterID, Datestamp, Action) VALUES (?, ?, CURRENT_TIMESTAMP, ?)\u0027;\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ($playerId, $characterId, $action);\n    return $res;\n}\n\n# 201\nsub h_player_update {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $characterId, $worldSpace, $inventory, $backpack, $medical, $justAte, $justDrank, \n        $killsZ, $headshotsZ, $distanceWalked, $durationLived, $currentState, $killsH, $killsB, $model,\n        $humanity, $cashMoney) = @$p;\n    unless ($characterId) {\n        print STDERR \"Error h_player_update(): characterId undefined!\\n\";\n        return;\n    }\n    $characterId =~ s/\"//g;\n    \n    if ($worldSpace) {\n        my $ws = parse_json ($worldSpace);\n        unless ($ws) {\n            print STDERR \"Error h_player_update(): worldSpace invalid json!\\n\";\n            return;\n        }\n        if (@$ws) {\n            if ($ws-\u0026gt;[1] \u0026amp;\u0026amp; ref($ws-\u0026gt;[1]) eq \u0027ARRAY\u0027) {\n                my ($x, $y) = @{$ws-\u0026gt;[1]};\n                if ($x \u0026amp;\u0026amp; $x \u0026lt; -18000) {\n                    print STDERR \"Error h_player_update(): worldSpace invalid!\\n\";\n                    return;\n                }\n            }\n        }\n    }\n    if ($inventory) {\n        unless ( parse_json ($inventory) ) {\n            print STDERR \"Error h_player_update(): inventory invalid json!\\n\";\n            $inventory = undef;\n        }\n    }\n    if ($backpack) {\n        unless ( parse_json ($backpack) ) {\n            print STDERR \"Error h_player_update(): backpack invalid json!\\n\";\n            $backpack = undef;\n        }\n    }\n    if ($medical) {\n        unless ( parse_json ($medical) ) {\n            print STDERR \"Error h_player_update(): medical invalid json!\\n\";\n            $medical = undef;\n        }\n    }\n    if ($currentState) {\n        unless ( parse_json ($currentState) ) {\n            print STDERR \"Error h_player_update(): currentState invalid json!\\n\";\n            $currentState = undef;\n        }\n    }\n    if ($model) {\n        $model = \u0027\"\u0027.$model.\u0027\"\u0027 if (length($model) \u0026gt; 3 \u0026amp;\u0026amp; $model !~ m/\"/);\n        unless ( parse_json ($model) ) {\n            print STDERR \"Error h_player_update(): model invalid json!\\n\";\n            $model = undef;\n        }\n    }\n    \n    my $str = \u0027\u0027;\n    $str .= \u0027Worldspace=\u0027.$dbh-\u0026gt;quote($worldSpace).\u0027,\u0027            if ($worldSpace \u0026amp;\u0026amp; $worldSpace ne \u0027[]\u0027);\n    $str .= \u0027Inventory=\u0027.$dbh-\u0026gt;quote($inventory).\u0027,\u0027              if ($inventory  \u0026amp;\u0026amp; $inventory  ne INVENTORY \u0026amp;\u0026amp; $inventory ne \u0027[]\u0027);\n    $str .= \u0027Backpack=\u0027.$dbh-\u0026gt;quote($backpack).\u0027,\u0027                if ($backpack   \u0026amp;\u0026amp; $backpack   ne BACKPACK \u0026amp;\u0026amp; $backpack ne \u0027[]\u0027);\n    $str .= \u0027Medical=\u0027.$dbh-\u0026gt;quote($medical).\u0027,\u0027                  if ($medical    \u0026amp;\u0026amp; $medical    ne \u0027[]\u0027);\n    $str .= \u0027CurrentState=\u0027.$dbh-\u0026gt;quote($currentState).\u0027,\u0027        if ($currentState \u0026amp;\u0026amp; $currentState ne \u0027[]\u0027);\n    $str .= \u0027Model=\u0027.$dbh-\u0026gt;quote($model).\u0027,\u0027                      if ($model \u0026amp;\u0026amp; $model ne MODEL);\n    \n    $str .= \u0027LastAte=CURRENT_TIMESTAMP,\u0027                          if ($justAte   \u0026amp;\u0026amp; $justAte   eq \u0027true\u0027);\n    $str .= \u0027LastDrank=CURRENT_TIMESTAMP,\u0027                        if ($justDrank \u0026amp;\u0026amp; $justDrank eq \u0027true\u0027);\n    \n    $str .= \u0027KillsZ=KillsZ+\u0027.int($killsZ).\u0027,\u0027                     if ($killsZ     \u0026amp;\u0026amp; $killsZ \u0026gt; 0);\n    $str .= \u0027HeadshotsZ=HeadshotsZ+\u0027.int($headshotsZ).\u0027,\u0027         if ($headshotsZ \u0026amp;\u0026amp; $headshotsZ \u0026gt; 0);\n    $str .= \u0027DistanceFoot=DistanceFoot+\u0027.int($distanceWalked).\u0027,\u0027 if ($distanceWalked \u0026amp;\u0026amp; $distanceWalked \u0026gt; 0);\n    $str .= \u0027KillsH=KillsH+\u0027.int($killsH).\u0027,\u0027                     if ($killsH     \u0026amp;\u0026amp; $killsH \u0026gt; 0);\n    $str .= \u0027KillsB=KillsB+\u0027.int($killsB).\u0027,\u0027                     if ($killsB     \u0026amp;\u0026amp; $killsB \u0026gt; 0);\n    \n    if ($humanity) {    \n        if ($humanity \u0026lt; 0) {\n            $str .= \u0027Humanity=Humanity-\u0027.int(-1*$humanity).\u0027,\u0027;\n        } else {\n            $str .= \u0027Humanity=Humanity+\u0027.int($humanity).\u0027,\u0027;\n        }\n    }\n\t\n\tif ($cashMoney) {    \n        if ($cashMoney \u0026lt; 0) {\n            $str .= \u0027CashMoney=CashMoney-\u0027.int(-1*$cashMoney).\u0027,\u0027;\n        } else {\n            $str .= \u0027CashMoney=CashMoney+\u0027.int($cashMoney).\u0027,\u0027;\n        }\n    }\n\t\n    return unless $str;\n    \n    $str .= \u0027Duration=Duration+\u0027.int($durationLived || 0);\n    \n    my $sql = \u0027UPDATE Character_DATA SET \u0027;\n    $sql   .= $str;\n    $sql   .= \u0027 WHERE CharacterID=?\u0027;\n    \n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ($characterId);\n    return $res;\n}\n\n# 202\nsub h_player_death {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $characterId, $duration) = @$p;\n    unless ($characterId) {\n        print STDERR \"Error h_player_death(): characterId undefined!\\n\";\n        return;\n    }\n    $characterId =~ s/\"//g;\n    \n    my $sql =  \"UPDATE Character_DATA SET Alive = 0, LastLogin = DATE_SUB(CURRENT_TIMESTAMP, INTERVAL ? MINUTE) \n                WHERE CharacterID=? AND Alive = 1\";\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute (int($duration), $characterId);\n    return unless $res;    \n    \n    # Reset profile\n    my $playerId = get_playerId_by_characterId ($characterId);\n    if ($playerId) {    \n        h_load_player ([101, $playerId, INSTANCE]);\n\t\th_load_bank ([298, $playerId, INSTANCE]);\n    } else {\n        print STDERR \"Error h_player_death(\u0027$characterId\u0027): playerId not found!\\n\";\n    }\n}\n\n# 204\nsub h_player_disconnect {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $playerId) = @$p;\n    $playerId =~ s/[A-Z\"]//g;\n    \n    update_player_cache ($playerId);\n\tupdate_bank_cache ($playerId);\n}\n\n# 298\nsub h_load_bank {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $playerId, $serverId, $playerName) = @$p;\n    unless ($playerId) {\n        print STDERR \"Error h_load_bank(): playerId undefined!\\n\";\n        return;\n    }\n    $playerId =~ s/[\u0027\"]//g;\n    $serverId ||= INSTANCE;\n    \n    my $PLAYERS_DIR = CACHE_DIR.\u0027players/\u0027.$myPlayerCounter;\n    mkdir ($PLAYERS_DIR) unless (-d $PLAYERS_DIR);\n    \n    my $sql = \u0027SELECT PlayerName FROM Banking_DATA WHERE PlayerUID=?\u0027;\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ($playerId);\n    \n    my ($name) = $sth-\u0026gt;fetchrow_array;\n    $sth-\u0026gt;finish;\n    \n    my $newPlayer = 0;\n    if (defined $name) {\n        if ($playerName \u0026amp;\u0026amp; $playerName ne $name) {\n\t\t\t$sql = \u0027UPDATE Banking_DATA SET PlayerName=? WHERE PlayerUID=?\u0027;\n            $sth = $dbh-\u0026gt;prepare ($sql);\n            $res = $sth-\u0026gt;execute ($playerName, $playerId);\n            print STDERR \"Changed name of player $playerId from \u0027$name\u0027 to \u0027$playerName\u0027 in table Banking_DATA\\n\";\n        }\n    } else {\n        $newPlayer  = 1;\n        $playerName = \u0027Unknown\u0027 unless $playerName;\n\t\t$sql = \u0027INSERT INTO Banking_DATA(PlayerUID, PlayerName, LastUpdated) VALUES (?, ?, CURRENT_TIMESTAMP)\u0027;\n        $sth = $dbh-\u0026gt;prepare ($sql);\n        $res = $sth-\u0026gt;execute ($playerId, $playerName);\n        print STDERR \"Created a new player $playerId named \u0027$playerName\u0027 in table Banking_DATA\\n\";\n    }\n\t\n\t$sql = \"SELECT BankSaldo\n            FROM  Banking_DATA \n            WHERE PlayerUID=?\";\n    $sth = $dbh-\u0026gt;prepare ($sql);\n    $res = $sth-\u0026gt;execute ($playerId);\n    \n    my ($bankSaldo) = $sth-\u0026gt;fetchrow_array;\n    $sth-\u0026gt;finish;\n\n\t$bankSaldo    = 0         unless (defined $bankSaldo);\n    \n    my $file = $PLAYERS_DIR.\u0027/\u0027.lc($playerId).\u0027-bank.sqf\u0027;\n    open  (OUT, \"\u0026gt;$file\");\n    print OUT \u0027[\"PASS\",\u0027.$bankSaldo.\u0027]\u0027;\n    close (OUT);\n    \n    print STDERR \"CHILD:298 Save bank: $file with BankSaldo: $bankSaldo\\n\";\n    return $res;\n}\n\n# 299\nsub h_bank_update {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $playerId, $bankSaldo) = @$p;\n    unless ($playerId) {\n        print STDERR \"Error h_player_bank_save(): playerId undefined!\\n\";\n        return;\n    }\n    $playerId    =~ s/[\u0027\"]//g;\n\t\n    my $str = \u0027\u0027;\n\t\n\t$str .= \u0027BankSaldo=\u0027.int($bankSaldo).\u0027,\u0027;\n\t\n    return unless $str;\n    \n    $str .= \u0027LastUpdated=CURRENT_TIMESTAMP\u0027;\n    \n    my $sql = \u0027UPDATE Banking_DATA SET \u0027;\n    $sql   .= $str;\n    $sql   .= \u0027 WHERE PlayerUID=?\u0027;\n    \n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ($playerId);\n    return $res;\n}\n\n# 302\nsub h_stream_objects {\n    # Clean objects\n    for my $sql (\u0027DELETE FROM Object_DATA WHERE Instance=? AND ClassName=\"TentStorage\" AND (Inventory=\"[[[],[]],[[],[]],[[],[]]]\" OR Damage=1)\u0027,\n                 \u0027DELETE FROM Object_DATA where Instance=? AND Damage \u0026gt; 0.9 AND ObjectID \u0026gt; 89\u0027) {\n        my $sth = $dbh-\u0026gt;prepare ($sql);\n        $sth-\u0026gt;execute (INSTANCE);\n    }\n    \n    my $sql = \"SELECT ObjectID, CharacterID, Worldspace, Inventory, Hitpoints, Fuel, Damage \n                 FROM Object_init_DATA WHERE Instance=? AND Classname IS NOT NULL ORDER BY ObjectID\";\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute (INSTANCE);\n    return unless $res;\n    \n    my %init = ();\n    while (my ($objId, $ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage) = $sth-\u0026gt;fetchrow_array) {\n        next unless $objId;\n\n        $ownerId    ||= 0;\n        $worldSpace ||= \u0027[]\u0027;\n        $inventory  ||= \u0027[]\u0027;\n        $hitpoints  ||= \u0027[]\u0027;\n        $fuel       ||= 0;\n        $damage     ||= 0;\n    \n        $init{$objId} = [$ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage];\n    }\n    $sth-\u0026gt;finish;\n    \n    $sql = \"SELECT ObjectID, Classname, CharacterID, Worldspace, Inventory, Hitpoints, Fuel, Damage\n            FROM Object_DATA WHERE Instance=? AND Classname IS NOT NULL ORDER BY ObjectID\";\n    $sth = $dbh-\u0026gt;prepare ($sql);\n    $res = $sth-\u0026gt;execute (INSTANCE);\n    return unless $res;\n    \n    my $str     = \u0027\u0027;\n    my @updates = ();\n    while (my ($objId, $className, $ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage) = $sth-\u0026gt;fetchrow_array) {\n        if ( $objId \u0026amp;\u0026amp; $damage \u0026amp;\u0026amp; $damage \u0026gt; 0.7 \u0026amp;\u0026amp; $init{$objId} ) {\n            print STDERR \"Respawn \u0027$className\u0027 ($objId)\\n\";\n            ($ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage) = @{$init{$objId}};\n            push @updates, $objId;\n        }\n        \n        $ownerId    ||= 0;\n        $worldSpace ||= \u0027[]\u0027;\n        $inventory  ||= \u0027[]\u0027;\n        $hitpoints  ||= \u0027[]\u0027;\n        $fuel       ||= 0;\n        $damage     ||= 0;\n        \n        $fuel   = sprintf (\"%.3f\", $fuel);\n        $damage = sprintf (\"%.3f\", $damage);\n        \n        $str .= \u0027,\u0027 if $str;\n        $str .= \u0027[\"OBJ\",\"\u0027.$objId.\u0027\",\"\u0027.$className.\u0027\",\"\u0027.$ownerId.\u0027\",\u0027.$worldSpace.\u0027,\u0027.$inventory.\u0027,\u0027.$hitpoints.\u0027,\u0027.$fuel.\u0027,\u0027.$damage.\u0027]\u0027;\n    }\n    $sth-\u0026gt;finish;\n    \n    for my $objId (@updates) {\n        my ($ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage) = @{$init{$objId}};\n        $sql = \u0027UPDATE Object_DATA SET CharacterID=?, Worldspace=?, Inventory=?, Hitpoints=?, Fuel=?, Damage=? WHERE Instance=? AND ObjectID=?\u0027;\n        $sth = $dbh-\u0026gt;prepare ($sql);\n        $res = $sth-\u0026gt;execute ($ownerId, $worldSpace, $inventory, $hitpoints, $fuel, $damage, INSTANCE, $objId);\n    }    \n    #return unless $str;\n    \n    my $file = CACHE_DIR.\u0027objects.sqf\u0027;\n    open  (OUT, \"\u0026gt;$file\");\n    print OUT \u0027[\u0027.$str.\u0027]\u0027;\n    close (OUT);    \n}\n\n# 303\nsub h_object_update_inventory {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $objectId, $inventory) = @$p;\n    unless ($objectId \u0026amp;\u0026amp; $inventory) {\n        print STDERR \"Error h_object_update_inventory(): objectId or inventory undefined!\\n\";\n        return;\n    }\n    $objectId =~ s/\"//g;\n    \n    unless ( parse_json ($inventory) ) {\n        print STDERR \"Error h_object_update_inventory($objectId): inventory invalid json!\\n\";\n        return;\n    }\n    \n    my $sql = \u0027UPDATE Object_DATA SET Inventory=? WHERE ObjectID=? AND Instance=?\u0027;\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ($inventory, $objectId, INSTANCE);\n    return $res;\n}\n\n# 304\nsub h_object_delete {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $objectId) = @$p;\n    unless ($objectId) {\n        print STDERR \"Error h_object_delete(): objectId undefined!\\n\";\n        return;\n    }\n    $objectId =~ s/\"//g;\n    \n    my $sql = \u0027DELETE FROM Object_DATA WHERE ObjectID=? AND Instance=?\u0027;\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ($objectId, INSTANCE);\n    \n    if ($res) {\n        $sql = \u0027DELETE FROM Object_init_DATA WHERE ObjectID=? AND Instance=?\u0027;\n        $sth = $dbh-\u0026gt;prepare ($sql);\n        $res = $sth-\u0026gt;execute ($objectId, INSTANCE);\n    }    \n    return $res;\n}\n\n# 305\nsub h_vehicle_moved {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $objectId, $worldSpace, $fuel) = @$p;\n    unless ($objectId \u0026amp;\u0026amp; $worldSpace) {\n        print STDERR \"Error h_vehicle_moved(): objectId undefined!\\n\";\n        return;\n    }\n    $objectId =~ s/\"//g;\n    \n    unless ( parse_json ($worldSpace) ) {\n        print STDERR \"Error h_vehicle_moved($objectId): worldSpace invalid json!\\n\";\n        return;\n    }\n    \n    my $sql = \u0027UPDATE Object_DATA SET Worldspace=?, Fuel=? WHERE ObjectID=? AND Instance=?\u0027;\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ($worldSpace, $fuel, $objectId, INSTANCE);\n    return $res;\n}\n\n# 306\nsub h_vehicle_damaged {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $objectId, $hitPoints, $damage) = @$p;\n    unless ($objectId \u0026amp;\u0026amp; defined $hitPoints \u0026amp;\u0026amp; defined $damage) {\n        print STDERR \"Error h_vehicle_damaged(): objectId undefined!\\n\";\n        return;\n    }\n    $objectId =~ s/\"//g;\n    \n    if ($hitPoints) {\n        unless ( parse_json ($hitPoints) ) {\n            print STDERR \"Error h_vehicle_damaged($objectId): hitPoints invalid json!\\n\";\n            return;\n        }\n    }\n    \n    $hitPoints ||= \u0027[]\u0027;\n    $damage    ||= 0;\n    \n    my $sql = \u0027UPDATE Object_DATA SET Hitpoints=?, Damage=? WHERE ObjectID=? AND Instance=?\u0027;\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ($hitPoints, $damage, $objectId, INSTANCE);\n    return $res;\n}\n\n# 308\nsub h_object_publish {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $serverId, $className, $damage, $characterId, $worldSpace, $inventory, $hitPoints, $fuel, $objectUID) = @$p;\n    unless ($className) {\n        print STDERR \"Error h_object_publish(): className undefined!\\n\";\n        return;\n    }\n    $characterId =~ s/\"//g;\n    $objectUID   =~ s/\"//g;\n    \n    if ($worldSpace) {\n        unless ( parse_json ($worldSpace) ) {\n            print STDERR \"Error h_object_publish($className): worldSpace invalid json!\\n\";\n            return;\n        }\n    }\n    if ($inventory) {\n        unless ( parse_json ($inventory) ) {\n            print STDERR \"Error h_object_publish($className): inventory invalid json!\\n\";\n            $inventory = \u0027[]\u0027;\n        }\n    }\n    if ($hitPoints) {\n        unless ( parse_json ($hitPoints) ) {\n            print STDERR \"Error h_object_publish($className): hitPoints invalid json!\\n\";\n            $hitPoints = \u0027[]\u0027;\n        }\n    }\n    \n    $serverId   ||= INSTANCE;\n    $worldSpace ||= \u0027[]\u0027;\n    $inventory  ||= \u0027[]\u0027;\n    $hitPoints  ||= \u0027[]\u0027;\n    $damage     ||= 0;\n    $fuel       ||= 0;\n    \n    my $sql = \"INSERT INTO Object_DATA(ObjectUID, Instance, Classname, Damage, CharacterID, Worldspace, Inventory, \n                                       Hitpoints, Fuel, Datestamp) \n               VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)\";\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ($objectUID, $serverId, $className, $damage, $characterId, $worldSpace, $inventory, $hitPoints, $fuel);\n    \n    # Cache object ID\n    $sql = \u0027SELECT ObjectID FROM Object_DATA WHERE ObjectUID=? AND Instance=?\u0027;\n    $sth = $dbh-\u0026gt;prepare ($sql);\n    $res = $sth-\u0026gt;execute ($objectUID, $serverId);\n    return unless $res;\n                \n    my ($objectId) = $sth-\u0026gt;fetchrow_array;\n    $sth-\u0026gt;finish;\n    return unless (defined $objectId);\n\n    my $file = CACHE_DIR.\u0027objects/\u0027.$objectUID.\u0027.sqf\u0027;\n    open  (OUT, \"\u0026gt;$file\");\n    print OUT \u0027[\"PASS\",\"\u0027.$objectId.\u0027\"]\u0027;\n    close (OUT);\n}\n\n# 309\nsub h_object_uid_update_inventory {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $objectUID, $inventory) = @$p;\n    unless ($objectUID \u0026amp;\u0026amp; $inventory) {\n        print STDERR \"Error h_object_uid_update_inventory(): objectUID or inventory undefined!\\n\";\n        return;\n    }\n    $objectUID =~ s/\"//g;\n    \n    unless ( parse_json ($inventory) ) {\n        print STDERR \"Error h_object_uid_update_inventory($objectUID): inventory invalid json!\\n\";\n        return;\n    }\n    \n    my $sql = \u0027UPDATE Object_DATA SET Inventory=? WHERE ObjectUID=? AND Instance=?\u0027;\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ($inventory, $objectUID, INSTANCE);\n    return $res;\n}\n\n# 310\nsub h_object_uid_delete {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $objectUID) = @$p;\n    unless ($objectUID) {\n        print STDERR \"Error h_object_uid_delete(): objectUID undefined!\\n\";\n        return;\n    }\n    $objectUID =~ s/\"//g;\n    \n    my $sql = \u0027DELETE FROM Object_DATA WHERE ObjectUID=? AND Instance=?\u0027;\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ($objectUID, INSTANCE);\n    \n    if ($res) {\n        $sql = \u0027DELETE FROM Object_init_DATA WHERE ObjectUID=? AND Instance=?\u0027;\n        $sth = $dbh-\u0026gt;prepare ($sql);\n        $res = $sth-\u0026gt;execute ($objectUID, INSTANCE);\n    }\n    return $res;\n}\n\n# 388 - loadObjectID\nsub h_load_objects_id {\n    my $sql = \u0027SELECT ObjectID, ObjectUID FROM Object_DATA WHERE Instance=? ORDER BY ObjectUID\u0027;\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute (INSTANCE);\n    #return unless $res;\n    \n    while (my ($objectId, $objectUID) = $sth-\u0026gt;fetchrow_array) {\n        next unless (defined $objectId);\n        \n        my $file = CACHE_DIR.\u0027objects/\u0027.$objectUID.\u0027.sqf\u0027;\n        open  (OUT, \"\u0026gt;$file\");\n        print OUT \u0027[\"PASS\",\"\u0027.$objectId.\u0027\"]\u0027;\n        close (OUT);\n    }\n    $sth-\u0026gt;finish;\n}\n\n# 396\nsub h_object_reset_damage {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $oid) = @$p;\n    unless ($oid) {\n        print STDERR \"Error h_object_reset_damage(): objectId undefined!\\n\";\n        return;\n    }\n    $oid =~ s/\"//g;\n    \n    my $sth = $dbh-\u0026gt;prepare (\u0027UPDATE Object_DATA SET Damage=0 WHERE ObjectID=? AND Instance=?\u0027);\n    my $res = $sth-\u0026gt;execute ($oid, INSTANCE);\n    return $res;\n}\n\n# 397\nsub h_object_uid_reset_damage {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $uid) = @$p;\n    unless ($uid) {\n        print STDERR \"Error h_object_uid_reset_damage(): objectUID undefined!\\n\";\n        return;\n    }\n    $uid =~ s/\"//g;\n    \n    my $sth = $dbh-\u0026gt;prepare (\u0027UPDATE Object_DATA SET Damage=0 WHERE ObjectUID=? AND Instance=?\u0027);\n    my $res = $sth-\u0026gt;execute ($uid, INSTANCE);\n    return $res;\n}\n\n# 398 - tradeObject \nsub h_trade_object {\n    my $p = shift;\n    return unless ($p \u0026amp;\u0026amp; ref($p) eq \u0027ARRAY\u0027);\n    my ($cmd, $traderObjectId, $action) = @$p;\n    return unless ($traderObjectId \u0026amp;\u0026amp; defined $action);\n    \n    my $sql;\n    if ($action == 0) {\n        $sql = \u0027UPDATE Traders_DATA SET qty = qty - 1 WHERE id=? AND qty \u0026gt; 0\u0027;\n    } else {\n        $sql = \u0027UPDATE Traders_DATA SET qty = qty + 1 WHERE id=?\u0027;\n    }\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ($traderObjectId);    \n    return $res;\n}\n\n# 399 - loadTraderDetails\nsub h_load_trader_details {\n    my $sql = \u0027SELECT id, item, qty, buy, sell, `order`, tid, afile FROM Traders_DATA\u0027;\n    my $sth = $dbh-\u0026gt;prepare ($sql);\n    my $res = $sth-\u0026gt;execute ();\n    return unless $res;\n    \n    my %tids = ();\n    my $charecterId = 0;\n    while (my ($id, $item, $qty, $buy, $sell, $order, $tid, $afile) = $sth-\u0026gt;fetchrow_array) {\n        next unless $tid;\n        $tids{$tid} = [] unless $tids{$tid};\n        \n        push @{$tids{$tid}}, \u0027[\u0027.$id.\u0027,\u0027.$item.\u0027,\u0027.$qty.\u0027,\u0027.$buy.\u0027,\u0027.$sell.\u0027,\u0027.$order.\u0027,\u0027.$tid.\u0027,\"\u0027.$afile.\u0027\"]\u0027;\n    }     \n    $sth-\u0026gt;finish;\n    \n    return unless %tids;\n    \n    while (my ($tid, $v) = each %tids) {\n        next unless ($v \u0026amp;\u0026amp; @$v);\n        my $str = join (\u0027,\u0027, @$v);\n    \n        my $file = CACHE_DIR.\u0027traders/\u0027.$tid.\u0027.sqf\u0027;\n        open  (OUT, \"\u0026gt;$file\");\n        print OUT \u0027[\u0027.$str.\u0027]\u0027;\n        close (OUT);\n    }\n    \n    undef %tids;\n}\n\n\n\n[\"PASS\",false,\"1\",[],[[],[]],[\"\",[],[]],[0,0,0],\"Survivor2_DZ\",0.96,0]\n\n\n[\"PASS\",[],[0,0,0,0],[],[],2500,\"1\",0]\n\n",
    "dateCreated": "2014-11-01T13:07:40+0000",
    "datePublished": "2014-11-01T13:07:40+0000",
    "dateModified": "2014-11-05T06:26:29+0000",
    "image": "https://epochmod.com/forum/applications/core/interface/email/default_photo.png",
    "author": {
        "@type": "Person",
        "name": "Backtrack",
        "image": "https://epochmod.com/forum/applications/core/interface/email/default_photo.png",
        "url": "https://epochmod.com/forum/profile/15715-backtrack/"
    },
    "interactionStatistic": [
        {
            "@type": "InteractionCounter",
            "interactionType": "http://schema.org/ViewAction",
            "userInteractionCount": 1431
        },
        {
            "@type": "InteractionCounter",
            "interactionType": "http://schema.org/CommentAction",
            "userInteractionCount": 3
        },
        {
            "@type": "InteractionCounter",
            "interactionType": "http://schema.org/FollowAction",
            "userInteractionCount": 0
        }
    ],
    "@context": "http://schema.org",
    "@type": "DiscussionForumPosting",
    "@id": "https://epochmod.com/forum/topic/27487-inventory-rollbacks/",
    "isPartOf": {
        "@id": "https://epochmod.com/forum/#website"
    },
    "publisher": {
        "@id": "https://epochmod.com/forum/#organization",
        "member": {
            "@type": "Person",
            "name": "Backtrack",
            "image": "https://epochmod.com/forum/applications/core/interface/email/default_photo.png",
            "url": "https://epochmod.com/forum/profile/15715-backtrack/"
        }
    },
    "url": "https://epochmod.com/forum/topic/27487-inventory-rollbacks/",
    "discussionUrl": "https://epochmod.com/forum/topic/27487-inventory-rollbacks/",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://epochmod.com/forum/topic/27487-inventory-rollbacks/"
    },
    "pageStart": 1,
    "pageEnd": 1,
    "comment": [
        {
            "@type": "Comment",
            "@id": "https://epochmod.com/forum/topic/27487-inventory-rollbacks/#comment-162353",
            "url": "https://epochmod.com/forum/topic/27487-inventory-rollbacks/#comment-162353",
            "author": {
                "@type": "Person",
                "name": "leodr99",
                "image": "https://epochmod.com/forum/applications/core/interface/email/default_photo.png",
                "url": "https://epochmod.com/forum/profile/12866-leodr99/"
            },
            "dateCreated": "2014-11-01T14:57:44+0000",
            "text": "Hi there, \n\u00a0 \nDoes this happens during player relog, or before/after server restart? \nIf it happens just before/after server restart, you need to edit the server start script to clear the player cache folder, in order to update the latter upon server start with the player loadout on the database.  \nJust look for the epoch.sh\u00a0script file on the game root folder and add this after the\u00a0export LD_LIB... line, like so: \n\u00a0 \n\n\nexport LD_LIBRARY_PATH=.:/usr/lib32:$LD_LIBRARY_PATH\n# Clear the cache to eliminate the rollback bug\nrm -rf cache/players/*\nrm -rf cache/traders/*\nrm -rf cache/objects/*\nThis will make it, that just before the server start it will recreate the player cache files with the up-to-date data in the database. \n\u00a0 \nCheers. \n\n",
            "upvoteCount": 0
        },
        {
            "@type": "Comment",
            "@id": "https://epochmod.com/forum/topic/27487-inventory-rollbacks/#comment-162363",
            "url": "https://epochmod.com/forum/topic/27487-inventory-rollbacks/#comment-162363",
            "author": {
                "@type": "Person",
                "name": "Backtrack",
                "image": "https://epochmod.com/forum/applications/core/interface/email/default_photo.png",
                "url": "https://epochmod.com/forum/profile/15715-backtrack/"
            },
            "dateCreated": "2014-11-01T15:23:16+0000",
            "text": "It is only after relog \n",
            "upvoteCount": 0
        },
        {
            "@type": "Comment",
            "@id": "https://epochmod.com/forum/topic/27487-inventory-rollbacks/#comment-164357",
            "url": "https://epochmod.com/forum/topic/27487-inventory-rollbacks/#comment-164357",
            "author": {
                "@type": "Person",
                "name": "A Pollo",
                "image": "https://epochmod.com/forum/uploads/profile/photo-thumb-12468.jpg",
                "url": "https://epochmod.com/forum/profile/12468-a-pollo/"
            },
            "dateCreated": "2014-11-05T06:26:29+0000",
            "text": "It looks like you\u0027re using Dean\u0027s Gold Coin thing. Make sure your server_playerSetup.sqf is the one we supplied. \n",
            "upvoteCount": 0
        }
    ]
}	
</script>
<script type="application/ld+json">
{
    "@context": "http://www.schema.org",
    "publisher": "https://epochmod.com/forum/#organization",
    "@type": "WebSite",
    "@id": "https://epochmod.com/forum/#website",
    "mainEntityOfPage": "https://epochmod.com/forum/",
    "name": "Epoch Mod Community",
    "url": "https://epochmod.com/forum/",
    "potentialAction": {
        "type": "SearchAction",
        "query-input": "required name=query",
        "target": "https://epochmod.com/forum/search/?q={query}"
    },
    "inLanguage": [
        {
            "@type": "Language",
            "name": "English (USA)",
            "alternateName": "en-US"
        }
    ]
}	
</script>
<script type="application/ld+json">
{
    "@context": "http://www.schema.org",
    "@type": "Organization",
    "@id": "https://epochmod.com/forum/#organization",
    "mainEntityOfPage": "https://epochmod.com/forum/",
    "name": "Epoch Mod Community",
    "url": "https://epochmod.com/forum/",
    "logo": {
        "@type": "ImageObject",
        "@id": "https://epochmod.com/forum/#logo",
        "url": "https://epochmod.com/forum/uploads/monthly_2023_04/text_only.png.512d7d1c1eb3e42e7aae78351fa37e02.png"
    },
    "sameAs": [
        "https://facebook.com/EpochMod",
        "https://twitter.com/EpochMod",
        "https://github.com/EpochModTeam/"
    ]
}	
</script>
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
        {
            "@type": "ListItem",
            "position": 1,
            "item": {
                "@id": "https://epochmod.com/forum/forum/1-arma-2/",
                "name": "ArmA 2"
            }
        },
        {
            "@type": "ListItem",
            "position": 2,
            "item": {
                "@id": "https://epochmod.com/forum/forum/63-a2-community-projects/",
                "name": "A2: Community Projects"
            }
        },
        {
            "@type": "ListItem",
            "position": 3,
            "item": {
                "@id": "https://epochmod.com/forum/forum/50-epoch-linux-server/",
                "name": "Epoch Linux Server"
            }
        }
    ]
}	
</script>
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "ContactPage",
    "url": "https://epochmod.com/forum/contact/"
}	
</script>
<script type="text/javascript">
    (() => {
        let gqlKeys = [];
        for (let [k, v] of Object.entries(gqlKeys)) {
            ips.setGraphQlData(k, v);
        }
    })();
</script>
<!--ipsQueryLog-->
<!--ipsCachingLog-->
</body>

</html>